{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "jupyter: python3\n",
        "---\n",
        "\n",
        "# Parabolic Partial Differential Equations {#sec-x1}\n",
        "\n",
        "## Introduction to Partial Differential Equations {#sec-x1-1}\n",
        "\n",
        "* Most physical phenomena, $\\,$whether in the domain of fluid dynamics, electricity, magnetism, mechanics, optics, or heat flow, $\\,$can be described in general by partial differential equations(PDEs): $\\,$in fact, $\\,$<font color=\"red\">most of mathematical physics are PDEs</font>\n",
        "\n",
        "* **What Are PDEs?**\n",
        "\n",
        "  A partial differential equation is an equation that contains partial derivatives. In contrast to ordinary differential equations (ODEs), where the unknown function depends on *only one variable*, <font color=\"red\">**in PDEs, the unknown function depends on several variables**: $\\,u(x,t)$ depends both on location $x$ and time $t$</font>\n",
        "\n",
        "* A few well-known PDEs\n",
        "  \n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "     u_t &= u_{xx}, &&\\scriptsize\\text{heat equation in one dimension} \\\\[5pt]\n",
        "     u_t &= u_{xx}+u_{yy}, &&\\scriptsize\\text{heat equation in two dimension} \\\\[5pt]\n",
        "     u_{tt} &= u_{xx}+u_{yy}+u_{zz}, &&\\scriptsize\\text{wave equation in three dimension} \\\\\n",
        "     u_{rr} &+\\frac{1}{r}u_r+\\frac{1}{r^2}u_{\\theta\\theta}=0, &&\\scriptsize\\text{Laplace's equation in polar coordinates}\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* The unknown function $u$ always depends on more than one variable. $\\,$The variable $u$ (which we differentiate) is called the <font color=\"blue\">**dependent** variable</font>, $\\,$whereas the ones differentiate *with respect to* are called the <font color=\"blue\">**independent** variables</font>\n",
        "\n",
        "* **Classification** is an important concept because the general theory and methods of solution apply only to a given class of equations. $\\,$<font color=\"blue\">Six basic classifications are</font>:\n",
        "\n",
        "  * **Order of the PDE**\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      u_t &= u_{\\color{red}{xx}}, && \\scriptsize \\text{second order} \\\\\n",
        "      u_{\\color{red}{t}} &= u_{\\color{red}{x}}, && \\scriptsize \\text{first order} \\\\\n",
        "      u_t &= uu_{\\color{red}{xxx}}+\\sin x, && \\scriptsize \\text{third order}\n",
        "      \\end{aligned}$$\n",
        "\n",
        "  * **Number of Independent Variables**\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      u_t &= u_{xx}, && \\scriptsize \\text{two variables: } \\,x \\,\\text{and } \\,t \\\\\n",
        "      u_t &= u_{rr}+\\frac{1}{r}u_{r}+\\frac{1}{r^2}u_{\\theta\\theta}, && \\scriptsize \\text{three variables: } \\,t, \\,r \\,\\text{and } \\,\\theta\n",
        "    \\end{aligned}$$\n",
        "\n",
        "  * **Linearity**\n",
        " \n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      & u_{tt} = e^{-t}u_{xx}+\\sin t, && \\scriptsize \\text{linear} \\\\\n",
        "      & \\color{blue}{uu_{xx}}+u_t=0, && \\scriptsize \\text{nonlinear} \\\\\n",
        "      & u_{xx}+yu_{yy}=0, && \\scriptsize \\text{linear} \\\\\n",
        "      & xu_x+yu_y +\\color{blue}{u^2}=0, && \\scriptsize \\text{nonlinear}\n",
        "      \\end{aligned}$$\n",
        "\n",
        "* A second-order linear equation in two variables is an equation of the form:\n",
        "  \n",
        "  $$Au_{xx} +Bu_{xy} +Cu_{yy} +Du_x +Eu_y +Fu = G \\tag{SL}\\label{eq:SL}$$  \n",
        "  \n",
        "  where $A$, $B$, $C$, $D$, $E$, $F$, and $G$ can be constants or given functions of $x$ and $y$\n",
        "\n",
        "  * **Homogeneity**\n",
        "\n",
        "    * \\eqref{eq:SL} is called <font color=\"blue\">**homogeneous**</font> if the right hand side $G(x,y)$ is identically zero for all $x$ and $y$. \n",
        "  \n",
        "    * If $G(x,y)$ is not identically zero, then the equation is <font color=\"blue\">**nonhomogeneous**</font>\n",
        "\n",
        "  * **Kinds of Coefficients**\n",
        "\n",
        "    The coefficients in \\eqref{eq:SL} are constants, then \\eqref{eq:SL} is said to have constant coefficients (otherwise, $\\,$variable coefficients)\n",
        "\n",
        "  * **Three Basic Types of Linear Equations** \n",
        "\n",
        "    * <font color=\"red\">**Parabolic**</font> \n",
        "\n",
        "      <font color=\"blue\">$B^2-4AC=0,~$</font> heat flow and diffusion processes\n",
        "  \n",
        "      $u_t=u_{xx}$\n",
        "  \n",
        "    * <font color=\"red\">**Hyperbolic**</font> \n",
        "    \n",
        "      <font color=\"blue\">$B^2-4AC>0,~$</font> vibrating systems and wave motion\n",
        "  \n",
        "      $u_{tt}=u_{xx}, \\;u_{\\xi\\eta}=0$\n",
        "    \n",
        "    * <font color=\"red\">**Elliptic**</font> \n",
        "    \n",
        "      <font color=\"blue\">$B^2-4AC < 0,~$</font> steady-state phenomena\n",
        "  \n",
        "      $u_{xx}+u_{yy}=0$\n",
        "    \n",
        "  * In the case of variable coefficients, the situation can change from point to point\n",
        "  \n",
        "    $yu_{xx}+u_{yy}=0$\n",
        "\n",
        "## Diffusion-Type Problems (Parabolic Equations) {#sec-x1-2}\n",
        "\n",
        "![](figures/pde01_figure01.jpg \"heat flow experiment\"){width=\"90%\" fig-align=\"center\"}\n",
        "\n",
        "* **The Mathematical Model of the Heat-Flow**\n",
        "\n",
        "  The description of our physical problem requires three types of equations\n",
        "\n",
        "  * The <font color=\"red\">**PDE**</font> describing the physical phenomenon of heat flow\n",
        "\n",
        "  * The <font color=\"red\">**boundary conditions**</font> describing the physical nature of our problem on the boundaries\n",
        "\n",
        "  * The <font color=\"red\">**initial condition**</font> describing the physical phenomenon at the start of the experiment \n",
        "\n",
        "* **<font color=\"blue\">The Heat Equation</font>**\n",
        "\n",
        "  The basic equation of *one-dimensional* heat flow is \n",
        "\n",
        "  $$u_t=\\alpha u_{xx},\\;0<x<L, \\;0<t<\\infty \\tag{HE}\\label{eq:HE}$$  \n",
        "\n",
        "  This equation is derived from the basic conservation of energy\n",
        "\n",
        "* **<font color=\"blue\">Boundary Conditions</font>**\n",
        "\n",
        "  All physical problems have boundaries of some kind, $\\,$so we must describe mathematically what goes on there in order to adequately describe the problem. Since the temperature $\\,u\\,$ was fixed for all time $t>0~$ at $~T_1$ and $T_2~$ at the two ends $\\,x=0~$ and $~x=L$\n",
        "\n",
        "  $$\n",
        "  \\begin{array}{r}\n",
        "   u(0,t) = T_1\\\\ \n",
        "   u(L,t) = T_2 \n",
        "  \\end{array}, \\;\\; 0 < t < \\infty \n",
        "  \\tag{BCs}\\label{eq:BCs}$$\n",
        "\n",
        "* **<font color=\"blue\">Initial Condition</font>**\n",
        "\n",
        "  All physical problems must start from some value of time (generally called $t=0$), $\\,$so we must specify the physical apparatus at this time. Since we started monitoring the rod temperature from time the rod has achieved a constant temperature $T_0$, $\\,$we have\n",
        "\n",
        "  $$ u(x,0) = T_0, \\;\\; 0 \\leq x \\leq L \\tag{IC}\\label{eq:IC}$$\n",
        "\n",
        "  By writing \\eqref{eq:HE}, \\eqref{eq:BCs}, and \\eqref{eq:IC} together, $\\,$we have what is called an <font color=\"red\">*initial-boundary-value problem*</font>. The interesting here, which is not at all obvious, is that there is only one function $u(x,t)$ that satisfies the problem\n",
        "\n",
        "* **More Diffusion-Type Equations**\n",
        "\n",
        "  * **Lateral Heat Loss Proportional to the Temperature Difference**\n",
        "\n",
        "    The equation\n",
        "\n",
        "    $$u_t=\\alpha u_{xx} -\\beta (u -u_0),\\;\\beta>0$$\n",
        "\n",
        "    describes heat flow in the rod with both diffusion $\\alpha u_{xx}$ along the rod and heat loss (or gain) across the lateral sides of the rod. $\\,$Heat loss ($u>u_0$) or gain ($u<u_0$) is proportional to the difference between the temperature $u(x,t)$ and the surrounding medium $u_0$\n",
        "\n",
        "  * **Internal Heat Source**\n",
        "\n",
        "    The nonhomogeneous equation\n",
        "\n",
        "    $$u_t=\\alpha u_{xx}+f(x,t)$$\n",
        "\n",
        "    corresponds to the situation where the rod is being supplied with an internal heat source\n",
        "\n",
        "  * **Diffusion-Convection Equation**\n",
        "\n",
        "    Suppose a pollutant is being carried along in a stream moving with velocity $v$. $\\,$The rate of change $u_t$ is measured by the diffusion-convection equation\n",
        "\n",
        "    $$u_t=\\alpha u_{xx}-vu_x$$\n",
        "\n",
        "    The term $\\alpha u_{xx}$ is the diffusion contribution and $-vu_x$ is the convection component\n",
        "\n",
        "## Derivation of the Heat Equation {#sec-x1-3}\n",
        "\n",
        "$~$\n",
        "\n",
        "![](figures/pde01_figure05.jpg \"thin conducting rod\"){width=\"70%\" fig-align=\"center\"}\n",
        "\n",
        "* Suppose we have a one-dimension rod of length $L$ for which we make the following assumptions:\n",
        "\n",
        "  * The rod is made of a single homogeneous conducting material\n",
        "\n",
        "  * The rod is laterally insulated (heat flows only in the $x$-direction)\n",
        "\n",
        "  * The rod is thin (the temperature at all points of a cross section is constant)\n",
        "\n",
        "* If we apply the principle of conservation of energy to the segment $[x,x+\\Delta x]$, $\\,$we can claim\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    \\text{Net Change} & \\text{ of Heat inside } [x,x+\\Delta x] \\;=\\; \\\\\n",
        "     &\\text{Net Flux of Heat across the Boundaries} \\;+ \\\\\n",
        "     &\\qquad\\qquad\\text{Total Heat Generated inside }[x,x+\\Delta x]\n",
        "    \\end{aligned}$$ \n",
        "\n",
        "  * The total amount of heat inside $[x,x+\\Delta x]$ at any time $\\,t\\,$ is measured by\n",
        " \n",
        "    $$ \\text{Total Heat inside } [x,x+\\Delta x] = \\int_x^{x+\\Delta x} \\rho c_p A u(s,t)\\,ds $$\n",
        "\n",
        "  * We can write the conservation of energy via calculus as\n",
        "\n",
        "  $$\\scriptsize\n",
        "  \\begin{aligned}\n",
        "    \\frac{d}{dt}\\int_x^{x +\\Delta x} \n",
        "     &\\rho c_p A u(s,t)\\,ds = \\rho c_p A \\int_x^{x +\\Delta x} u_t(s,t)\\,ds \\\\\n",
        "     &=kA \\left[ u_x(x+\\Delta x,t) -u_x(x,t) \\right] +A\\int_x^{x +\\Delta x} F(s,t)\\,ds \\\\ \\\\\n",
        "    &\\big\\downarrow {\\; \\text{Mean Value Theorem}\\;\\int_a^b f(x)\\,dx=f(\\xi)(b-a),\\;a<\\xi<b } \\\\ \\\\\n",
        "    \\rho c_p A u_t(\\xi_1,t) \\Delta x \n",
        "     &= kA \\left[ u_x(x+\\Delta x,t) -u_x(x,t) \\right] +AF(\\xi_2,t)\\Delta x, \\;\\;x<\\xi_1, \\xi_2<x+\\Delta x\\\\ \\\\\n",
        "    &\\big\\downarrow \\\\ \\\\\n",
        "    u_t(\\xi_1,t) \n",
        "    &=\\frac{k}{\\rho c_p} \\left\\{ \\frac{u_x(x+\\Delta x,t) -u_x(x,t)}{\\Delta x} \\right\\} +\\frac{1}{\\rho c_p} F(\\xi_2,t) \\\\ \\\\\n",
        "    &\\big\\downarrow \\;\\Delta x \\to 0 \\\\ \\\\\n",
        "     {\\normalsize u_t(x,t)}\\; & {\\normalsize =\\alpha u_{xx}(x,t) +f(x,t)}\n",
        "  \\end{aligned}$$\n",
        "\n",
        "## Boundary Conditions for Diffusion-Type Problems {#sec-x1-4}\n",
        "\n",
        "* When describing the various types of boundary conditions that can occur for heat-flow problems, <font colkor=\"blue\">three basic types generally come to mind</font>\n",
        "\n",
        "* **Type 1 BC (Temperature specified on the boundary)** \n",
        "\n",
        "  ![](figures/pde01_figure02.jpg \"type 1 BC\"){width=\"70%\" fig-align=\"center\"}\n",
        "\n",
        "  ![](figures/pde01_figure03.jpg \"oscillating BC\"){width=\"70%\" fig-align=\"center\"}\n",
        "\n",
        "  * Of course, we'd have an initial temperature to get this experiment started, but in this case, the effects of our IC would vanish after a short period of time, and the resulting temperature inside the circle would depend on the boundary temperature\n",
        "\n",
        "* **Type 2 BC (Flux specified - including the special case of insulated boundaries)**\n",
        "\n",
        "  * **Insulated boundaries** are those that do not allow any heat flow to pass, and, hence, the normal derivative (inward or outward) must be zero on the boundary (since the normal derivative is proportional to the flux)\n",
        "\n",
        "  * In the case of the one-dimensional rod with insulated ends at $x=0$ and $x=L$, the BCs are\n",
        "\n",
        "    $$\\begin{array}{r}\n",
        "      u_x(0,t) = 0\\\\ \n",
        "      u_x(L,t) = 0 \n",
        "    \\end{array},\\;\\; 0 < t <\\infty $$\n",
        "\n",
        "  * In two-dimensional domains, an insulated boundary would mean that the normal derivative of the temperature across the boundary is zero.\n",
        "For example, if the circular disc insulated on the boundary, then the BC would be\n",
        "\n",
        "    $$u_r(R,\\theta,t)=0\\; \\text{ for } \\;0\\leq \\theta <2\\pi\\; \\text{ and }\\;0<t<\\infty$$\n",
        "\n",
        "    On the other hand, if we specify the amount of heat entering across the boundary of our disc, the BC is\n",
        "\n",
        "    $$u_r(R,\\theta,t)=f(\\theta,t)$$\n",
        "\n",
        "* **Type 3 BC (Temperature of the surrounding medium specified)**\n",
        "\n",
        "  ![](figures/pde01_figure04.jpg \"convective cooling at boundary\"){width=\"60%\" fig-align=\"center\"}\n",
        "\n",
        "  * By specifying these types of BCs, $\\,$we cannot say the boundary temperatures of the rod will be the same as the liquid temperature $g_1(t)$ and $g_2(t)$,\n",
        "\n",
        "  * but we do know (Newton's law of cooling) that whenever the rod temperature at one of the boundaries is less than the respective liquid temperatures, $\\,$then heat will flow into the rod at a rate proportional to this differance\n",
        "\n",
        "  * In other words, for the one-dimensional rod with boundaries at $x=0$ and $L$, $\\,$Newton's law of cooling states:\n",
        "\n",
        "    $$ \\text{Outward Flux of Heat (at } x=0\\text{) }=h[u(0,t) -g_1(t)] $$\n",
        "  \n",
        "    $$ \\text{Outward Flux of Heat (at } x=L\\text{) }=h[u(L,t) -g_2(t)] $$\n",
        "\n",
        "    where $\\,h$ is a heat transfer coefficient\n",
        "\n",
        "  * Fourier's law gives us another representation for the outward flux of heat. In our one-dimensional problem, $\\,$Fourier's law takes the form:\n",
        "\n",
        "    $$ \\text{Outward Flux of Heat (at }x=0\\text{) } \\displaystyle =k\\frac{\\partial u(0,t)}{\\partial x}$$\n",
        "\n",
        "    $$ \\text{Outward Flux of Heat (at }x=L\\text{) }\\displaystyle =-k\\frac{\\partial u(L,t)}{\\partial x}$$\n",
        "\n",
        "    where $k$ is the thermal conductivity of the material\n",
        "\n",
        "  * Finally if we use the two experssions for heat flux, $\\,$we have our desired BCs in purely mathematical terms;\n",
        "\n",
        "    $$\\begin{array}{l}\n",
        "    \\displaystyle\\frac{\\partial u(0,t)}{\\partial x} \n",
        "      = \\phantom{-}\\frac{h}{k} \\left[ u(0,t) -g_1(t) \\right]\\\\[8pt] \n",
        "    \\displaystyle\\frac{\\partial u(L,t)}{\\partial x} \n",
        "    = -\\frac{h}{k} \\left[ u(L,t) -g_2(t) \\right]\n",
        "   \\end{array},\\;\\; 0 < t < \\infty$$\n",
        "\n",
        "  * In higher dimensions, we have similar BCs; for example, if the boundary of a circular disc is interfaced with a moving liquid that has a temperature $g(\\theta,t)$, $\\,$our BC would be\n",
        "\n",
        "    $$\\frac{\\partial u}{\\partial r}(R,\\theta, t)=-\\frac{h}{k} \\left[ u(R,\\theta,t) -g(\\theta,t) \\right]$$\n",
        "\n",
        "## Separation of Variables {#sec-x1-5}\n",
        "\n",
        "* Separation of variables is one of the oldest techniques for solving initial-boundary-value problems and applies to problems where\n",
        "\n",
        "  * The PDE is <font color=\"blue\">linear and homogeneous (not necessarily constant coefficients)</font>\n",
        "\n",
        "  * The boundary conditions are of the form\n",
        "\n",
        "  \n",
        "    $$\\begin{aligned}\n",
        "      \\alpha u_x(0,t) +\\beta u(0,t)&= 0\\\\ \n",
        "      \\gamma u_x(L,t) +\\delta u(L,t)&= 0 \n",
        "    \\end{aligned}$$\n",
        "\n",
        "    where $\\alpha$, $\\beta$, $\\gamma$, and $\\delta$ are constants (boundary conditions of this form are called <font color=\"blue\">linear homogeneous BCs</font>)\n",
        "\n",
        "* We wish to find the function $u(x,t)$ that satisfies the following four conditions:\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "      u_t &= \\alpha u_{xx} && 0 < x < L,\\; 0 < t < \\infty \\\\\n",
        "      u(0, t) &= 0 && 0 < t < \\infty \\\\\n",
        "      u(L, t) &= 0 && \\\\\n",
        "      u(x, 0) &= \\phi(x) && 0 \\leq x \\leq L\n",
        "  \\end{aligned}$$\n",
        "\n",
        "  ![](figures/pde01_figure06.jpg \"diffusion problem\"){width=\"70%\" fig-align=\"center\"}\n",
        "\n",
        "**STEP 1** $\\,$ To begin, $\\,$we look for solutions of the form $u(x,t)=X(x)T(t)$ by substituting $X(x)T(t)$ into the PDE\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "  X(x)T'(t)&=\\alpha X''(x)T(t) \\\\ \n",
        "  &\\Downarrow \\\\ \n",
        "  \\frac{T'(t)}{\\alpha T(t)}&= \\frac{X''(x)}{X(x)}=-\\lambda <0\\\\ \n",
        "  &\\Downarrow {\\scriptsize \\text{We essentially change a second-order PDE to two ODEs}}\\\\ \n",
        "  T' &+\\alpha\\lambda T= 0\\\\ \n",
        "  X'' &+\\lambda X = 0 \\\\\n",
        "  &\\Downarrow \\\\\n",
        "  T(t)&=a_1 e^{-\\alpha\\lambda t}\\\\\n",
        "  X(x)&=a_2 \\sin \\sqrt{\\lambda}x +a_3 \\cos \\sqrt{\\lambda}x\\\\\n",
        "  &\\Downarrow \\\\\n",
        "  u(x,t)&=e^{-\\alpha\\lambda t} \\left[ A \\sin \\sqrt{\\lambda}x +B\\cos\\sqrt{\\lambda} x \\right]\n",
        "\\end{aligned}$$\n",
        "\n",
        "At this point, $\\,$we have an infinite number of functions that satisfy the PDE\n",
        "\n",
        "**STEP 2** $\\,$The next step is to choose a certain subset of our current crop of solutions\n",
        "\n",
        "$$e^{-\\alpha\\lambda t} \\left[ A \\sin \\sqrt{\\lambda}x +B\\cos\\sqrt{\\lambda} x \\right]\\;$$ {#eq-Heat_01}\n",
        "\n",
        "that satisfy the boundary conditions\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u(0,t) &= 0 \\\\ \n",
        " u(L,t) &= 0 \n",
        "\\end{aligned}$$\n",
        "\n",
        "To do this, $\\,$we substitute @eq-Heat_01 into these BCs, $\\,$getting\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "  u(0,t) & =Be^{-\\alpha\\lambda t}=0\\;\\Rightarrow B=0\\\\ \n",
        "  u(L,t) & =Ae^{-\\alpha\\lambda t}\\sin\\sqrt{\\lambda}L=0 \\;\\Rightarrow \\sin\\sqrt{\\lambda}L=0,\\; A\\neq 0 \\\\\n",
        "  &\\Downarrow \\\\\n",
        " \\lambda &= \\left(\\frac{\\pi}{L}\\right)^2, \\left(\\frac{2\\pi}{L}\\right)^2,\\left(\\frac{3\\pi}{L}\\right)^2,\\cdots \\\\\n",
        " &\\Downarrow \\\\\n",
        " \\lambda_n &=\\left(\\frac{n\\pi}{L}\\right)^2,\\;n=1,2,3,\\cdots \\\\ \\text{ }\n",
        "\\end{aligned}$$\n",
        "\n",
        "We have now finished the second step; we have an infinite number of functions\n",
        "\n",
        "$$ u_n(x,t)=c_n e^{-\\alpha\\left(\\frac{n\\pi}{L}\\right)^2 t} \\sin\\left( \\frac{n\\pi}{L}x \\right), \\;n=1,2,3,\\cdots $$\n",
        "\n",
        "each one satisfying the PDE and the BCs\n",
        "\n",
        "**STEP 3** $\\,$The last step is to add the fundamental solutions\n",
        "\n",
        "$$ u(x,t)=\\sum_{n=1}^\\infty c_n e^{-\\alpha\\left(\\frac{n\\pi}{L}\\right)^2 t} \\sin\\left( \\frac{n\\pi}{L}x \\right)$$ {#eq-Heat_02}\n",
        "\n",
        "in such a way (pick the coefficients $c_n$) that the initial condition\n",
        "\n",
        "$$u(x,0)=\\phi(x)$$\n",
        "\n",
        "is satisfied. $\\,$Substituting the sum into the IC gives\n",
        "\n",
        "$$ \\phi(x)=\\sum_{n=1}^\\infty c_n \\sin\\left( \\frac{n\\pi}{L} x \\right) $$\n",
        "\n",
        "Now the problem becomes how to find the coefficients $c_n$. $\\,$This is actually very easy \n",
        "\n",
        "* One uses properties of the functions known as orthogonality:\n",
        "\n",
        "  $$ \\int_0^L \\sin\\left(\\frac{m\\pi}{L} x \\right)\\sin\\left(\\frac{n\\pi}{L}x \\right)\\,dx = \n",
        "\\begin{cases} 0 &  m\\neq n \\\\ \\frac{L}{2} & m=n \\end{cases}$$\n",
        "\n",
        "  We multiply each side of @eq-Heat_02 by $\\sin(m\\pi x/L)$ and integrate from zero to $L$; $\\,$we get\n",
        "\n",
        "  $$ \\int_0^L \\phi(x) \\sin \\left( \\frac{m\\pi}{L} x\\right)\\, dx=c_m\\int_0^L \\sin^2\\left( \\frac{m\\pi}{L} x\\right)\\,dx = \\frac{L}{2}c_m $$\n",
        "\n",
        "  We're done; $\\,$the solution is\n",
        "\n",
        "  $$ u(x,t)=\\sum_{n=1}^\\infty c_n e^{-\\alpha\\left(\\frac{n\\pi}{L}\\right)^2 t} \\sin\\left( \\frac{n\\pi}{L}x \\right)\\;\\;\\text{ where }\\; c_n =\\frac{2}{L} \\int_0^L \\phi(x) \\sin \\left( \\frac{n\\pi}{L} x\\right)\\, dx $$\n",
        "\n",
        "**NOTES**\n",
        "\n",
        "* Observe that the only difference between the Fourier sine expansion of $\\phi(x)$ and the solution is the insertion of the time factor\n",
        "\n",
        "  $$ e^{-\\alpha\\left(\\frac{n\\pi}{L}\\right)^2 t} $$\n",
        "\n",
        "  in each term\n",
        "  \n",
        "* The terms in the series get small very fast due to the factor $e^{-\\alpha\\left(\\frac{n\\pi}{L}\\right)^2 t}$. $\\,$Hence, for long time periods,\n",
        "  $\\,$the solution is approximately equal to the first term\n",
        "  \n",
        "  $$ u(x,t)\\approx c_1 e^{-\\alpha\\left(\\frac{\\pi}{L}\\right)^2 t} \\sin\\left( \\frac{\\pi}{L}x \\right) $$\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Solve the diffusion problem with insulated boundaries; $\\,$ that is\n",
        "\n",
        "$$\\begin{aligned}\n",
        "    u_t & = u_{xx} && 0 < x < 1,\\; 0 < t < \\infty\\\\\n",
        "    u_x(0,t) & = 0 && 0 < t <\\infty\\\\\n",
        "    u_x(1,t) & = 0 && \\\\\n",
        "    u(x,0) & = 1 + \\cos\\pi x +0.5\\cos 3\\pi x && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "## Transforming Nonhomogeneous BCs into Homogeneous Ones {#sec-x1-6}\n",
        "\n",
        "* Consider heat flow in an insulated rod where the two ends are kept at constant temperatures $k_1$ and $k_2$:\n",
        "\n",
        "  $$\\begin{array} {r} u(0,t) = k_1\\\\ u(L,t) = k_2 \\end{array}, \\qquad\\quad 0<t<\\infty$$ {#eq-Heat_nh} \n",
        "\n",
        "* The difficulty here is that since the BCs are not homogeneous, $\\,$we cannot solve this problem by separation of variables\n",
        "\n",
        "* However, $\\,$it is obvious that the solution will have a steady-state solution (when $t=\\infty$) that varies linearly between the boundary temperatures $k_1$ and $k_2$\n",
        "\n",
        "  ![](figures/pde01_figure07.jpg \"nonhomogeneous BCa\"){width=\"70%\" fig-align=\"center\"}\n",
        "\n",
        "* In other words, $\\,$it seems reasonable to think of our temperature $u(x,t)$ as the sum of two parts\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u(x,t) &=\\underbrace{\\text{steady state}}_{\\text{Eventual Solution for Large Time}} \n",
        "        +\\underbrace{\\text{transient}}_{\\underset{\\text{(and will go to zero)}}{\\text{Part of the Solution that depends on the IC}}}\\\\ \n",
        "        &\\Downarrow \\\\ \n",
        "        &= \\left[ k_1 +\\frac{x}{L}(k_2 -k_1) \\right] +U(x,t)\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* By substituting the above relation in the original problem @eq-Heat_nh, $\\text{ }$we arrive at a new problem in $U(x,t)$:\n",
        "\n",
        "  $${U_t = \\alpha U_{xx},\\quad 0 < x < L,\\; 0 < t < \\infty} $$\n",
        "\n",
        "  $${\\scriptsize\\color{blue}{\\begin{array}{r}\n",
        "    U(0,t)=0 \\\\ \n",
        "    U(L,t)=0 \n",
        "  \\end{array}, \\;\\; 0<t<\\infty}, \\;\\;\n",
        "  U(x,0)=\\phi(x)\n",
        "  -\\left[ k_1 +\\displaystyle\\frac{x}{L}(k_2 -k_1) \\right]\n",
        "  =\\bar{\\phi}(x), \\;\\; 0\\leq x \\leq L}$$\n",
        "\n",
        "* **Transforming Time Varying BCs to Zero BCs**\n",
        "\n",
        "  * What about more realistic-type derivative BCs with time-varying right-hand sides? Consider the typical problem\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      u_t &= \\alpha u_{xx} && 0 < x < L, \\;0 < t <\\infty \\\\\n",
        "      u(0,t) &= g_1(t) && 0 < t < \\infty \\\\\n",
        "      u_x(L,t) +hu(L,t) &= g_2(t) && \\\\\n",
        "      u(x,0) &=\\phi(x) && 0 \\leq x \\leq L \n",
        "    \\end{aligned}$$ {#eq-Heat_nh2}\n",
        "\n",
        "  * To change these nonezero BCs to homogeneous ones, $\\,$we (after some trial and error) seek a solution of the form:\n",
        "\n",
        "    $$ u(x,t)=\\underbrace{A(t)\\left[1-\\frac{x}{L}\\right] +B(t)\\frac{x}{L}}_{S(x,t)}+U(x,t)$$\n",
        "\n",
        "    where $A(t)$ and $B(t)$ are chosen so that $S(x,t)$ satisfies the BCs and thus\n",
        "\n",
        "    $$\\begin{array}{r} U(0,t) = 0\\\\ U_x(L,t)+hU(L,t) = 0 \\end{array}, \\quad 0<t<\\infty$$\n",
        "\n",
        "  * Substituting $S(x,t)$ into the BCs gives\n",
        "\n",
        "    $$ \\begin{aligned} \n",
        "        S(0,t) &= g_1(t)\\\\ \n",
        "        S_x(L,t)+hS(L,t) &= g_2(t) \n",
        "      \\end{aligned}, \\quad 0<t<\\infty $$\n",
        "\n",
        "    in which we get\n",
        "\n",
        "    $$\\begin{aligned} \n",
        "       A(t)&= g_1(t)\\\\ \n",
        "       B(t)&= \\frac{g_1(t) +Lg_2(t)}{1+Lh} \n",
        "      \\end{aligned}, \\quad 0<t<\\infty$$\n",
        "\n",
        "  * So if we substitute this into the original problem @eq-Heat_nh2, $\\,$we get the transformed problem in $U(x,t)$:\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      U_t &= \\alpha U_{xx} -\\color{red}{S_t} && 0 < x <L, \\;0 < t <\\infty \\\\\n",
        "      U(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "      U_x(L,t) +hU(L,t) &= 0 && \\\\\n",
        "      U(x,0) &= \\phi(x)-S(x,0) && 0 \\leq x \\leq L\n",
        "    \\end{aligned}$$\n",
        "\n",
        "    * We now have our new problem with zero BCs but unfortunately the PDE is nonhomogeneous\n",
        "\n",
        "    * We cannot solve this problem by separation of variables, $\\,$but we will solve it  by integral transforms and eigenfuction expansions\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Solve the initial-boundary-value problem\n",
        "\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 1 && 0 < t < \\infty\\\\ \n",
        "    u_x(1,t) +hu(1,t) &= 1 && \\\\\n",
        "    u(x,0) &= \\sin\\pi x +x && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "## Solving More Complicated Problems by Separation of Variables {#sec-x1-7}\n",
        "\n",
        "* We start with a one-dimensional heat-flow problem where one of the BCs contains derivatives\n",
        "\n",
        "* **Heat-Flow Problem with 3^rd^ kind BC**\n",
        "\n",
        "  ![](figures/pde01_figure08.jpg \"Heat-Flow Problem with 3^rd^ kind BC\"){width=\"60%\" fig-align=\"center\"}\n",
        "\n",
        "* We fix the temperature at the top of the rod at $u(0,t)=0$ and immerse the bottom of the rod in a solution of water fixed at the same temperature of zero. The natural flow of heat says that the BC at $x=1$ is\n",
        "\n",
        "  $$u_x(1,t)=-hu(1,t)$$\n",
        "\n",
        "* Suppose now the initial temperature of the rod is $u(x,0)=x,$ $\\,$but instantaneously thereafter ($t>0$), $\\,$we apply our BCs. To find the ensuing temperature, $\\,$we must solve the IBVP\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u_x(1,t) +hu(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= x && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "**STEP 1**\n",
        "\n",
        "* Substituting $u(x,t)=X(x)T(t)$ into the PDE gives\n",
        "\n",
        "  $$u(x,t)=e^{-\\alpha\\lambda t} \\left[ A\\sin\\sqrt{\\lambda}x +B\\cos\\sqrt{\\lambda}x \\right]$$\n",
        "\n",
        "  for any $\\lambda>0$ and any $A$ and $B$\n",
        "\n",
        "**STEP 2**\n",
        "\n",
        "* Substituting the solution into the BCs gives us conditions on $\\lambda$, $A$ and $B$ $\\,$that must be satisfied;\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "   B e^{-\\alpha\\lambda t}&= 0\\; \\Rightarrow \\; B=0 \\\\ \n",
        "   A e^{-\\alpha\\lambda t}(\\sqrt{\\lambda} \\cos \\sqrt{\\lambda} \n",
        "    +h\\sin\\sqrt{\\lambda})&= 0 \\;\\Rightarrow \\; \\tan \\sqrt{\\lambda}\n",
        "    =-\\frac{\\sqrt{\\lambda}}{h}, \\; A \\neq 0\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* To find $\\lambda$, $\\,$we must find the intersections of the curves $\\tan\\sqrt{\\lambda}$ and $-\\frac{\\sqrt{\\lambda}}{h}$. $\\,$These values $\\lambda_1$, $\\lambda_2$, $\\cdots$ $\\,$can be computed numerically for a given $h$ and are called the **eigenvalues** of the boundary-value problem\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   X''+\\lambda X &= 0 \\\\ \n",
        "   X(0)&=0 \\\\ \n",
        "   X'(1)+hX(1)&=0 \n",
        "  \\end{aligned}$$ {#eq-Heat_complex}\n",
        "\n",
        "  The eigenvalue problem @eq-Heat_complex is a special case of the general **Sturm-Liouville problem**\n",
        "\n",
        "$~$"
      ],
      "id": "6a8fcece"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import numpy as np\n",
        "from scipy import optimize\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "plt.rcParams['font.size'] = 12\n",
        "plt.rcParams['xtick.direction'] = 'in'\n",
        "plt.rcParams['ytick.direction'] = 'in'\n",
        "plt.rcParams['text.usetex'] = True\n",
        "plt.rcParams['text.latex.preamble'] = r'\\usepackage{amsmath}'\n",
        "\n",
        "def example_plot(h, n_eig, sqrt_eig):\n",
        "    \n",
        "    x = np.linspace(0, n_eig*np.pi, 1000)  \n",
        "    y = np.tan(x)\n",
        "\n",
        "    threshold = 100\n",
        "    y[y > threshold] = np.inf\n",
        "    y[y <-threshold] = np.inf\n",
        "\n",
        "    plt.figure(figsize=(7, 4))\n",
        "\n",
        "    plt.plot(x, y, linewidth=1.2, color=\"blue\")\n",
        "    plt.plot(x,-x, linewidth=1.2, color=\"green\")\n",
        "    plt.scatter(sqrt_eig,-sqrt_eig, color='red')\n",
        "    \n",
        "    plt.xticks([0, np.pi, 2*np.pi, 3*np.pi, 4*np.pi, 5*np.pi], \n",
        "            ['0',r'$\\pi$',r'$2\\pi$',r'$3\\pi$',r'$4\\pi$',r'$5\\pi$'])\n",
        "    plt.xlim(0, 5.0*np.pi)\n",
        "    plt.ylim(-20, 20)\n",
        "    \n",
        "    plt.xlabel(r'$\\sqrt{\\lambda}/h$')\n",
        "    plt.ylabel(r'$\\\\tan \\sqrt{\\lambda}$, $-\\sqrt{\\lambda}/h$')\n",
        "    plt.title(r'$h=%3.1f$' % h)\n",
        "    plt.grid()\n",
        "    \n",
        "    plt.show()"
      ],
      "id": "0ad12e12",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-eigenvalues\n",
        "#| fig-cap: Eigenvalues\n",
        "#| fig-align: center\n",
        "\n",
        "def calc_eig(h, n_eig):\n",
        "    return np.array([optimize.brentq(lambda x: np.tan(x) +x/h, \n",
        "      (i +0.5001)*np.pi, (i +1)*np.pi) for i in range(n_eig)])\n",
        "\n",
        "h = 1\n",
        "n_eig = 5\n",
        "\n",
        "sqrt_eig = calc_eig(h, n_eig)\n",
        "example_plot(h, n_eig, sqrt_eig)"
      ],
      "id": "fig-eigenvalues",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| output: asis\n",
        "for i in range(n_eig):\n",
        "  print(rf'$$ \\lambda_{i +1} = {np.round(sqrt_eig[i], 2)} $$')"
      ],
      "id": "53c00574",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "* The solutions of @eq-Heat_complex corresponding to the eigenvalues $\\lambda_n$ are called **eigenfunctions** $X_n(x)$\n",
        "\n",
        "  $$ X_n(x)=\\sin\\sqrt{\\lambda_n} x $$\n",
        "\n",
        "$~$"
      ],
      "id": "0b7416dc"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "def example_plot2(x, n_eig, sqrt_eig, eigfunc):\n",
        "\n",
        "    plt.figure(figsize=(7, 4))\n",
        "    for n in range(n_eig):\n",
        "        plt.plot(x, eigfunc(x, sqrt_eig[n]), label=rf'$X_{n +1}(x)$')\n",
        "     \n",
        "    plt.xlim(0, 1)\n",
        "    plt.ylim(-1.2, 1.2)\n",
        "    plt.grid(ls=':')    \n",
        "    plt.legend(loc='upper left', bbox_to_anchor=(0, -0.1))\n",
        "    \n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$X_n(x)$')\n",
        "    plt.title(r'$X_n(x)=\\sin\\sqrt{\\lambda_n} x$')\n",
        "    \n",
        "    plt.show()"
      ],
      "id": "05e43515",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-eigenfunctions\n",
        "#| fig-cap: Eigenfunctions\n",
        "#| fig-align: center\n",
        "def eigfunc(x, sqrt_eig):  \n",
        "    return np.sin(sqrt_eig *x)\n",
        "\n",
        "x = np.linspace(0, 1, 150)\n",
        "example_plot2(x, n_eig, sqrt_eig, eigfunc)"
      ],
      "id": "fig-eigenfunctions",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "**STEP 3**\n",
        "\n",
        "* We now have an infinite number of solutions\n",
        "\n",
        "  $$u_n(x,t)=e^{-\\alpha\\lambda_n t} \\sin\\sqrt{\\lambda_n}x$$\n",
        "\n",
        "  each one satisfying the PDE and the BCs. $\\,$The final step is to add these functions together (the sum will still satisfy the PDE and BCs, since both the PDE and BCs are linear and homogeneous) \n",
        "\n",
        "  $$ u(x,t)=\\sum_{n=1}^\\infty c_n e^{-\\alpha\\lambda_n t} \\sin\\sqrt{\\lambda_n}x $$\n",
        "\n",
        "  in such a way that they agree with the IC\n",
        "\n",
        "  $$ u(x,0)=x=\\sum_{n=1}^\\infty c_n \\sin\\sqrt{\\lambda_n}x $$\n",
        "\n",
        "* To find the coefficients $c_n$, $\\,$we must multiply each side of the equation by $\\sin\\sqrt{\\lambda_m}x$ and integrate $x$ from $0$ to $1$\n",
        "\n",
        "  $${\\scriptsize\n",
        "  \\begin{aligned}\n",
        "   \\int_0^1 x\\sin\\sqrt{\\lambda_m}x\\,dx&= \\sum_{n=1}^\\infty c_n \\int_0^1 \\sin\\sqrt{\\lambda_n}x\\,\\sin\\sqrt{\\lambda_m}x \\,dx\\\\ \n",
        "   &\\Downarrow \\\\ \n",
        "   \\frac{\\sin\\sqrt{\\lambda_m}-\\sqrt{\\lambda_m}\\cos\\sqrt{\\lambda_m}}{\\lambda_m}&=c_m \\int_0^1 \\sin^2\\sqrt{\\lambda_m}x\\,dx =c_m\\left[ \\frac{\\sqrt{\\lambda_m}-\\sin\\sqrt{\\lambda_m}\\cos\\sqrt{\\lambda_m}}{2\\sqrt{\\lambda_m}} \\right ] \\\\\n",
        "   &\\Downarrow\\\\\n",
        "   c_n&=\\frac{2}{\\sqrt{\\lambda_n}} \\left[\\frac{\\sin\\sqrt{\\lambda_n} -\\sqrt{\\lambda_n}\\cos\\sqrt{\\lambda_n}}{\\sqrt{\\lambda_n}-\\sin\\sqrt{\\lambda_n}\\cos\\sqrt{\\lambda_n}} \\right]\n",
        " \\end{aligned}}$$\n",
        "\n",
        "  In this problem, $\\,$the first five constants $c_n$ have been computed:"
      ],
      "id": "1b78a2b4"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: true\n",
        "#| output: asis\n",
        "def cal_c_n(sqrt_eig):  \n",
        "    \n",
        "    sin_sqrt_eig = np.sin(sqrt_eig)\n",
        "    cos_sqrt_eig = np.cos(sqrt_eig)\n",
        "    \n",
        "    return (2.0 /sqrt_eig \n",
        "           *(sin_sqrt_eig -sqrt_eig *cos_sqrt_eig)\n",
        "           /(sqrt_eig -sin_sqrt_eig *cos_sqrt_eig))\n",
        "\n",
        "c_n = cal_c_n(sqrt_eig)\n",
        "print('$,\\;\\;$'.join([rf'$c_{i} = {c_i: 6.4f}$' \n",
        "              for i, c_i in enumerate(c_n, 1)]))"
      ],
      "id": "697cbeea",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "def example_plot3(alpha, t, x, n_eig, sqrt_eig, eigfunc, u_solution):\n",
        "    plt.figure(figsize=(7, 4))\n",
        "    plt.plot(x, x, 'r:', label='$t=0.0$')\n",
        "    for tt in t:\n",
        "        plt.plot(x, u_solution(alpha, tt, x, n_eig, sqrt_eig, eigfunc),\n",
        "                 label='$t=%0.1f$' % tt)\n",
        "    \n",
        "    plt.xlim(0, 1)\n",
        "    plt.ylim(0, 1)\n",
        "    plt.legend(loc='upper left')\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    \n",
        "    plt.show() "
      ],
      "id": "27ca1f51",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: true\n",
        "#| fig-align: center\n",
        "#| label: fig-u\n",
        "#| fig-cap: Solutions\n",
        "def u_solution(alpha, t, x, n_eig, sqrt_eig, eigfunc):\n",
        "    u = 0\n",
        "    for i in range(n_eig):\n",
        "        u += c_n[i] *np.exp(-alpha *sqrt_eig[i]**2 *t) \\\n",
        "                    *eigfunc(x, sqrt_eig[i])\n",
        "    return u    \n",
        "        \n",
        "alpha = 1\n",
        "t = np.linspace(0.1, 0.5, 4)\n",
        "example_plot3(alpha, t, x, n_eig, sqrt_eig, eigfunc, u_solution)"
      ],
      "id": "fig-u",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Transforming Hard Equations into Easier Ones {#sec-x1-8}\n",
        "\n",
        "![](figures/pde01_figure09.jpg \"heat flow with lateral heat loss\"){width=\"75%\" fig-align=\"center\"}\n",
        "\n",
        "* Consider the following problem:\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} \\color{blue}{-\\beta u} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= \\phi(x) && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$ {#eq-Heat_lateral}\n",
        "\n",
        "  where the term $-\\beta u$ represents heat flow across the lateral boundary\n",
        "\n",
        "* We introduce a new temperature $w(x,t)$ in place of $u(x,t)$, $\\,$so that the PDE in $w$ is simpler than the original one\n",
        "\n",
        "* The transformation is generally based on an intuitive feeling of how the solution of the original PDE behaves\n",
        "\n",
        "* In our problem @eq-Heat_lateral, $\\,$the temperature $u(x,t)$ at any point $x_0$ is changing as a result of two phenomena\n",
        "\n",
        "  1. **diffusion** of heat within the rod due to $\\alpha u_{xx}$\n",
        "  2. **heat flow** across the lateral boundary due to $-\\beta u$\n",
        "\n",
        "* The important point is that if there were no diffusion within the rod ($\\alpha=0$) then the temperature at each point $x_0$ would\n",
        "dump exponentially to zero according to \n",
        "\n",
        "  $$u(x_0,t)=u(x_0,0) e^{-\\beta t}$$\n",
        "\n",
        "* By means of this observation, $\\,$we can essentially decompose the temperature $u(x,t)$ into two factors\n",
        "\n",
        "  $$u(x,t)=e^{-\\beta t} w(x,t)$$\n",
        "\n",
        "  where $w(x,t)$ would represent the temperature due to diffusion only\n",
        "\n",
        "* When we substitute this expression into @eq-Heat_lateral, $\\,$we arrive at\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    w_t &= \\alpha w_{xx} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    w(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    w(1,t) &= 0 && \\\\\n",
        "    w(x,0) &= \\phi(x) && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* The diffusion-convection equation\n",
        "\n",
        "  $$u_t=\\alpha u_{xx}-vu_x$$\n",
        "  \n",
        "  ($v$ is a constant) can also be transformed to\n",
        "  \n",
        "  $$w_t=\\alpha w_{xx}$$\n",
        "  \n",
        "  In this case, $\\,$the transformation is\n",
        "  \n",
        "  $$ u(x,t)=\\exp\\left[ \\frac{v}{2\\alpha} \\left(x -\\frac{v}{2}t\\right) \\right] w(x,t)$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$ Solve the diffusion-convection problem\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} -u_x && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= e^{x/2} && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "by transforming it into an easier one\n",
        "\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    w_t &= w_{xx} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    w(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    w(1,t) &= 0 && \\\\\n",
        "    w(x,0) &= 1 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "$$\\begin{aligned}\n",
        " u(x,t)&=\\exp\\left[ \\frac{1}{2}\\left( x -\\frac{1}{2}t \\right ) \\right] w(x,t) \\\\ \n",
        " &\\Downarrow \\\\ \n",
        " w_t=w_{xx},\\; w(0,t)&=0,\\;w(1,t)=0,\\;w(x,0)=1 \\\\\n",
        " &\\Downarrow \\\\\n",
        " w(x,t)&=2\\sum_{n=1}^\\infty \\frac{1-(-1)^n}{n\\pi} e^{-n^2\\pi^2 t}\\sin n\\pi x \\\\\n",
        " &\\Downarrow \\\\\n",
        " u(x,t)&= 2\\sum_{n=1}^\\infty \\frac{1-(-1)^n}{n\\pi} e^{-n^2\\pi^2 t +\\frac{1}{2}\\left( x-\\frac{1}{2}t \\right )}\\sin n\\pi x \\\\\n",
        " &=4\\sum_{m=1}^\\infty \\frac{1}{(2m-1)\\pi} e^{-(2m-1)^2\\pi^2 t +\\frac{1}{2}\\left( x-\\frac{1}{2}t \\right )}\\sin (2m-1)\\pi x    \n",
        "\\end{aligned}$$\n",
        "\n",
        "$~$"
      ],
      "id": "fc018a6a"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "def example_plot4(t, x, n_terms, u_solution):   \n",
        "    plt.figure(figsize=(6, 4))   \n",
        "    plt.plot(x, np.exp(x /2.0), 'r:', label='$t=0$')\n",
        "   \n",
        "    for tt in t:\n",
        "        plt.plot(x, u_solution(tt, x, n_terms), label='$t=%0.3f$' % tt)\n",
        "    \n",
        "    plt.xlim(0, 1)\n",
        "    plt.ylim(0, 2)\n",
        "    plt.legend(loc='upper left', bbox_to_anchor=(1.0, 1.0))\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    plt.title(r'$\\alpha=1,\\;v=1$') \n",
        "\n",
        "    plt.show() "
      ],
      "id": "48be77ad",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| fig-align: center\n",
        "#| label: fig-u2\n",
        "#| fig-cap: Solutions\n",
        "def u_solution(t, x, n_terms):  \n",
        "    u = 0\n",
        "    for m in range(1, n_terms +1):\n",
        "        a = (2.0 *m -1.0) *np.pi\n",
        "        u += 1 /a *np.exp(-a *a *t +(x -t /2.0) /2.0) *np.sin(a *x)\n",
        "    return 4.0*u\n",
        "\n",
        "x = np.linspace(0, 1, 150)\n",
        "t = np.array([0.001, 0.002, 0.004, 0.008, 0.05, 0.10, 0.15, 0.20])\n",
        "\n",
        "n_terms = 25\n",
        "\n",
        "example_plot4(t, x, n_terms, u_solution)"
      ],
      "id": "fig-u2",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "## Solving Nonhomogeneous PDEs (Eigenfunction Expansion) {#sec-x1-9}\n",
        "\n",
        "* Consider the nonhomogeneous problem\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} +f(x,t) && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= \\phi(x) && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$ {#eq-Heat_ee}\n",
        "\n",
        "  The purpose of this section is to solve this problem by a method that is analogous to the method of variation of parameters in ODEs \n",
        "and is known as the eigenfunction expansion\n",
        "\n",
        "**STEP 1**\n",
        "\n",
        "* The basic idea in this method is to decompose the heat source $f(x,t)$ into simple components\n",
        "\n",
        "  $$ f(x,t)=\\sum_{n=1}^\\infty f_n(t) X_n(x)$$\n",
        "\n",
        "  It turns out that the $X_n(x)$ are the **eigenfunctions of the Sturm-Liouville system** \n",
        "we get when solving the associated homogeneous system by separation of variables\n",
        "\n",
        "* In this case, $\\,$the Sturm-Liouville problem we find when separating variables is\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   &X'' +\\lambda X =0 \\\\ \n",
        "   &X(0)=0 \\\\ \n",
        "   &X(1)=0 \n",
        "  \\end{aligned}$$\n",
        "\n",
        "  and, $\\,$hence, $\\,$the $X_n(x)$ are\n",
        "\n",
        "  $$X_n(x)=\\sin n\\pi x,\\;n=1,2,3,\\cdots$$\n",
        "\n",
        "* Finally, $\\,$ to find the functions $\\,f_n(t)$, $\\,$we merely multiply each side of this equation by $\\sin m\\pi x\\,$ and integrate from zero to one:\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    \\int_0^1 f(x,t) \\sin m\\pi x \\,dx&= \\sum_{n=1}^\\infty f_n(t) \\int_0^1 \\sin m\\pi x\\, \\sin n\\pi x \\,dx=\\frac{1}{2}f_m(t)\\\\ \n",
        "    &\\Downarrow\\;{\\scriptsize\\text{changing}\\;m \\;\\text{to}\\; n} \\\\ \n",
        "    f_n(t)&=2\\int_0^1 f(x,t) \\sin n\\pi x\\, dx \n",
        "   \\end{aligned}$$\n",
        "\n",
        "**STEP 2**\n",
        "\n",
        "* The responses $u_n(x,t)=T_n(t) \\sin n\\pi x\\,$ to each of these individual components $\\,f_n(t)\\sin n\\pi x\\,$ are added to construct the solution of our problem:\n",
        "\n",
        "  $$ u(x,t)=\\sum_{n=1}^\\infty u_n(x,t)=\\sum_{n=1}^\\infty T_n(t) \\sin n\\pi x $$\n",
        "\n",
        "  Substituting $u(x,t)$ and $f(x,t)$ into @eq-Heat_ee gives us\n",
        "\n",
        "  $${\\scriptsize\n",
        "  \\begin{aligned}\n",
        "    \\sum_{n=1}^\\infty T_n'(t) \\sin n\\pi x&=-\\alpha \\sum_{n=1}^\\infty (n\\pi)^2\\, T_n(t) \\sin  n\\pi x +\\sum_{n=1}^\\infty f_n(t) \\sin n\\pi x \\\\ \n",
        "    \\sum_{n=1}^\\infty T_n(0)\\sin n\\pi x&=\\phi(x) \\\\ \n",
        "    &\\Downarrow \\\\\n",
        "     \\sum_{n=1}^\\infty\\underbrace{\\left[ T_n'+\\alpha(n\\pi)^2\\,T_n -f_n(t) \\right ]}_{=0}\\,&\\sin n\\pi x= 0 \\\\\n",
        "     T_n(0)=2\\int_0^1 \\phi(x)&\\sin n\\pi x\\,dx=a_n \\\\\n",
        "     &\\Downarrow \\\\\n",
        "     T_n(t)=a_n e^{-\\alpha(n\\pi)^2 t}&+\\int_0^t e^{-\\alpha(n\\pi)^2(t-\\tau)} f_n(\\tau)\\,d\\tau\n",
        "   \\end{aligned}}$$  \n",
        "\n",
        "  Hence, the solution of our problem @eq-Heat_ee is\n",
        "\n",
        "  $${\\scriptsize\n",
        "  \\begin{aligned}\n",
        "   u(x,t)&=\\sum_{n=1}^\\infty T_n(t) \\sin n\\pi x \n",
        "   =\\underbrace{\\sum_{n=1}^\\infty a_n e^{-\\alpha(n\\pi)^2 t}\\sin n\\pi x }_{\\text{Transient Part due to the IC}}+\\underbrace{\\sum_{n=1}^\\infty \\int_0^t e^{-\\alpha(n\\pi)^2(t-\\tau)} f_n(\\tau)\\,d\\tau \\cdot \\sin n\\pi x}_{\\text{Forcing Part due to}\\, f(x,t)} \n",
        "   \\end{aligned}}$$\n",
        "\n",
        "* The eigenfunctions $X_n(x)$ in the expansion change from problem to problem and depend on the PDE and BCs\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Find the solution\n",
        "\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} +\\sin\\sqrt{\\lambda_1} x && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u_x(1,t) +hu(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "where $\\lambda_1$ is the first root of the equation $\\,$ $\\tan\\sqrt{\\lambda}=-\\sqrt{\\lambda}$\n",
        "\n",
        "$~$\n",
        "\n",
        "## $~$The Finite Sine and Cosine Transforms {#sec-x1-10}\n",
        "\n",
        "* An integral transformation is merely a transformation that assigns to one function $f(t)$ a new function $F(s)$ by means of a formula like\n",
        "\n",
        "  $$ F(s)=\\int_a^b K(s,t) \\,f(t)\\,dt $$\n",
        "\n",
        "  Note that we start with a function of $t$ and end with a function of $s$\n",
        "\n",
        "* The function $K(s,t)$ is called the **kernel** of the transformation and is\n",
        "the major ingredient that distinguishes one transform from another; $\\,$ it is chosen so that the transform has certain desirable properties. The limits $a$ and $b$ also change from transformation to transformation\n",
        "\n",
        "* With every integral transform, there is an inverse transform that will reproduce that original function from its transform. $\\,$The transform and its inverse together form what is called **a transform pair**\n",
        "\n",
        "* The general philosophy behind integral transformation is that they eliminate *partial derivatives* with respect to one of the variables; $\\,$hence, $\\,$the new equation has one less variable\n",
        "\n",
        "* In other words, integral transformations change problems into easier ones. $\\,$The transformed problem is then solved, and its inverse is obtained to find the solution to the original problem\n",
        "\n",
        "![](figures/pde01_figure10.jpg \"general philosopy of tranforms\"){width=\"90%\" fig-align=\"center\"}\n",
        "\n",
        "* We first start with a function $f(x)$ defined on an interval $[0,L]$. $\\,$The finite sine and cosine transforms of this function are defined by\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   \\mathcal{F}_s[f]&=\\frac{2}{L} \\int_0^L f(x)\\,\\sin\\frac{n\\pi x}{L} \\,dx =b_n &&\\;{\\scriptsize\\text{Finite Sine Transform}} \\\\[8pt] \n",
        "   \\mathcal{F}_c[f]&=\\frac{2}{L} \\int_0^L f(x)\\,\\cos\\frac{n\\pi x}{L} \\,dx =a_n &&\\;{\\scriptsize\\text{Finite Cosine Transform}}\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* The student will note that these transforms do nothing more than transform a function into the Fourier sine and cosine coefficients. $\\,$The inverse transform of these transforms are the Fourier sine and cosine series\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    f(x) &=\\sum_{n=1}^{\\infty} b_n \\sin\\frac{n\\pi x}{L} &&\\;{\\scriptsize\\text{Inverse Sine Transform}} \\\\ \n",
        "    f(x) &= \\frac{a_0}{2} +\\sum_{n=1}^\\infty a_n \\cos \\frac{n\\pi x}{L} &&\\;{\\scriptsize\\text{Inverse Cosine Transform}}\n",
        "    \\end{aligned}$$\n",
        "\n",
        "  Note that the summation in the inverse cosine starts at $n=0$, $\\,$while the inverse sine starts at $n=1$\n",
        "\n",
        "$~$\n",
        "\n",
        "**Examples of the Sine Transform**\n",
        "\n",
        "$$\\begin{aligned}\n",
        "   f(x)&=1, \\;\\;\\;\\; 0 \\leq x \\leq 1 \\\\ \n",
        "   &\\Downarrow \\\\ \n",
        "   \\scriptsize b_n=2 \\int_0^1 \\sin n\\pi x \\,dx &\\scriptsize=\n",
        "   \\begin{cases}\n",
        "     \\;\\;\\;\\;0& n\\; \\text{ even} \\\\ \n",
        "     \\;^{\\displaystyle 4}/_{\\displaystyle n\\pi}& n\\; \\text{ odd }  \n",
        "   \\end{cases} \\\\\n",
        "   &\\Downarrow \\\\\n",
        "   f(x)&=\\frac{4}{\\pi} \\sum_{n=1}^\\infty \\left[ \\frac{1}{2n-1} \\right] \\sin (2n-1)\\pi x\n",
        "  \\end{aligned}$$\n",
        "\n",
        "![](figures/pde02_figure21.jpg \"Finite Sine Transform\"){width=\"65%\" fig-align=\"center\"}\n",
        "\n",
        "$~$\n",
        "\n",
        "* **Properties of the Finite Sine and Cosine Transforms**\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    \\mathcal{F}_s [u_t] \n",
        "       &= \\frac{d \\mathcal{F}_s [u]}{dt} \\\\ \n",
        "    \\mathcal{F}_s [u_{tt}] \n",
        "       &= \\frac{d^2 \\mathcal{F}_s [u]}{dt^2} \\\\ \\\\ \n",
        "    \\mathcal{F}_s [u_x] \n",
        "       &= -\\frac{n\\pi}{L} \\mathcal{F}_c [u] \\\\\n",
        "    \\color{red}{\\mathcal{F}_s [u_{xx}]} \n",
        "       &\\color{red}{\\:= -\\left( \\frac{n\\pi}{L} \\right)^2 \\mathcal{F}_s [u] +\\frac{2n\\pi}{L^2} \n",
        "     \\left[ u(0,t) -(-1)^n u(L,t) \\right]}\\\\ \n",
        "    \\mathcal{F}_c [u_x] \n",
        "       &= -\\frac{n\\pi}{L} \\mathcal{F}_s [u] +\\frac{2}{L} \\left[(-1)^n u(L,t) -u(0,t) \\right] \\\\ \n",
        "    \\color{red}{\\mathcal{F}_c [u_{xx}]} & \\color{red}{\\:= -\\left(\\frac{n\\pi}{L}\\right)^2 \\mathcal{F}_c [u] +\\frac{2}{L} \\left[(-1)^n u_x(L,t) -u_x(0,t) \\right]} \\\\ \n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Solve the general problem\n",
        "\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} -\\beta u +f(x,t) && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "## $~$Superposition (The Backbone of Linear Systems) {#sec-x1-11}\n",
        "\n",
        "* For an engineer who wishes to find the response $u$ to a linear system from input $\\,f$, $\\,$a common approach is\n",
        "\n",
        "  1.  Break $\\,f$ into elementary parts, $\\,f=\\sum f_k$\n",
        "  2.  Find the system response $u_k$ to $f_k$\n",
        "  3.  Add(superimpose) the simple responses $u_k$ to get $\\,u=\\sum u_k$\n",
        "\n",
        "* It turns out if the system is *linear*, $\\,$then the sum $u$ is the response we get if the function $\\,f$ were imputted directly; $\\,$this is the <font color=\"red\">**principle of superposition**</font>\n",
        "\n",
        "* **Superposition Used to Break an IBVP into Two Simpler Problems**\n",
        "\n",
        "  Suppose we have the linear problem\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} +\\color{red}{\\sin \\pi x} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= \\sin 2\\pi x && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}\\tag{P}\\label{eq:P}$$\n",
        "\n",
        "  Here, $\\,$we have an *nonhomogeneous* heat equation, $\\,$so separation of variables is not a viable method of attack\n",
        "\n",
        "  * We could, $\\,$of course, $\\,$use the finite sine transform on the variable $x$ or the Laplace transform on $t$, $\\,$but still another idea would be to consider two subproblems\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "     u_t \n",
        "      &= u_{xx} +\\color{red}{\\sin \\pi x} \n",
        "      && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "     u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "     u(1,t) &= 0 && \\\\\n",
        "     u(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "    \\end{aligned}\\tag{A}\\label{eq:A}$$\n",
        "\n",
        "    $$\\text{and} \\qquad\\qquad\\qquad$$\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      u_t &= u_{xx} && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "      u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "      u(1,t) &= 0 && \\\\\n",
        "      u(x,0) \n",
        "      &= \\color{red}{\\sin 2\\pi x} && 0 \\leq x \\leq 1\n",
        "    \\end{aligned}\\tag{B}\\label{eq:B}$$\n",
        "\n",
        "  * There two problems can be solved individually with a little effort, $\\,$and it should be clear here that the *sum* of the solutions to \\eqref{eq:A} and \\eqref{eq:B} is the solution to the original problem \\eqref{eq:P}; $\\,$that is\n",
        "\n",
        "    $$u(x,t)=\\underbrace{\\frac{1}{\\pi^2} (1 -e^{-\\pi^2 t}) \\sin\\pi x}_{\\text{Solution to \\eqref{eq:A}}} +\\underbrace{e^{-(2\\pi)^2 t} \\sin 2\\pi x}_{\\text{Solution to \\eqref{eq:B}}}$$\n",
        "\n",
        "* **<font color=\"blue\">Separation of Variables and Integral Transforms as Superpositions</font>**\n",
        "\n",
        "  * <font color=\"red\">In separation of variables</font>, $\\,$we generally break down the <font color=\"red\">initial conditions</font> into an infinite number of simple parts and find the response to each part. $\\,$We then sum these individual responses to find the solution to the problem\n",
        "\n",
        "  * On the other hand, $\\,$<font color=\"red\">integral transforms</font> also use superposition, $\\,$for instance, $\\,$let's show how the finite sine transform uses this principle. $\\,$Consider the nonhomogeneous heat equation\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "    u_t &= u_{xx} +f(x,t) && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 0 && \\\\\n",
        "    u(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "    \\end{aligned}$$\n",
        "\n",
        "    and its solution by use of the finite sine transform. $\\,$What we're really doing is resolving <font color=\"red\">the input $f(x,t)$</font> into components, $\\,$finding the response $U_n$ due to each component, $\\,$and adding these responses\n",
        "\n",
        "  $${\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} +f(x,t)\\\\ \n",
        "    &\\Downarrow\\,{\\scriptstyle \\text{finite sine transform,}} \\; {\\scriptstyle u(0,t) = u(1,t) =0} \\\\ \n",
        "    \\sum_{n=1}^\\infty &\\left[ U_n' +(n\\pi)^2 U_n -F_n(t) \\right] \\sin n\\pi x =0 \\\\\n",
        "    &\\Downarrow \\, {\\scriptstyle u(x,0)=0}\\\\\n",
        "    U_n'(t) &+(n\\pi)^2 U_n(t) =F_n(t), \\;\\;\n",
        "       U_n(0) =0\\;\\;\\;\\;n=1,2,3,\\cdots \\\\\n",
        "    &\\Downarrow \\\\\n",
        "    U_n(t) &= e^{-(n\\pi)^2 t} \\int_0^t e^{(n\\pi)^2 \\tau} F_n(\\tau) \\,d\\tau \n",
        "      = \\int_0^t e^{-(n\\pi)^2 (t -\\tau)} F_n(\\tau) \\,d\\tau\\\\\n",
        "    &\\Downarrow \\\\\n",
        "    u(x,t) &=\\sum_{n=1}^\\infty U_n(t) \\sin n\\pi x\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "**NOTES**\n",
        "\n",
        "In the finite sine transform, $\\,$the resolutions were infinite series, $\\,$whereas in most other integral transforms, $\\,$the resolutions are integrals (continuous resolutions)\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Find four initial-boundary-value problems whose solutions sum to the solution of the following problem:\n",
        "\n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} +f(x,t) && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= g_1(t) && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= g_2(t) && \\\\\n",
        "    u(x,0) &= \\pi(x) && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**Example** $\\,$Solve the problem\n",
        "  \n",
        "$$\n",
        "  \\begin{aligned}\n",
        "    u_t &= u_{xx} +\\sin 3\\pi x && 0 < x < 1, \\;0 < t <\\infty \\\\\n",
        "    u(0,t) &= 0 && 0 < t < \\infty\\\\ \n",
        "    u(1,t) &= 1 && \\\\\n",
        "    u(x,0) &= \\sin \\pi x && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "## $~$The Fourier Integral and Transform {#sec-x1-12}\n",
        "\n",
        "* An integral transformation can be thought of as a resolution of a function into a certain spectrum of components:\n",
        "\n",
        "* Let's consider the resolution of a periodic function $f(x)$ into Fourier series\n",
        "\n",
        "  $$ f(x)= \\frac{a_0}{2} +\\sum_{n=1}^\\infty \\left[ a_n\\cos \\frac{n\\pi x}{L} +b_n \\sin \\frac{n\\pi x}{L} \\right] $$\n",
        "\n",
        "* Here the coefficients $a_n$ and $b_n$ represent the amount of the function $f(x)$ made up $\\displaystyle\\cos \\frac{n\\pi x}{L}$ and $\\displaystyle\\sin \\frac{n\\pi x}{L}$, $\\,$respectively\n",
        "\n",
        "* While the square root\n",
        "\n",
        "  $$\\sqrt{a_n^2 +b_n^2}$$\n",
        "\n",
        "  (called the spectrum of the function) measures the amount of $\\,f(x)$ with frequency $\\displaystyle\\frac{n\\pi}{L}$\n",
        "\n",
        "* Functions that are *periodic* can be resolved into *infinite series* (they have discrete spectrums)\n",
        "\n",
        "* Of course, $\\,$if a function is defined only on a *finite interval*, $\\,$we could extend the function outside the interval in a periodic way, $\\,$so that a Fourier series representation could be obtained for the function inside the interval\n",
        "\n",
        "* <font color=\"red\">Whereas functions that are *not periodic* must be resolved into a *continuous spectrum* of values</font>\n",
        "\n",
        "* Although a nonperiodic function $f(x)$ cannot be represented by an infinite series of sines and cosines, $\\,$<font color=\"red\">we might write it as *continuous analog* of the Fourier series</font>:\n",
        "\n",
        "  $${\\scriptsize\n",
        "  \\begin{aligned}\n",
        "   f(x)&= \\frac{a_0}{2} +\\sum_{n=1}^\\infty \\left[ a_n\\cos \\frac{n\\pi x}{L} +b_n \\sin \\frac{n\\pi x}{L} \\right] \\\\ \n",
        "   &= {\\tiny \\frac{1}{2L} \\int_{-L}^L f(\\xi)\\,d\\xi +\\frac{1}{L}\n",
        "   \\sum_{n=1}^\\infty \\left[ \\left( \\int_{-L}^L f(\\xi) \\cos\\frac{n\\pi\\xi}{L}\\,d\\xi \\right) \\cos \\frac{n\\pi x}{L} \n",
        "   +\\left( \\int_{-L}^L f(\\xi) \\sin\\frac{n\\pi\\xi}{L}\\,d\\xi \\right) \\sin \\frac{n\\pi x}{L} \\right] }\\\\ \n",
        "   &\\Downarrow\\; {\\tiny \\omega_n =\\frac{n\\pi}{L}, \\;\\Delta\\omega=\\omega_{n+1} -\\omega_n=\\frac{\\pi}{L}}\\\\ \n",
        "   &= {\\tiny \\frac{1}{2\\pi} \\left( \\int_{-L}^L f(\\xi)\\,d\\xi\\right)\\Delta \\omega +\\frac{1}{\\pi}\n",
        "   \\sum_{n=1}^\\infty \\left[ \\left( \\int_{-L}^L f(\\xi) \\cos\\omega_n\\xi\\,d\\xi \\right) \\cos \\omega_n x \n",
        "   +\\left( \\int_{-L}^L f(\\xi) \\sin\\omega_n \\xi\\,d\\xi \\right) \\sin\\omega_n x \\right]\\Delta \\omega }\\\\  \n",
        "    &\\Downarrow\\;{\\tiny L \\to \\infty,\\;\\Delta \\omega \\to 0,\\; \\lim_{\\Delta\\omega \\to 0} \\sum_{n=1}^\\infty F(\\omega_n)\\,\\Delta\\omega=\\int_0^\\infty F(\\omega)\\,d\\omega }\\\\\n",
        "    \\color{red}{f(x)} \\,&\\color{red}{ =\\int_0^\\infty \\left[ a(\\omega) \\cos\\omega x +b(\\omega)\\sin\\omega x \\right]\\,d\\omega} \\\\\n",
        "    &\\color{blue}{a(\\omega)=\\frac{1}{\\pi} \\int_{-\\infty}^\\infty f(x)\\cos \\omega x\\, dx} \\\\\n",
        "    &\\color{blue}{b(\\omega)=\\frac{1}{\\pi} \\int_{-\\infty}^\\infty f(x)\\sin \\omega x\\, dx}\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "  where the functions $a(\\omega)$ and $b(\\omega)$ are known as <font color=\"red\">the Fourier cosine and sine transforms</font> and measure the cosine and sine component of $\\,f(x)$ and\n",
        "\n",
        "  $$\\color{red}{\\sqrt{a^2(\\omega) +b^2(\\omega)}}$$\n",
        "\n",
        "  measures the $\\omega$ frequency component of $f(x)$ and is called <font color=\"red\">the spectrum of $f(x)$</font>. $\\,$With this intutive explanation of the spectrum of a function, $\\,$we now get to the nuts and bolts of integral transforms\n",
        "\n",
        "* **The Exponential Fourier Transform**\n",
        "\n",
        "  We are now in a position to define what is generally known as the exponential Fourier transfrom:\n",
        "\n",
        "  $${\\scriptsize\n",
        "   \\begin{aligned}\n",
        "     f(x)\n",
        "     &=\\frac{1}{\\pi} \\int_0^\\infty \\int_{-\\infty}^\\infty f(\\xi)\\left[ \\cos\\omega\\xi \\cos\\omega x +\\sin\\omega \\xi \\sin\\omega x \\right]\\,d\\xi\\,d\\omega \\\\\n",
        "     &={\\scriptsize \\frac{1}{\\pi} \\int_0^\\infty \\int_{-\\infty}^\\infty f(\\xi) \\underbrace{\\color{blue}{\\cos\\omega(\\xi -x)}}_{\\cos\\omega(x-\\xi) \\; - \\;\\text{even function w.r.t. }\\omega } \\,d\\xi\\,d\\omega }\\\\\n",
        "     &{\\tiny = \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty \\int_{-\\infty}^\\infty f(\\xi) \\cos\\omega(x -\\xi) \\,d\\xi\\,d\\omega }\n",
        "    {\\tiny = \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty \\int_{-\\infty}^\\infty f(\\xi) \\left[ \\cos\\omega(x -\\xi) +\\color{blue}{i\\sin\\omega(x -\\xi)} \\right]\\,d\\xi\\,d\\omega }\\\\\n",
        "     &={\\scriptsize \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty \\int_{-\\infty}^\\infty f(\\xi) e^{i\\omega (x -\\xi)} \\,d\\xi\\,d\\omega }\\\\\n",
        "     &=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty \\left[ \\color{red}{\\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^\\infty f(\\xi) e^{-i\\omega \\xi} \\,d\\xi} \\right] \\,e^{i\\omega x}\\,d\\omega  \\\\\n",
        "   \\end{aligned}}$$\n",
        "\n",
        "$$\\begin{aligned}\n",
        "&\\Downarrow \\\\\n",
        " \\mathcal{F}[f(x)]&=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f(x) e^{-i\\omega x}\\,dx = F(\\omega) \\\\\n",
        " \\mathcal{F}^{-1}[F(\\omega)]&=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty F(\\omega) e^{i\\omega x}\\,d\\omega = f(x)\n",
        "\\end{aligned}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "## $~$The Fourier Transform and its Application to PDEs {#sec-x1-13}\n",
        "\n",
        "* The usefulness of the Fourier transform comes from the fact that <font color=\"green\">it changes the operation of differentiation into multiplication</font>; $\\,$that is, $\\,$partial differential equations are changed into ordinary differential equations\n",
        "\n",
        "  ![](figures/fourier2.jpg \"Fourier\"){width=\"35%\" fig-align=\"center\"}\n",
        "\n",
        "* <font color=\"blue\">**Useful Properties of the Fourier Transform**</font>\n",
        "\n",
        "  **Property 1** $\\,$Fourier Transform Pair\n",
        "\n",
        "  The Fourier transform of $\\;f(x), -\\infty <x <\\infty$, $\\,$produces a new function $F(\\omega)$:\n",
        "\n",
        "  $$ \\mathcal{F}[f(x)]=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f(x) e^{-i\\omega x}\\,dx = F(\\omega)$$\n",
        "\n",
        "  and the inverse Fourier transform of $F(\\omega), -\\infty<\\omega<\\infty$, $\\,$will produce the original function $f(x)$:\n",
        "\n",
        "  $$\\displaystyle \\mathcal{F}^{-1}[F(\\omega)]=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty F(\\omega) e^{i\\omega x}\\,d\\omega = f(x)$$\n",
        "\n",
        "  For example,\n",
        "\n",
        "  $${\\scriptsize e^{-|x|} \\overset{\\mathcal{F}}{\\longrightarrow} \\sqrt{\\frac{2}{\\pi}} \\frac{1}{1+\\omega^2} \\overset{\\mathcal{F}^{-1}}{\\longrightarrow} e^{-|x|} }$$\n",
        "\n",
        "  **Property 2** $\\,$Linear Transformation\n",
        "\n",
        "  $$ \\mathcal{F} [af(x) +bg(x)] = a\\mathcal{F}[f(x)] +b\\mathcal{F}[g(x)] $$\n",
        "\n",
        "  **Property 3** $\\,$Transformation of Partial Derivatives\n",
        "\n",
        "  $$ \\mathcal{F}[f_x]=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f_x e^{-i\\omega x}\\,dx = i\\omega \\mathcal{F}[f] $$\n",
        "\n",
        "  $$ \\mathcal{F}[f_{xx}]=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f_{xx} e^{-i\\omega x}\\,dx = -\\omega^2 \\mathcal{F}[f] $$\n",
        "\n",
        "  **Property 4** $\\,$Convolution Property\n",
        "\n",
        "  Every integral transform has what is called a convolution property. $\\,$The general idea is that the transform of a product of two functions $\\,f(x)g(x)\\,$ is not the product of the individual transforms:\n",
        "\n",
        "  $$ \\mathcal{F}[f(x)g(x)]\\neq\\mathcal{F}[f(x)]\\mathcal{F}[g(x)] $$\n",
        "\n",
        "  However, $\\,$in transform theory, $\\,$there is something called the **convolution** $\\,f*g\\,$ of two functions that more or less plays the role of the product:\n",
        "\n",
        "  $$ \\mathcal{F}[f*g]=\\mathcal{F}[f(x)]\\mathcal{F}[g(x)]$$\n",
        "\n",
        "  So what is this mysterious convolution $\\,f*g$? $\\,$It's given by formula\n",
        "\n",
        "  $$ (\\,f*g)(x)=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f(x -\\xi) g(\\xi)\\,d\\xi $$\n",
        "\n",
        "  The importance of the convolution in applications is due to the fact that quite often, $\\,$the final step in solving a PDE boils down to finding the inverse transform of some expression that we can interpret as the product of two transforms $\\mathcal{F}[f]\\mathcal{F}[g]$\n",
        "\n",
        "* **Solution of an Initial-Value Problem**\n",
        "\n",
        "  Consider the heat flow in an <font color=\"blue\">infinite</font> rod where the initial temperature is $\\,u(x,0)=\\phi(x)$\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &=\\alpha u_{xx} \n",
        "      &&\\; \\color{red}{-\\infty < x < \\infty}, \\;0 < t < \\infty \\\\\n",
        "    u(x,0) &=\\phi(x) &&-\\infty < x < \\infty\n",
        "  \\end{aligned}$$\n",
        "\n",
        "**STEP 1** $\\,$Transforming the Problem\n",
        "\n",
        "$$\\begin{aligned}\n",
        " \\mathcal{F}[u_t] &= \\alpha \\mathcal{F}[u_{xx}]\\\\ \n",
        " \\mathcal{F}[u(x,0)] &= \\mathcal{F} [\\phi(x)]\\\\ \n",
        " &\\Downarrow \\\\\n",
        " \\frac{dU(t)}{dt} &= -\\alpha\\omega^2 U(t)\\\\\n",
        " U(0)&=\\Phi(\\omega)\n",
        "\\end{aligned}$$\n",
        "\n",
        "**STEP 2** $\\,$Solving the Transformed Problem\n",
        "\n",
        "$$U(t)=\\Phi(\\omega) e^{-\\alpha \\omega^2 t}$$\n",
        "\n",
        "**STEP 3** $\\,$Finding the Inverse Transform\n",
        "\n",
        "$$\\begin{aligned}\n",
        " u(x,t)&= \\mathcal{F}^{-1}\\left[ \\Phi(\\omega) e^{-\\alpha\\omega^2 t} \\right]\\\\ \n",
        " &= \\mathcal{F}^{-1}\\left[ \\Phi(\\omega) \\right] * \\mathcal{F}^{-1}\\left[ e^{-\\alpha\\omega^2 t} \\right]\\\\ \n",
        " &= \\phi(x)*\\frac{1}{\\sqrt{2\\alpha t}} e^{-x^2/4\\alpha t}\\\\ \n",
        " &= \\frac{1}{2\\sqrt{\\alpha\\pi t}} \\int_{-\\infty}^{\\infty} \\phi(\\xi) e^{-(x -\\xi)^2/4\\alpha t} \\,d\\xi\n",
        "\\end{aligned}$$\n",
        "\n",
        "Note that the integrand is made up of two terms:\n",
        "\n",
        "1. $\\,$The initial temperature $\\phi(x)$  \n",
        "1. $\\,$the Green's function or impulse-response function \n",
        "\n",
        "$$ G(x-\\xi,t)=\\frac{1}{2\\sqrt{\\alpha\\pi t}}e^{-(x -\\xi)^2/4\\alpha t}, \\;\\;\\lim_{t\\to 0}G(x-\\xi,t) = \\underbrace{\\delta(x-\\xi)}_{\\text{Dirac delta function}}$$\n",
        "\n",
        "It can be shown that this impulse-response function $G(x-\\xi,t)$ $\\,$is the temperature response to an initial temperature impulse at $\\,x=\\xi$\n",
        "\n",
        "![](figures/pde01_figure12.png \"impulse response G(x-\\xi,t)\"){width=\"75%\" fig-align=\"center\"}\n",
        "\n",
        "<font color=\"blue\">Hence, $\\,$the interpretation of solution is that the initial temperature $\\,u(x,0)=\\phi(x)\\,$ is decomposed into a continuum of impulses of $\\,\\phi(\\xi)\\,$ at each point $x=\\xi$ and the resulting temperature $\\,\\phi(\\xi)G(x-\\xi,t)\\,$ is found.</font> <font color=\"red\">$\\,$These resulting temperatures are then added (integrated) to obtain the solution. This general idea is also superposition</font>\n",
        "\n",
        "$~$"
      ],
      "id": "00be19a6"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-impulse-response-function\n",
        "#| fig-cap: Impulse-response function\n",
        "#| fig-align: center\n",
        "def example_plot5(alpha, xi, t, x):\n",
        "\n",
        "    plt.figure(figsize=(7, 5))\n",
        "\n",
        "    for tt in t:\n",
        "      plt.plot(x, 0.5 /np.sqrt(alpha *np.pi *tt) \n",
        "            *np.exp(-(x -xi)**2 /(4.0 *alpha *tt)), \n",
        "          label=f'$t={tt:0.2f}$')\n",
        "    plt.legend(loc='upper right')          \n",
        "\n",
        "    plt.text(x[0] +1, 1.5, \n",
        "      r'$$G(x-\\xi,t)=\\frac{1}{2\\sqrt{\\alpha\\pi t}}'\n",
        "      r'e^{-(x-\\xi)^2/4\\alpha t}$$')\n",
        "\n",
        "    plt.xlim(x[0], x[-1])\n",
        "    plt.ylim(0, 2)\n",
        "\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel(r'$G(x-\\xi,t)$')\n",
        "\n",
        "    plt.title(rf'$\\alpha={alpha:2.1f}, \\;\\xi={xi:2.1f}$')\n",
        "\n",
        "    plt.show()\n",
        "\n",
        "alpha = 1\n",
        "xi = 0\n",
        "\n",
        "t = [0.05, 0.1, 0.2, 0.4, 0.8, 1.6, 3.2]\n",
        "x = np.linspace(-6, 6, 1000)\n",
        "\n",
        "example_plot5(alpha, xi, t, x) "
      ],
      "id": "fig-impulse-response-function",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "**NOTES**\n",
        "\n",
        "The major drawback of the Fourier transform is that all functions can not be transformed. $\\,$For example, $\\,$even simple functions like\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " f(x) &= \\text{constant} \\\\ \n",
        " f(x) &= e^x\\\\ \n",
        " f(x) &= \\sin x \n",
        "\\end{aligned}$$\n",
        "\n",
        "cannot be transformed, $\\,$since the integral\n",
        "\n",
        "$$\\mathcal{F}[f]=\\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^\\infty f(x) e^{-i\\omega x}\\,dx$$\n",
        "\n",
        "does not exist. $\\,$Only functions that damp to zero sufficiently fast as $|x| \\to\\infty$ have transforms\n",
        "\n",
        "## $~$Sine and Cosine Transforms {#sec-x1-14}\n",
        "\n",
        "* **Fourier Sine Transform Pair**\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    \\mathcal{F}_s\\left[ f(x) \\right]\n",
        "      &= \\frac{2}{\\pi} \\int_0^\\infty f(x) \\sin\\omega x\\,dx =F(\\omega) \\\\ \n",
        "    \\mathcal{F}_s^{-1} \\left[ F(\\omega) \\right ]\n",
        "      &= \\int_0^\\infty F(\\omega) \\sin\\omega x \\,d\\omega =f(x)\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* **Fourier Cosine Transform Pair**\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    \\mathcal{F}_c \\left[ f(x) \\right] &= \\frac{2}{\\pi} \n",
        "      \\int_0^\\infty f(x) \\cos\\omega x\\,dx =F(\\omega) \\\\ \n",
        "    \\mathcal{F}_c^{-1} \\left[ F(\\omega) \\right ]&= \n",
        "       \\int_0^\\infty F(\\omega) \\cos\\omega x \\,d\\omega =f(x)\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* The next step is to list a few properties of these transforms that make them work\n",
        "\n",
        "  $${\\scriptsize\n",
        "  \\begin{aligned}\n",
        "    \\mathcal{F}_s\\left[ f'(x) \\right]  \n",
        "      &= \\frac{2}{\\pi} \\int_0^\\infty f'(x) \n",
        "        \\sin\\omega x\\,dx\\\\ \n",
        "      &= \\left.\\frac{2}{\\pi} \\, f(x) \n",
        "        \\sin\\omega x \\,\\right|_0^\\infty \n",
        "       -\\omega\\frac{2}{\\pi}\\int_0^\\infty f(x) \n",
        "        \\cos\\omega x\\,dx \n",
        "       =-\\omega\\mathcal{F}_c\\left[ f(x) \\right]  \n",
        "      \\phantom{xxxxxxxxxx}\n",
        "  \\end{aligned}}$$\n",
        "  \n",
        "  $${\\scriptsize \n",
        "  \\begin{aligned}\n",
        "    \\mathcal{F}_c\\left[ f'(x) \\right] \n",
        "      &= \\frac{2}{\\pi} \\int_0^\\infty f'(x) \n",
        "       \\cos\\omega x\\,dx \\\\ \n",
        "      &= \\left.\\frac{2}{\\pi} \\, f(x) \n",
        "       \\cos\\omega x \\,\\right|_0^\\infty \n",
        "       +\\omega\\frac{2}{\\pi}\\int_0^\\infty f(x) \n",
        "        \\sin\\omega x\\,dx =-\\frac{2}{\\pi}\\,f(0) \n",
        "      +\\omega\\mathcal{F}_s\\left[ f(x) \\right] \n",
        "       \\phantom{xx}\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "  $${\\scriptsize \\begin{aligned}\n",
        "     \\color{red}{\\mathcal{F}_s\\left[ f''(x) \\right]} \n",
        "    &= \\frac{2}{\\pi} \\int_0^\\infty f''(x) \n",
        "     \\sin\\omega x\\,dx =\n",
        "    \\left.\\frac{2}{\\pi}f'(x) \\sin\\omega x \n",
        "     \\,\\right|_0^\\infty -\\omega\\frac{2} \n",
        "      {\\pi}\\int_0^\\infty f'(x) \\cos\\omega x\\,dx \\\\\n",
        "    &=\\color{red}{\\frac{2}{\\pi}\\omega \\,f(0)- \n",
        "     \\omega^2\\mathcal{F}_s\\left[ f(x) \\right]}\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "  $${\\scriptsize \\begin{aligned}\n",
        "    \\color{red}{\\mathcal{F}_c\\left[ f''(x) \\right]} \n",
        "    &= \\frac{2}{\\pi} \\int_0^\\infty f''(x) \n",
        "    \\cos\\omega x\\,dx =\\left.\\frac{2}{\\pi}f'(x) \n",
        "     \\cos\\omega x \\,\\right|_0^\\infty \n",
        "     +\\omega\\frac{2}{\\pi}\\int_0^\\infty f'(x) \n",
        "     \\sin\\omega x\\,dx \\\\ \n",
        "    &=\\color{red}{-\\frac{2}{\\pi} \\,f'(0) - \n",
        "     \\omega^2\\mathcal{F}_c\\left[ f(x) \\right]}\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "* **Solution of an Semi-infinite-Diffusion Problem via the Sine Transform**\n",
        "\n",
        "  The problem we are interested in is the *semi-infinite diffusion problem*\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "    u_t &= \\alpha u_{xx} \n",
        "     && \\color{red}{0<x<\\infty}, \\; 0 < t <\\infty \\\\ \n",
        "    \\color{red}{u(0,t)} & \\color{red}{\\;= A} \n",
        "     && 0 < t < \\infty \\\\ \n",
        "    u(x,0) &= 0 && 0 \\leq x < \\infty\n",
        "  \\end{aligned}$$\n",
        "\n",
        "  ![](figures/pde01_figure11.jpg \"diffusion problem in a semi-infinite medium\"){width=\"60%\" fig-align=\"center\"}\n",
        "\n",
        "  To solve this, $\\,$we break into three simple steps. $\\,$First our strategy is to transform the <font color=\"blue\">$x$-variable via Fourier sine transform</font> so that we get an ODE in time\n",
        "\n",
        "$~$\n",
        "\n",
        "**STEP 1**\n",
        "\n",
        "We start by transforming each side of the PDE;\n",
        "  \n",
        "$$\n",
        "\\begin{aligned}\n",
        "  \\mathcal{F}_s [u_t]\n",
        "    &=\\alpha \\mathcal{F}_s\\left[u_{xx} \\right] \\\\ \n",
        "    &\\Downarrow\\;{\\scriptsize \n",
        "    \\mathcal{F}_s[u(x,t)]=U(t)} \\\\ \n",
        "    \\frac{d}{dt}U(t)\n",
        "    &= \\alpha\\left [\\frac{2}{\\pi}\\omega u(0,t) \n",
        "     -\\omega^2\\mathcal{F}_s[u]  \\right ]=\\alpha\\left \n",
        "      [A\\frac{2}{\\pi}\\omega -\\omega^2 U(t)  \\right ]\\\\ \n",
        "    &\\Downarrow \\;{\\scriptsize \n",
        "     \\mathcal{F}_s[u(x,0)]=U(0)}\\\\ \n",
        "     \\frac{dU}{dt}&+\\alpha \\omega^2 U\n",
        "     =A\\frac{2}{\\pi}\\alpha\\omega, \\;U(0)=0 \n",
        "\\end{aligned}$$\n",
        "\n",
        "We arrive at the ODE\n",
        "\n",
        "**STEP 2**\n",
        "\n",
        "To solve this IVP, $\\,$we could use a variety of elementary techniques from ordinary differential equations. $\\,$The solution is\n",
        "\n",
        "$$ U(t)=A\\frac{2}{\\pi}\\left[\\frac{1 -e^{-\\alpha\\omega^2 t}}{\\omega} \\right]$$\n",
        "\n",
        "We have now found the sine transformation for the answer $\\,u(x,t)$\n",
        "\n",
        "**STEP 3**\n",
        "\n",
        "To find the solution, $\\,$we can either evaluate the inverse transform directly from the integral or else resort to the tables. $\\,$Using the tables, $\\,$we get\n",
        "\n",
        "$$ u(x,t)=A\\, \\mathrm{erfc} \\left( \\frac{x}{2\\sqrt{\\alpha t}} \\right)$$\n",
        "\n",
        "where $\\mathrm{erfc}(\\eta), \\;0 < \\eta < \\infty$, $\\,$is called the complementary-error function and is given by\n",
        "\n",
        "$$ \\mathrm{erfc}(\\eta)=\\frac{2}{\\sqrt{\\pi}} \\int_\\eta^\\infty e^{-\\beta^2}\\,d\\beta$$\n",
        "\n",
        "$~$"
      ],
      "id": "282a2049"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-semi-infinite-domain-1\n",
        "#| fig-cap: Heat conduction in semi-infinite domain with fixed temperature at the boundary\n",
        "#| fig-align: center\n",
        "from scipy.special import erf, erfc\n",
        "\n",
        "def example_plot6(A, alpha, t, x):\n",
        "    plt.figure(figsize=(7, 5))\n",
        "    for tt in t:\n",
        "        plt.plot(x, A *erfc(x /(2 *np.sqrt(alpha *tt))), \n",
        "          label=rf'$t={tt:0.1f}$')\n",
        "    plt.xlim(0, x[-1])\n",
        "    plt.ylim(0, 1.2)\n",
        "    plt.legend(loc='upper right')\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    plt.text(2, 0.8, \n",
        "      r'$$u(x,t)=A\\, \\mathrm{erfc}' \n",
        "      r'\\left( \\dfrac{x}{2\\sqrt{\\alpha t}} \\right)$$')\n",
        "    plt.title(rf'$A={A:3.1f}, \\; \\alpha={alpha:3.1f}$')\n",
        "    plt.show()\n",
        "\n",
        "A = 1\n",
        "alpha = 1\n",
        "\n",
        "t = [0.1, 0.2, 0.4, 0.8, 1.6, 3.2]\n",
        "x = np.linspace(0, 8)\n",
        "\n",
        "example_plot6(A, alpha, t, x)    "
      ],
      "id": "fig-semi-infinite-domain-1",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "**Example** $\\,$Solve by means of the cosine transform\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_t &= \\alpha u_{xx} && \\color{red}{0 < x < \\infty}, \\;0 < t < \\infty\\\\ \n",
        " \\color{red}{u_x(0,t)} &= 0 && 0 < t < \\infty\\\\\n",
        " \\color{red}{u(x,0)} &=\\color{red}{H(1-x)} && 0 \\leq x < \\infty\n",
        "\\end{aligned}$$\n",
        "\n",
        "where $H(x)$ is the Heaviside function\n",
        "\n",
        "$~$"
      ],
      "id": "08df9143"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-semi-infinite-domain-2\n",
        "#| fig-cap: Heat conduction in semi-infinite domain insulated at the boundary\n",
        "#| fig-align: center\n",
        "from scipy import integrate\n",
        "\n",
        "x0 = [0, 1, 1, 8]\n",
        "u0 = [1, 1, 0, 0]\n",
        "\n",
        "def example_plot6(alpha, t, x, u_solution):\n",
        "    plt.figure(figsize=(7, 5))\n",
        "    plt.plot(x0, u0, 'r:', label='$t=0.0$')\n",
        "    for tt in t:\n",
        "        u = u_solution(alpha, tt, x)\n",
        "        plt.plot(x, u, label='$t=%0.1f$' % tt)       \n",
        "    plt.xlim(0, x[-1])\n",
        "    plt.ylim(0, 1.1)\n",
        "    plt.legend(loc='upper right')\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    plt.text(2, 0.35, \n",
        "        (r'$$u(x,t)=\\dfrac{2}{\\pi}\\,' \n",
        "         r'\\int_0^\\infty \\dfrac{\\sin\\omega}{\\omega}\\,' \n",
        "         r'\\exp(-\\alpha\\omega^2 t)\\, \\cos\\omega x \\,d\\omega$$'))\n",
        "    plt.title(r'$\\alpha=%3.1f$' % alpha)    \n",
        "    plt.show()\n",
        "\n",
        "alpha = 1\n",
        "\n",
        "t = [0.1, 0.2, 0.4, 0.8, 1.6, 3.2, 6.4]\n",
        "x = np.linspace(0, 8)\n",
        "\n",
        "def u_solution(alpha, t, x):   \n",
        "    u = np.zeros_like(x)\n",
        "    for i, xx in enumerate(x):\n",
        "        f = lambda w : np.sin(w) /w *np.exp(-alpha*w*w*t) *np.cos(w*xx) \n",
        "        u[i], _ = integrate.quad(f, 0, np.inf) \n",
        "    return 2.0 /np.pi *u\n",
        "\n",
        "example_plot6(alpha, t, x, u_solution)      "
      ],
      "id": "fig-semi-infinite-domain-2",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "## $~$The Laplace Transform {#sec-x1-15}\n",
        "\n",
        "* The Laplace transform \n",
        "\n",
        "  $$ \\mathcal{L}[f(t)]= \\int_0^\\infty f(t) e^{-st}\\,dt $$\n",
        "\n",
        "  is probably the only integral transform the student has seen before, $\\,$since it is a very powerful tool for transforming initial-value problems in ODE into algebraic equations\n",
        "\n",
        "* Not only is the Laplace transform useful in transforming ODEs into algebraic equations, $\\,$but now we will use the Laplace transform to transform PDEs into ODEs\n",
        "\n",
        "* The major difference in applying the Laplace transform to PDEs in contrast to ODEs is that now when the original PDE is transformed, $\\,$the new resulting equation will be either a new PDE with one less independent variable or else an ODE in one variable\n",
        "\n",
        "* We must then decide how to solve this new problem (maybe by another transform, $\\,$by separation of variables, $\\,$and so on)\n",
        "\n",
        "$~$\n",
        "\n",
        "**Property 1** $\\,$ Transform Pair\n",
        "\n",
        "* The Laplace transform and its inverse are given by\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   \\mathcal{L}[f(t)] &= F(s) =\\int_0^\\infty f(t) e^{-st}\\,dt \\\\ \n",
        "   \\mathcal{L}^{-1}[F(s)] &= \\frac{1}{2\\pi i}\\int_{\\gamma-i\\infty}^{\\gamma+i\\infty} F(s)e^{st}\\,ds\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* <font color=\"blue\">The Laplace transform has one major advantage over the Fourier transform in that the damping factor $e^{-st}$ in the integrand allows us to transform a wider class of functions (the factor $e^{-i\\omega x}$ in the Fourier transform doesn't do any damping since its absolute value is one)</font> \n",
        "\n",
        "* In fact, $\\,$the exact conditions that insure that a function $f(t)$ has a Laplace transform are given by the following theorem:\n",
        "\n",
        "  $\\,$\n",
        "\n",
        "  If we can find constants $\\,M$ and $\\,a\\,$ such that\n",
        "  \n",
        "  $$ \\left|f(t)\\right| \\leq Me^{at} \\;\\text{ for } \\; t > T, $$\n",
        "  \n",
        "  then $\\displaystyle \\int_0^\\infty f(t)\\,e^{-st}\\,dt~$ exists for $s>a$\n",
        "\n",
        "* We now list a few functions that have Laplace transforms\n",
        "\n",
        "  $${\\scriptsize \\begin{aligned}\n",
        "    f(t) \n",
        "      &= 1 \n",
        "      && (\\text{pick } M=1, a=0) \n",
        "        \\;\\;\\longrightarrow\\;\\; F(s)=\\frac{1}{s}\\\\ \n",
        "    f(t) \n",
        "      &=e^{2t} \n",
        "      && (\\text{pick } M=1, a=2) \n",
        "        \\;\\;\\longrightarrow\\;\\; F(s)=\\frac{1}{s-2},\\;\\; s > 2 \\\\ \n",
        "    f(t) \n",
        "      &=\\sin \\omega t \n",
        "      && (\\text{pick } M=1, a=0) \n",
        "        \\;\\;\\longrightarrow\\;\\; F(s)=\\frac{\\omega}{s^2 +\\omega^2} \\\\\n",
        "    f(t) \n",
        "      &=e^{t^2} \n",
        "      && (\\text{doesn't have a Laplace transform})\n",
        "  \\end{aligned}}$$\n",
        "\n",
        "* In the definition of the Laplace transform, $\\,$the variable $s$ is taken to be a real variable $0 < s < \\infty$. $\\,$It is possible to extend this definition to complex values of $s$ and, in fact, to evaluate the inverse Laplace transform\n",
        "\n",
        "  $$ \\mathcal{L}^{-1}[F(s)]=\\frac{1}{2\\pi i}\\int_{\\gamma-i\\infty}^{\\gamma+i\\infty} F(s)e^{st}\\,ds $$\n",
        "\n",
        "  We must often resort to contour integration in the complex plane and the theory of residues. $\\,$We won't bother ourselves with this topic here but will use the tables for finding inverse transforms\n",
        "\n",
        "**Property 2** $\\,$ Transforms of Partial Derivatives\n",
        "\n",
        "* Suppose we have a function $u(x,t)$ of two variables. $\\,$Since the Laplace transform transforms the $t$-variable, $\\,$the rules of transformation for partial derivatives are\n",
        "\n",
        "  $~$\n",
        "\n",
        "  $\\displaystyle \\color{red}{\\mathcal{L}[u_t]}=\\int_0^\\infty u_t(x,t) e^{-st}\\,dt=\\color{red}{sU(x,s) -u(x,0)}$\n",
        "\n",
        "  $\\displaystyle \\color{red}{\\mathcal{L}[u_{tt}]}=\\int_0^\\infty u_{tt}(x,t) e^{-st}\\,dt=\\color{red}{s^2U(x,s) -su(x,0) -u_t(x,0)}$\n",
        "\n",
        "  $\\displaystyle \\mathcal{L}[u_x]=\\int_0^\\infty u_x(x,t) e^{-st}\\,dt=\\frac{\\partial U}{\\partial x}(x,s)$\n",
        "\n",
        "  $\\displaystyle \\mathcal{L}[u_{xx}]=\\int_0^\\infty u_{xx}(x,t) e^{-st}\\,dt=\\frac{\\partial^2 U}{\\partial x^2}(x,s)$\n",
        "\n",
        "**Property 3** $\\,$ Convolution Theory\n",
        "\n",
        "* Convolution plays the same role here as it did in the Fourier transform, $\\,$but now the convolution is defined slightly differently. $\\,$The finite convolution of two functions $\\,f$ and $g$ is defined by\n",
        "\n",
        "  $$ \\color{red}{(f*g)(t)=\\int_0^t f(\\tau) g(t-\\tau)\\,d\\tau =\\int_0^t f(t- \\tau) g(\\tau)\\,d\\tau} $$\n",
        "\n",
        "  As in the case of the infinite convolution, $\\,$the important property of this new convolution is that\n",
        "\n",
        "  $$ \\mathcal{L}[f*g]=\\mathcal{L}[f]\\,\\mathcal{L}[g] $$\n",
        "\n",
        "  or the equivalent formula\n",
        "\n",
        "  $$ \\mathcal{L}^{-1}\\left\\{\\mathcal{L}[f] \\,\\mathcal{L}[g] \\right\\}=f*g $$\n",
        "\n",
        "  For example\n",
        "\n",
        "  $$ \\mathcal{L}^{-1}\\left[\\frac{1}{s} \\cdot \\frac{1}{s^2+1}\\right] = \\int_0^t \\sin \\tau \\,d\\tau=1-\\cos t $$\n",
        "\n",
        "**NOTES**\n",
        "\n",
        "<font color=\"blue\">The Laplace transform can also be applied to problems where the PDE is nonhomogeneous (in separation of variables, $\\,$the equation had to be homogeneous), $\\,$but the Laplace transform will generally work only if the equation has constant coefficients (in separation of variables, $\\,$we could have variable coefficients)</font>  \n",
        "\n",
        "$~$\n",
        "\n",
        "* **Heat Conduction in a Semi-infinite Medium**\n",
        "\n",
        "  ![](figures/pde01_figure13.jpg \"deep container\"){width=\"60%\" fig-align=\"center\"}\n",
        "\n",
        "  * Consider a large (deep) container of liquid that is insulated on the sides. Suppose the liquid has an initial temperature of $u_0$ and that the temperature of the air above liquid is zero. Our goal is to find the temperature of the liquid at various depths of the container at different $t$ values:\n",
        "\n",
        "    $$\\begin{aligned}\n",
        "     u_t &= u_{xx} && 0 < x < \\infty,\\;0 < t < \\infty \\\\ \n",
        "     u_x(0,t) -u(0,t) &= 0 && 0 < t < \\infty \\\\ \n",
        "     u(x,0) &= u_0 && 0 < x <\\infty\n",
        "    \\end{aligned}$$\n",
        "\n",
        "  * Transforming our problem, $\\,$we arrive at an ODE in $x$\n",
        "\n",
        "    $$\n",
        "    \\begin{aligned}\n",
        "      sU(x) -u_0 &= \\frac{d^2U}{dx^2} && 0 < x < \\infty \\\\[5pt]\n",
        "      \\frac{dU}{dx}(0) &= U(0) &&\n",
        "    \\end{aligned}$$\n",
        "\n",
        "    We first find the general solution of the ODE, $\\,$which is\n",
        "\n",
        "    $$ U(x)=c_1 e^{\\sqrt{s}x} +c_2 e^{-\\sqrt{s}x} +\\frac{u_0}{s} $$ \n",
        "\n",
        "  * Substituting the BCs into this expression allows us to find the constants $c_1$ and $c_2$ (first note that $c_1=0\\,$ or else the temperature will go to infinity as $x$ gets large). $\\,$Finding $c_2$ from the BC at $x=0\\,$ gives us the answer for $U(x)$\n",
        "\n",
        "    $$ {\\scriptsize U(x)=\n",
        "      -u_0 \\left[ \\frac{e^{-\\sqrt{s}x}}{s(\\sqrt{s} +1)} \\right] \n",
        "       +\\frac{u_0}{s}\n",
        "      =\\frac{u_0}{s} -u_0\\left[ \\frac{e^{-\\sqrt{s}x}}{s} \n",
        "      -\\frac{e^{-\\sqrt{s}x}}{\\sqrt{s}(\\sqrt{s} +1)}\\right]} $$\n",
        "\n",
        "    Now for the last step, $\\,$to find $u(x,t)$, $\\,$we compute\n",
        "\n",
        "    $$ {\\scriptsize u(x,t)\n",
        "     =\\mathcal{L}^{-1}\\left[ U(x,s) \\right]\n",
        "     =u_0 -u_0 \\left[ \\mathrm{erfc}\\left( \\frac{x}{2\\sqrt{t}} \\right) \n",
        "    -\\mathrm{erfc}\\left( \\sqrt{t}+\\frac{x}{2\\sqrt{t}} \\right)\n",
        "    e^{x+t}\\right]} $$\n",
        "\n",
        "    See [Inverse Laplace Transform Table](http://eqworld.ipmnet.ru/en/auxiliary/inttrans/LapInv5.pdf)\n",
        "\n",
        "$~$"
      ],
      "id": "de8c2da0"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-semi-infinite-domain-3\n",
        "#| fig-cap: Heat conduction in semi-infinite domain with 3^rd^ kind BC\n",
        "#| fig-align: center\n",
        "\n",
        "def example_plot7(t, x, u0, u_solution):\n",
        "\n",
        "    plt.figure(figsize=(7, 5))\n",
        "    plt.plot(x, np.full_like(x, u0), label='$t=0$')\n",
        "    for tt in t:\n",
        "        plt.plot(x, u_solution(tt, x, u0), label='$t=%1.3f$' % tt)\n",
        "    plt.legend(loc='lower right')\n",
        "\n",
        "    plt.xlim(0, 5)\n",
        "    plt.ylim(0.4, 1.2)\n",
        "\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    plt.title(r'$u_0=%3.1f$' % u0)\n",
        "\n",
        "    plt.show()\n",
        "\n",
        "def u_solution(t, x, u0):\n",
        "    sqrt_t = np.sqrt(t)\n",
        "    x_2sqrt_t = x /(2 *sqrt_t)\n",
        "    return u0 -u0*(erfc(x_2sqrt_t) \n",
        "              -erfc(sqrt_t +x_2sqrt_t) *np.exp(x +t))\n",
        "\n",
        "u0 = 1\n",
        "t = np.logspace(-3, 0, 6)\n",
        "x = np.linspace(0, 5, 300)\n",
        "\n",
        "example_plot7(t, x, u0, u_solution)    "
      ],
      "id": "fig-semi-infinite-domain-3",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "## $~$The Convection Term $u_x$ in the Diffusion Problems {#sec-x1-16}\n",
        "\n",
        "* Suppose now we consider the problem of finding the concentration of a substance upwards from the surface of the earth where the substance both diffuses through the air and is carried upwards (convected) by moving currents (moving with velocity $V$)\n",
        "\n",
        "* In any case, $\\,$it is our purpose here to solve the diffusion-convection equation\n",
        "\n",
        "  $$ u_t = Du_{xx} -V u_x$$\n",
        "\n",
        "* To get an idea of what solutions look like or how they behave with the convection term included, $\\,$let's first work a problem that is pure convection (the diffusion term is zero)\n",
        "\n",
        "* A typical problem would be dumping a substance into a clean air (moving with upward velocity $V$) and observing the concentration of the substance at the upperside. $\\,$Then the concentration of substance $u(x,t)$ can be found by solving the following mathematical model:\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "     u_t &= -Vu_x && \\phantom{xx}\\color{red}{0 < x < \\infty}, \\; 0 < t < \\infty \\\\ \\\\\n",
        "     u(0,t) &= P &&\\longleftarrow\\; \\text{Constant Input of the Substance} \\\\\n",
        "     u(x,0) &= 0 &&\\longleftarrow\\; \\text{Initially a Clean Air}\n",
        "  \\end{aligned} \\tag{CV}\\label{eq:CV}$$\n",
        "\n",
        "* Since the $x$-variable is unbounded, $\\,$we use the Laplace transform on $t$\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    sU(x) &=-V\\frac{dU}{dx}, \\;\\;\\; 0 < x < \\infty \\\\ \n",
        "    U(0) &= \\frac{P}{s}\\\\ \n",
        "    &\\Downarrow \\\\ \n",
        "    U(x) &=\\frac{P}{s} e^{-\\frac{x}{V}s}  \\\\ \n",
        "    &\\Downarrow \\\\\n",
        "    u(x,t) &= P \\,H(t -x/V) \\\\\n",
        "    &\\Downarrow \\\\\n",
        "    u(x,t) &=\n",
        "    \\begin{cases}\n",
        "      P & x \\leq Vt \\\\\n",
        "      0 & x > Vt  \n",
        "    \\end{cases}\n",
        "  \\end{aligned}$$\n",
        "\n",
        "* To see what happens when a moving wave diffuses, $\\,$we solve the following problem $(P=1)$\n",
        "  \n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "     u_t &= Du_{xx}-Vu_x && -\\infty < x < \\infty, \\;0 < t < \\infty \\\\\n",
        "     u(x,0) &= P\\left(1 -H(x)\\right) && -\\infty < x < \\infty\n",
        "  \\end{aligned} \\tag{DC}\\label{eq:DC}$$ \n",
        "  \n",
        "  Note that in the new problem \\eqref{eq:DC}, $\\,$we have moved the boundary to $-\\infty$ (we now have an initial-value problem)\n",
        "\n",
        "* In this case, $\\,$we introduce a new coordinate $\\xi$, $\\,$which moves along the $x$-axis with velocity $V$. $\\,$In other words, $\\,$we now place our coordinate system so that it moves with the wave front (of course, $\\,$now when diffusion in addition to convection, $\\,$we won't have a sharp wave front)\n",
        "\n",
        "* Mathematically this says that we change our space coordinate $\\,x\\,$ to $\\,\\xi=x -Vt$. $\\,$It's now clear that when $\\xi=0,$ $\\,$we are on the wave front\n",
        "\n",
        "* To begin, $\\,$we introduce new coordinates $(\\xi, \\tau)$ and use the chain rule to get the new IVP in terms of $\\xi$ and $\\tau$:\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    u_t&= D u_{xx} -Vu_x\\\\ \n",
        "    &\\Downarrow\\; \\xi=x-Vt, \\;\\tau=t \\\\ \n",
        "    u_t&= u_{\\xi}\\xi_t+u_\\tau\\tau_t=-Vu_\\xi+u_\\tau\\\\ \n",
        "    u_x&= u_\\xi \\xi_x+u_\\tau\\tau_x =u_\\xi\\\\\n",
        "    u_{xx}&=(u_\\xi)_x=u_{\\xi\\xi}\\xi_x=u_{\\xi\\xi} \\\\\n",
        "    &\\Downarrow \\\\\n",
        "    -Vu_\\xi+u_\\tau &=Du_{\\xi\\xi} -Vu_\\xi\\\\\n",
        "    &\\big\\Downarrow \\;\\xi=x \\text{ at } t=0\\\\\n",
        "    u_\\tau &=D u_{\\xi\\xi},\\;\\;\\;-\\infty<\\xi<\\infty \\\\\n",
        "    u(\\xi,0)&=P(1-H(\\xi))=\\phi(\\xi) \n",
        "  \\end{aligned}$$\n",
        "\n",
        "* This problem has already been solved in @sec-x1-13 by the Fourier transform and has the solution\n",
        "\n",
        "  $$ {\\scriptsize u(\\xi,\\tau)=\\frac{1}{2\\sqrt{D\\pi\\tau}} \\int_{-\\infty}^{\\infty}\\phi(\\omega) e^{-(\\xi-\\omega)^2/4D\\tau}\\,d\\omega\n",
        "  =\\frac{P}{2\\sqrt{D\\pi\\tau}} \\int_{-\\infty}^0 e^{-(\\xi-\\omega)^2/4D\\tau}\\,d\\omega } $$\n",
        "\n",
        "  where $\\,\\phi(\\omega)$ is the initial condition\n",
        "\n",
        "* By letting\n",
        "\n",
        "  $${\\beta=\\frac{\\xi -\\omega}{2\\sqrt{D\\tau}},\\;\\; d\\beta=-\\frac{1}{2\\sqrt{D\\tau}}d\\omega}$$\n",
        "\n",
        "  we get the interesting result\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "    \\displaystyle u(\\xi,\\tau)&=\\frac{P}{2} \\left[ \\frac{2}{\\sqrt{\\pi}} \\int_{\\frac{\\xi}{2\\sqrt{D\\tau}}}^\\infty e^{-\\beta^2}\\,d\\beta \\right]  \n",
        "     = {\\scriptsize \\begin{cases}\n",
        "    \\displaystyle\\;\\frac{P}{2} \\left[ 1+\\mathrm{erf}\\left( -\\frac{\\xi}{2\\sqrt{D\\tau}} \\right) \\right],& \\xi<0 \\\\ \n",
        "    \\displaystyle\\;\\frac{P}{2}\\, \\mathrm{erfc}\\left( \\frac{\\xi}{2\\sqrt{D\\tau}} \\right), & \\xi \\geq 0 \n",
        "      \\end{cases}}\n",
        "    \\end{aligned}$$\n",
        "\n",
        "* Finally, $\\,$the solution of our problem in terms of  the coordinates $x$ and $t\\,$ is\n",
        "\n",
        "  $$u(x,t)=\\begin{cases}\n",
        "    \\displaystyle\\;\\frac{P}{2} \\left[ 1+\\mathrm{erf}\\left( \\frac{Vt -x}{2\\sqrt{Dt}} \\right) \\right], & Vt>x \\\\ \n",
        "    \\displaystyle\\;\\frac{P}{2}\\, \\mathrm{erfc}\\left( \\frac{x-Vt}{2\\sqrt{Dt}} \\right), & Vt \\leq x \n",
        "  \\end{cases}$$\n",
        "\n",
        "$~$"
      ],
      "id": "2856dbf1"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-diffusion-convection\n",
        "#| fig-cap: Diffusion-convection Heat transfer in semi-infinite domain\n",
        "#| fig-align: center\n",
        "\n",
        "def example_plot8(D, V, t, x, u_solution):\n",
        "    plt.figure(figsize=(8, 6))\n",
        "    plt.plot([-1, 0, 0, x[-1]], [1, 1, 0, 0], 'r:', label='$t=0.0$')\n",
        "    for tt in t:\n",
        "        x_tt = V*tt \n",
        "        plt.plot(x, u_solution(D, V, tt, x), label=rf'$t={tt:3.1f}$')\n",
        "        plt.plot([-1, x_tt, x_tt, x[-1]], [1, 1, 0, 0], 'k:') \n",
        "    plt.xlim(-1, x[-1])\n",
        "    plt.ylim(0, 1.2)\n",
        "    plt.legend(loc='upper left', bbox_to_anchor=(1.0, 1.0))\n",
        "    plt.xlabel('$x$')\n",
        "    plt.ylabel('$u(x,t)$')\n",
        "    plt.title(rf'$D={D:4.1f},\\;V={V:3.1f},\\;P=1.0$')    \n",
        "    plt.show()        \n",
        "\n",
        "def u_solution(D, V, t, x):\n",
        "    x_t = (x -V*t) /(2.0 *np.sqrt(D*t))      \n",
        "    return [0.5*(1.0 +erf(-q)) if q <= 0.0 else 0.5*erfc(q) for q in x_t] \n",
        "\n",
        "D = 0.1\n",
        "V = 1.0\n",
        "\n",
        "t = [2.0, 4.0, 6.0, 8.0]\n",
        "x = np.linspace(0, 16, 400)\n",
        "\n",
        "example_plot8(D, V, t, x, u_solution)  "
      ],
      "id": "fig-diffusion-convection",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "## $~$Duhamel's Principle {#sec-x1-17}\n",
        "\n",
        "* Quite often, $\\,$it is important to find the temperature inside a medium due to time-varying boundary conditions. $\\,$For example, $\\,$consider an insulated rod with temperature specified as $\\,f(t)$ on the right end\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "   u_t &= u_{xx} && 0 < x < 1, \\; 0 < t < \\infty \\\\\n",
        "   u(0,t) &= 0 && 0 < t < \\infty \\\\ \n",
        "   u(1,t) &= \\color{red}{f(t)} && \\\\\n",
        "   u(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned} \\tag{D1}\\label{eq:D1}$$\n",
        "\n",
        "* We may think that the solution to \\eqref{eq:D1} can be easily found once we know the solution to the simpler version (constant temperature on the boundaries)\n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "   w_t &= w_{xx} && 0 < x < 1, \\; 0 < t < \\infty \\\\\n",
        "   w(0,t) &= 0 && 0 < t < \\infty \\\\ \n",
        "   w(1,t) &= \\color{red}{1} && \\\\\n",
        "   w(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned} \\tag{D2}\\label{eq:D2}$$ \n",
        "\n",
        "  In fact, $\\,$if we solve \\eqref{eq:D1} and \\eqref{eq:D2} side by side by the Laplace transform, $\\,$<font color=red>we will see a striking result (Duhamel's principle) that will give us the solution to \\eqref{eq:D1} in terms of the solution of \\eqref{eq:D2}</font>\n",
        "\n",
        "* Solving \\eqref{eq:D2} by Laplace transform, $\\,$we have\n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   \\frac{d^2W}{dx^2} &-sW = 0\\\\ \n",
        "     W(0)&=0 \\\\ \n",
        "     W(1)&=\\color{red}{1/s} \\\\ \n",
        "         &\\Downarrow {\\scriptstyle \\text{Solve the ODE}}\\\\ \n",
        "     W(x,s)&=\\color{red}{\\frac{1}{s} \n",
        "         \\left[ \\frac{\\sinh x\\sqrt{s}}{\\sinh \\sqrt{s}} \\right]} \\\\\n",
        "         &\\Downarrow {\\scriptstyle \\text{Find the inverse transform}}\\\\\n",
        "     w(x,t)=x +\\frac{2}{\\pi} & \\sum_{n=1}^\\infty \n",
        "     \\frac{(-1)^n}{n} e^{-(n\\pi)^2 t}\\sin n\\pi x \n",
        "  \\end{aligned}$$\n",
        "\n",
        "* And we also obtain the following by transforming \\eqref{eq:D1}: \n",
        "\n",
        "  $$\\begin{aligned}\n",
        "   \\frac{d^2U}{dx^2} &-sU = 0\\\\ \n",
        "    U(0)&=0 \\\\ \n",
        "    U(1)&=\\color{red}{F(s)} \\\\ \n",
        "     &\\Downarrow {\\scriptstyle \\text{Solve the ODE}}\\\\ \n",
        "    U(x,s)&=F(s) \\left[ \\frac{\\sinh x\\sqrt{s}}{\\sinh \\sqrt{s}} \\right] \n",
        "           =F(s) s \\color{red}{\\frac{1}{s}\\left[ \\frac{\\sinh x\\sqrt{s}}{\\sinh \\sqrt{s}} \\right]} \n",
        "           =F(s) sW(x,s)\\\\\n",
        "     &\\big\\Downarrow \\;{\\scriptstyle \\mathcal{L}[w_t]=sW -w(x,0)=sW}\\\\\n",
        "    U(x,s)&=F(s) \\mathcal{L}[w_t] \\\\\n",
        "     &\\big\\Downarrow \\;{\\scriptstyle \\text{Find the inverse transform}}\\\\\n",
        "     \\color{red}{u(x,t)} \n",
        "       &= \\mathcal{L}^{-1} \\left[ F(s) \\mathcal{L}[w_t] \\right] \n",
        "       =f(t) * w_t(x,t) \\\\\n",
        "       &\\color{red}{\\;= \\int_0^t w_{t -\\tau}(x,t-\\tau) \\, f(\\tau) \\,d\\tau} \\\\\n",
        "       &= \\left. -w(x,t-\\tau)\\, f(\\tau) \\phantom{\\frac{}{}} \n",
        "        \\right |_{\\,0}^{\\,t} +\\int_0^t w(x,t-\\tau) f'(\\tau) \\,d\\tau\\\\\n",
        "       &= \\int_0^t w(x,t-\\tau) f'(\\tau)\\,d\\tau +w(x,t) \\, f(0)\n",
        "  \\end{aligned}$$\n",
        "\n",
        "  We have found the solution $u(x,t)$ to the time-varying problem in terms of the solution to the ease problem (constant BCs).\n",
        "$\\,$The above result is known as <font color=\"red\">Duhamel's principle</font>\n",
        "\n",
        "$~$\n",
        "\n",
        "**NOTES**\n",
        "\n",
        "* <font color=\"red\">There are another interesting version of Duhamel's principle</font> that gives the answer to \\eqref{eq:D1} in terms of the solution $\\,v(x,t)$ of the alternative simple \n",
        "\n",
        "  $$\n",
        "  \\begin{aligned}\n",
        "   v_t &= v_{xx} && 0 < x < 1, \\; 0 < t < \\infty \\\\\n",
        "   v(0,t) &= 0 && 0 < t < \\infty \\\\ \n",
        "   v(1,t) &= \\color{red}{\\delta(t)} && \\\\\n",
        "   v(x,0) &= 0 && 0 \\leq x \\leq 1\n",
        "  \\end{aligned}$$ \n",
        "\n",
        "* Knowing this formula\n",
        "\n",
        "  $$ \\color{red}{u(x,t)=\\int_0^t v(x,t-\\tau) \\,f(\\tau)\\,d\\tau} $$\n",
        "\n",
        "  allows us to find $u(x,t)$ to an arbitrary boundary temperature $\\,f(t)$ once we have carried out an experiment to determine the temperature response $\\,v(x,t)$ from an impulse temperature\n",
        "\n",
        "\n",
        "## Worked Exercises {.unnumbered}\n",
        "\n",
        "**1.** $~$ Solve the problem\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_t &= \\alpha u_{xx}, \\;\\;a < x < b, \\;\\; t>0\\\\ \n",
        " &u(a,t)=0, \\;u(b,t)=0, \\;u(x,0)=(x-a)(b-x) \n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "**Step 1:** $~$ Separation of Variables\n",
        "\n",
        "We look for solutions of the form:\n",
        "\n",
        "$$u(x,t) = X(x)T(t)$$\n",
        "\n",
        "Substitute into the PDE:\n",
        "\n",
        "$$X(x) T’(t) = \\alpha X’’(x) T(t)\n",
        "\\; \\Rightarrow \\; \\frac{T’(t)}{\\alpha T(t)} = \\frac{X’’(x)}{X(x)} = -\\lambda$$\n",
        "\n",
        "We get two ODEs:\n",
        "\n",
        "$$\\begin{aligned}\n",
        "T’(t) + \\alpha \\lambda T(t) &= 0 \\\\\n",
        "X’’(x) + \\lambda X(x) &= 0\n",
        "\\end{aligned}$$\n",
        "\n",
        "with boundary conditions:\n",
        "\n",
        "$$X(a) = 0, \\quad X(b) = 0$$\n",
        "\n",
        "**Step 2:** $~$ Solve the Spatial Part\n",
        "\n",
        "We solve:\n",
        "\n",
        "$$X'' + \\lambda X = 0, \\quad X(a) = 0, \\quad X(b) = 0$$\n",
        "\n",
        "This is a standard Sturm–Liouville problem\n",
        "\n",
        "The eigenfunctions are:\n",
        "\n",
        "$$X_n(x) = \\sin\\left( \\frac{n\\pi (x - a)}{b - a} \\right), \\quad n = 1, 2, 3, \\dots$$\n",
        "\n",
        "The corresponding eigenvalues are:\n",
        "\n",
        "$$\\lambda_n = \\left( \\frac{n\\pi}{b - a} \\right)^2$$\n",
        "\n",
        "**Step 3:** $~$ Solve the Temporal Part\n",
        "\n",
        "$$T_n(t) = e^{-\\alpha \\lambda_n t} = \\exp\\left( -\\alpha \\left( \\frac{n\\pi}{b - a} \\right)^2 t \\right)$$\n",
        "\n",
        "**Step 4:** $~$ General Solution\n",
        "\n",
        "$$u(x,t) = \\sum_{n=1}^\\infty B_n \\sin\\left( \\frac{n\\pi(x - a)}{b - a} \\right)\n",
        "e^{- \\alpha \\left( \\frac{n\\pi}{b - a} \\right)^2 t}$$\n",
        "\n",
        "**Step 5:** $~$ Apply Initial Condition\n",
        "\n",
        "$$u(x,0) = (x - a)(b - x) = \\sum_{n=1}^\\infty B_n \\sin\\left( \\frac{n\\pi(x - a)}{b - a} \\right)$$\n",
        "\n",
        "To find coefficients $B_n$, use Fourier sine series:\n",
        "\n",
        "$$B_n = \\frac{2}{b - a} \\int_a^b (x - a)(b - x) \\sin\\left( \\frac{n\\pi(x - a)}{b - a} \\right) dx$$\n",
        "\n",
        "Let’s use substitution:\n",
        "Let $\\xi = \\frac{x - a}{b - a}$, so $x = (b-a)\\xi + a$, $dx = (b-a) d\\xi$, and when $x = a \\Rightarrow \\xi = 0, x = b \\Rightarrow \\xi = 1$\n",
        "\n",
        "Then:\n",
        "\n",
        "$$(x - a)(b - x) = (b - a)^2 \\xi (1 - \\xi)$$\n",
        "\n",
        "and:\n",
        "\n",
        "$$B_n = 2 \\int_0^1 \\xi(1 - \\xi) \\sin(n\\pi \\xi) d\\xi =\n",
        "\\begin{cases}\n",
        "\\displaystyle \\frac{8}{n^3 \\pi^3}, & n \\text{ odd} \\\\\n",
        "0, & n \\text{ even}\n",
        "\\end{cases}$$"
      ],
      "id": "f726e55c"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# Parameters\n",
        "a = 0\n",
        "b = 1\n",
        "alpha = 1\n",
        "t_values = [0, 0.05, 0.10, 0.15]  # Times to plot\n",
        "x_vals = np.linspace(a, b, 400)\n",
        "N_terms = 50  # Number of terms in Fourier series\n",
        "\n",
        "# Solution series function\n",
        "def u_series(x, t, N=N_terms):\n",
        "    u = np.zeros_like(x)\n",
        "    for n in range(1, N + 1, 2):  # Only odd n\n",
        "        coeff = 8 /(n**3 * np.pi**3)\n",
        "        term = coeff *(np.sin(n *np.pi *(x - a) /(b - a)) \n",
        "          *np.exp(-alpha *(n *np.pi /(b - a))**2 *t))\n",
        "        u += term\n",
        "    return u\n",
        "\n",
        "# Plotting\n",
        "plt.figure(figsize=(7.5, 5))\n",
        "for t in t_values:\n",
        "    u_vals = u_series(x_vals, t)\n",
        "    plt.plot(x_vals, u_vals, label=f\"t = {t}\")\n",
        "\n",
        "plt.title(\"Solution $u(x,t)$ of the Heat Equation\")\n",
        "plt.xlabel(\"x\")\n",
        "plt.ylabel(\"u(x,t)\")\n",
        "plt.legend()\n",
        "plt.grid(True)\n",
        "plt.show()"
      ],
      "id": "15fabde4",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "**2.** $~$ Solve the problem\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_t &= \\alpha u_{xx}, \\;\\; 0 < x < \\pi, \\;\\; t>0\\\\ \n",
        " &u_x(0,t)=0, \\;u_x(\\pi,t)=0, \\;u(x,0)=1 +\\frac{1}{2}\\cos 3x \n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "**Step 1:** $~$ Separation of Variables\n",
        "\n",
        "Let’s look for a solution of the form:\n",
        "\n",
        "$$u(x,t) = X(x)T(t)$$\n",
        "\n",
        "Plug into the PDE:\n",
        "\n",
        "$$X(x) T’(t) = \\alpha X’’(x) T(t)\n",
        "\\; \\Rightarrow \\; \\frac{T’(t)}{\\alpha T(t)} = \\frac{X’’(x)}{X(x)} = -\\lambda$$\n",
        "\n",
        "Which gives us two ODEs:\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "T'(t) + \\alpha \\lambda T(t) &= 0 \\\\\n",
        "X''(x) + \\lambda X(x) &= 0\n",
        "\\end{aligned}$$\n",
        "\n",
        "With Neumann boundary conditions:\n",
        "\n",
        "$$X'(0) = 0, \\quad X'(\\pi) = 0$$\n",
        "\n",
        "**Step 2:** $~$ Solve the Spatial ODE\n",
        "\n",
        "$$X'' + \\lambda X = 0$$\n",
        "\n",
        "Solutions depend on the value of $\\lambda$:\t\n",
        "\n",
        "* The eigenfunctions satisfying Neumann BCs are:\n",
        "\n",
        "$$X_n(x) =\n",
        "\\begin{cases}\n",
        "1, & n = 0 \\\\\n",
        "\\cos(nx), & n = 1, 2, 3, \\dots\n",
        "\\end{cases}$$\n",
        "\n",
        "* Corresponding eigenvalues:\n",
        "\n",
        "$$\\lambda_n = n^2, \\quad n = 0, 1, 2, \\dots$$\n",
        "\n",
        "**Step 3:** $~$ Solve the Time Part\n",
        "\n",
        "$$T_n(t) = e^{-\\alpha n^2 t}$$\n",
        "\n",
        "**Step 4:** $~$ General Solution\n",
        "\n",
        "$$u(x,t) = \\frac{A_0}{2} +\\sum_{n=1}^\\infty A_n \\cos(nx) e^{-\\alpha n^2 t}$$\n",
        "\n",
        "**Step 5:** $~$ The initial condition is:\n",
        "\n",
        "$$u(x,0) = 1 + \\cos 3x$$\n",
        "\n",
        "This already matches our eigenfunctions:\n",
        "* $1$ corresponds to $\\frac{A_0}{2}$\n",
        "* $\\frac{1}{2}\\cos 3x$ corresponds to $A_3\\cos(3x)$\n",
        "\n",
        "So the expansion is:\n",
        "\n",
        "$$u(x,t) = \\frac{A_0}{2} + A_3 \\cos(3x) e^{-9\\alpha t}$$\n",
        "\n",
        "Comparing with $u(x,0) = 1 + \\frac{1}{2}\\cos 3x$, we get:\n",
        "\n",
        "$$A_0 = 2, \\quad A_3 = \\frac{1}{2}$$\n",
        "\n",
        "All other $A_n = 0$\n",
        "\n",
        "**Final Answer:**\n",
        "\n",
        "$$u(x,t) = 1 + \\frac{1}{2}\\cos(3x) e^{-9\\alpha t}$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**3.** $~$ Solve the problem\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_{t} &= u_{xx} +F(x,t), \\;\\; -\\infty < x < \\infty, \\;\\; t>0\\\\ \n",
        " &u(x,0) = 0, \\;u(x, t) \\sim \\text{bounded}\\\\\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "For the heat equation on $\\mathbb{R}$, the Green’s function (or heat kernel) is:\n",
        "$$G(x,t) = \\frac{1}{\\sqrt{4\\pi t}} e^{-x^2/(4t)}$$\n",
        "\n",
        "The solution to the nonhomogeneous heat equation with zero initial condition is given by the Duhamel’s principle:\n",
        "$$u(x,t) = \\int_0^t \\int_{-\\infty}^\\infty G(x - \\xi, t - \\tau) F(\\xi, \\tau) \\, d\\xi \\, d\\tau$$\n",
        "\n",
        "So,\n",
        "\n",
        "$$\n",
        "u(x,t) = \\int_0^t \\int_{-\\infty}^\\infty \\frac{1}{\\sqrt{4\\pi(t - \\tau)}} \\exp\\left(-\\frac{(x - \\xi)^2}{4(t - \\tau)}\\right) F(\\xi, \\tau) \\, d\\xi \\, d\\tau\n",
        "$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**4.** $~$ Solve the problem\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_{t} &= u_{xx}, \\;\\; 0 < x < \\infty, \\;\\; t>0\\\\ \n",
        " &u(0, t) = g(t), \\;u(x, 0) = 0, \\;u(x, t) \\sim \\text{bounded}\\\\\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "This is a classical problem with the Dirichlet boundary condition on a semi-infinite domain.\n",
        "\n",
        "Since the initial condition is zero and the boundary condition is nonzero at $x = 0$, we apply a Green’s function method for the semi-infinite domain\n",
        "\n",
        "The appropriate solution is:\n",
        "\n",
        "$$\n",
        "u(x,t) = \\int_0^t \\frac{x}{\\sqrt{4\\pi (t - \\tau)^3}} \\exp\\left(-\\frac{x^2}{4(t - \\tau)}\\right) g(\\tau) \\, d\\tau\n",
        "$$\n",
        "\n",
        "This is the Poisson kernel representation for the half-line heat problem with a source at the boundary\n",
        "\n",
        "$~$\n",
        "\n",
        "**5.** $~$ Solve the problem\n",
        "\n",
        "$$\\begin{aligned}\n",
        " u_t &= \\alpha u_{xx} -\\nu u_{x} -\\beta u, \\;\\;0 < x < 1, \\quad t>0\\\\\n",
        " &u(0, t) = 0, \\;u(1, t) = 0, \\;u(x,0) = \\exp \\left(\\frac{\\nu}{2\\alpha}x\\right)\n",
        "\\end{aligned}$$\n",
        "\n",
        "**Solution**\n",
        "\n",
        "**Step 1:** $~$ Change of variables\n",
        "\n",
        "We use the substitution:\n",
        "\n",
        "$$u(x,t) = e^{r x - \\lambda t} w(x,t)$$\n",
        "\n",
        "with the goal of choosing $r$ and \\lambda so that the PDE for $w(x,t)$ becomes the standard heat equation\n",
        "\n",
        "Compute derivatives:\n",
        "\n",
        "$$\\begin{aligned}\n",
        "u_x &= r e^{r x - \\lambda t} w + e^{r x - \\lambda t} w_x = e^{r x - \\lambda t}(r w + w_x) \\\\\n",
        "u_{xx} &= e^{r x - \\lambda t} (r^2 w + 2r w_x + w_{xx})\\\\\n",
        "u_t &= e^{r x - \\lambda t} (-\\lambda w + w_t)\n",
        "\\end{aligned}$$\n",
        "\n",
        "Now plug into the PDE:\n",
        "\n",
        "$$u_t = \\alpha u_{xx} - \\nu u_x - \\beta u$$\n",
        "\n",
        "Substituting everything:\n",
        "\n",
        "$$\\begin{aligned}\n",
        "e^{r x - \\lambda t} (-\\lambda w + w_t) &= \\alpha e^{r x - \\lambda t} (r^2 w + 2r w_x + w_{xx})\\\\ &- \\nu e^{r x - \\lambda t} (r w + w_x) - \\beta e^{r x - \\lambda t} w\n",
        "\\end{aligned}$$\n",
        "\n",
        "Cancel the common exponential $e^{r x - \\lambda t}$:\n",
        "\n",
        "$$-\\lambda w + w_t = \\alpha (r^2 w + 2r w_x + w_{xx}) - \\nu (r w + w_x) - \\beta w$$\n",
        "\n",
        "Group terms:\n",
        "\n",
        "$$w_t = \\alpha w_{xx} + (2\\alpha r - \\nu) w_x + (\\alpha r^2 - \\nu r - \\beta + \\lambda) w$$\n",
        "\n",
        "We want to choose $r$ and $\\lambda$ so that:\n",
        "\n",
        "* Coefficient of $w_x$ is 0: $~2\\alpha r - \\nu = 0$\n",
        "* Coefficient of $w$ is 0: $~\\alpha r^2 - \\nu r - \\beta + \\lambda = 0$\n",
        "\n",
        "Solve for $r$:\n",
        "\n",
        "$$2\\alpha r = \\nu \\; \\Rightarrow \\; r = \\frac{\\nu}{2\\alpha}$$\n",
        "\n",
        "Plug $r = \\frac{\\nu}{2\\alpha}$ into the second equation to find $\\lambda$:\n",
        "\n",
        "$$\\lambda = \\alpha r^2 - \\nu r + \\beta = \\alpha \\left( \\frac{\\nu}{2\\alpha} \\right)^2 - \\nu \\cdot \\frac{\\nu}{2\\alpha} + \\beta\n",
        "= -\\frac{\\nu^2}{4\\alpha} + \\beta$$\n",
        "\n",
        "**Step 2:** $~$ Resulting equation for $w$\n",
        "\n",
        "We now have:\n",
        "\n",
        "$$u(x,t) = e^{\\frac{\\nu}{2\\alpha} x - \\lambda t} w(x,t),\n",
        "\\quad \\text{with } \\lambda = -\\frac{\\nu^2}{4\\alpha} + \\beta$$\n",
        "\n",
        "Then $w(x,t)$ satisfies the heat equation:\n",
        "\n",
        "$$w_t = \\alpha w_{xx},\n",
        "\\quad 0 < x < 1,\\; t > 0$$\n",
        "\n",
        "with boundary conditions:\n",
        "\n",
        "$$w(0,t) = 0, \\quad w(1,t) = 0$$\n",
        "\n",
        "and initial condition:\n",
        "\n",
        "$$w(x,0) = u(x,0) \\cdot e^{ -\\frac{\\nu}{2\\alpha} x } = \\exp\\left( \\frac{\\nu}{2\\alpha} x \\right) \\cdot \\exp\\left( -\\frac{\\nu}{2\\alpha} x \\right) = 1$$\n",
        "\n",
        "**Step 3:** $~$ Solve the heat equation with constant initial condition\n",
        "\n",
        "We solve:\n",
        "\n",
        "$$\\begin{aligned}\n",
        "w_t &= \\alpha w_{xx}, \\quad 0 < x < 1, \\\\\n",
        "w(0,t) &= w(1,t) = 0, \\\\\n",
        "w(x,0) &= 1.\n",
        "\\end{aligned}$$\n",
        "\n",
        "Use Fourier sine series:\n",
        "\n",
        "$$w(x,t) = \\sum_{n=1}^\\infty b_n e^{-\\alpha (n\\pi)^2 t} \\sin(n\\pi x)$$\n",
        "\n",
        "where the coefficients $b_n$ come from:\n",
        "\n",
        "$$b_n = 2 \\int_0^1 1 \\cdot \\sin(n\\pi x)\\, dx = \\frac{2}{n\\pi}(1 - \\cos(n\\pi)) = \\begin{cases}\n",
        "\\frac{4}{n\\pi}, & \\text{if } n \\text{ odd}, \\\\\n",
        "0, & \\text{if } n \\text{ even}.\n",
        "\\end{cases}$$\n",
        "\n",
        "So,\n",
        "\n",
        "$$w(x,t) = \\sum_{\\substack{n=1 \\\\ n \\text{ odd}}}^\\infty \\frac{4}{n\\pi} e^{-\\alpha (n\\pi)^2 t} \\sin(n\\pi x)$$\n",
        "\n",
        "**Step 4:** $~$ Final answer for $u(x,t)$\n",
        "\n",
        "$$\n",
        "u(x,t) = e^{\\frac{\\nu}{2\\alpha}x + \\frac{\\nu^2}{4\\alpha}t - \\beta t} \\sum_{\\substack{n=1\\\\n \\text{ odd}}}^{\\infty} \\frac{4}{n\\pi} e^{-\\alpha (n\\pi)^2 t} \\sin(n\\pi x)\n",
        "$$\n",
        "\n",
        "$~$\n",
        "\n",
        "**6.** $~$ Solve the problem\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_t &= u_{xx}, \\;\\;0<x<1, \\;\\; 0<t<\\infty\\\\ \n",
        " &u(0,t)=0\\\\ \n",
        " &u(1,t)=\\cos t \\\\ \n",
        " &u(x,0)=x \n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "by\n",
        "\n",
        "$(a)~$ transforming it to one with zero BCs\n",
        "\n",
        "$(b)~$ solving the resulting problem\n",
        "\n",
        "**Solution**\n",
        "\n",
        "$(a)$\n",
        "\n",
        "Let’s define:\n",
        "\n",
        "$$u(x,t) = v(x,t) + w(x,t)$$\n",
        "\n",
        "where $w(x,t)$ is chosen so that it satisfies the boundary conditions, and thus the new function $v(x,t)$ will satisfy homogeneous (zero) boundary conditions.\n",
        "\n",
        "We want:\n",
        "\n",
        "$$\\begin{cases}\n",
        "w(0,t) = 0 \\\\\n",
        "w(1,t) = \\cos t\n",
        "\\end{cases}$$\n",
        "\n",
        "We can try a linear function in $x$:\n",
        "\n",
        "$$w(x,t) = x \\cos t$$\n",
        "\n",
        "Then we compute the equation for $v$:\n",
        "\n",
        "* $u_t = v_t + \\partial_t(x \\cos t) = v_t - x \\sin t$\n",
        "* $u_{xx} = v_{xx} + \\partial_{xx}(x \\cos t) = v_{xx} + 0$ (since $x \\cos t$ is linear in $x$)\n",
        "\n",
        "So the equation becomes:\n",
        "\n",
        "$$v_t - x \\sin t = v_{xx}\n",
        "\\; \\Rightarrow \\;\n",
        "v_t = v_{xx} + x \\sin t$$\n",
        "\n",
        "And the transformed problem is:\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "v_t &= v_{xx} + x \\sin t, &&0 < x < 1,\\; t > 0 \\\\\n",
        "v(0,t) &= 0, \\\\\n",
        "v(1,t) &= 0, \\\\\n",
        "v(x,0) &= u(x,0) - x \\cos(0) = x - x = 0\n",
        "\\end{aligned}$$\n",
        "\n",
        "$(b)$\n",
        "\n",
        "**Step 1:** $~$ Apply the Fourier sine transform\n",
        "\n",
        "Let’s define the sine transform:\n",
        "\n",
        "$$\\mathcal{F}[v(x,t)] = \\hat{v}_n(t) = \\int_0^1 v(x,t) \\sin(n\\pi x)\\, dx$$\n",
        "\n",
        "Apply this transform to both sides of the PDE:\n",
        "\n",
        "Left-hand side (time derivative):\n",
        "\n",
        "$$\\mathcal{F}[v_t(x,t)] = \\frac{d}{dt} \\hat{v}_n(t)$$\n",
        "\n",
        "Right-hand side:\n",
        "\n",
        "$$\\mathcal{F}[v_{xx}(x,t)] = -n^2 \\pi^2 \\hat{v}_n(t)$$\n",
        "\n",
        "$$\\mathcal{F}[x\\sin t] = \\sin t \\cdot \\int_0^1 x \\sin(n\\pi x)\\, dx = \\sin t \\cdot \\frac{(-1)^{n+1}}{n\\pi}$$\n",
        "\n",
        "**Step 2:** $~$ Solve the ODE for $\\hat{v}_n(t)$\n",
        "\n",
        "Let’s write the equation again:\n",
        "\n",
        "$$\\hat{v}_n’(t) + n^2 \\pi^2 \\hat{v}_n(t) = \\frac{(-1)^{n+1}}{n\\pi} \\sin t$$\n",
        "\n",
        "Use integrating factor:\n",
        "\n",
        "$$\\mu(t) = e^{n^2 \\pi^2 t}\n",
        "\\Rightarrow \\frac{d}{dt} \\left[ e^{n^2 \\pi^2 t} \\hat{v}_n(t) \\right] = \\frac{(-1)^{n+1}}{n\\pi} \\sin t \\cdot e^{n^2 \\pi^2 t}$$\n",
        "\n",
        "Now integrate both sides from $0$ to $t$:\n",
        "\n",
        "$$e^{n^2 \\pi^2 t} \\hat{v}_n(t)\n",
        "= \\frac{(-1)^{n+1}}{n\\pi} \\int_0^t \\sin s \\cdot e^{n^2 \\pi^2 s} \\, ds$$\n",
        "\n",
        "So the solution in the transform domain is:\n",
        "\n",
        "$$\\hat{v}_n(t) = \\frac{(-1)^{n+1}}{n\\pi} \\int_0^t \\sin s \\cdot e^{n^2 \\pi^2 (s -t)} \\, ds$$\n",
        "\n",
        "**Step 3:** $~$ Invert the Fourier sine transform\n",
        "\n",
        "Recall:\n",
        "\n",
        "$$v(x,t) = \\sum_{n=1}^\\infty \\hat{v}_n(t) \\sin(n\\pi x)$$\n",
        "\n",
        "Substitute the expression for $\\hat{v}_n(t)$:\n",
        "\n",
        "$$v(x,t) = \\sum_{n=1}^\\infty \\left[\n",
        "\\frac{(-1)^{n+1}}{n\\pi} \\int_0^t \\sin s \\cdot e^{n^2 \\pi^2 (s -t)} \\, ds\n",
        "\\right] \\sin(n\\pi x)$$\n",
        "\n",
        "This gives us the complete solution for $v(x,t)$ using the Fourier sine transform method\n",
        "\n",
        "So the full solution is:\n",
        "\n",
        "$$u(x,t) =\n",
        "\\sum_{n=1}^\\infty \\left[\n",
        "\\frac{(-1)^{n+1}}{n\\pi} \\int_0^t \\sin s \\cdot e^{n^2 \\pi^2 (s -t)} \\, ds\n",
        "\\right] \\sin(n\\pi x)\n",
        "\t+x \\cos t$$"
      ],
      "id": "7ce263f2"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "from scipy.integrate import quad\n",
        "\n",
        "# number of Fourier-terms\n",
        "N_terms = 20  \n",
        "\n",
        "# Define parameters\n",
        "L = 1\n",
        "x_vals = np.linspace(0, L, 200)\n",
        "\n",
        "# times at which to plot u(x, t)\n",
        "t_vals = [1e-2, 1.5, 3.0, 4.5, 6.0] \n",
        "\n",
        "# Compute u(x, t)\n",
        "def compute_u(x, t, N=N_terms):\n",
        "    u = x *np.cos(t)  # add x cos t term\n",
        "    for n in range(1, N +1):\n",
        "        n_pi = n *np.pi\n",
        "        prefactor = (-1)**(n +1) /n_pi\n",
        "        \n",
        "        # Integrate I_n(t)\n",
        "        integrand = lambda s: np.sin(s) *np.exp(n_pi**2 *(s -t))\n",
        "        I_n, _ = quad(integrand, 0, t)\n",
        "        \n",
        "        A_n = prefactor *I_n\n",
        "        u += A_n *np.sin(n_pi *x)\n",
        "    return u\n",
        "\n",
        "# Plot\n",
        "plt.figure(figsize=(6, 4))\n",
        "for t in t_vals:\n",
        "    u_vals = [compute_u(x, t) for x in x_vals]\n",
        "    plt.plot(x_vals, u_vals, label=f\"t = {t}\")\n",
        "\n",
        "plt.title(\"u(x,t) to the heat equation with nonhomogeneous BC\")\n",
        "plt.xlabel(\"x\")\n",
        "plt.ylabel(\"u(x,t)\")\n",
        "plt.legend()\n",
        "plt.grid(True)\n",
        "plt.show()"
      ],
      "id": "75f7c33c",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "$~$\n",
        "\n",
        "**7.** $~$ Solve the problem\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        " u_t &= u_{xx} -u + x, \\;\\;0<x<1, \\;\\; 0<t<\\infty\\\\ \n",
        " &u(0,t)=0\\\\ \n",
        " &u(1,t)=1\\\\ \n",
        " &u(x,0)=0 \n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "by\n",
        "\n",
        "$(a)~$ changing the nonhomogeneous BCs to homogeneous ones\n",
        "\n",
        "$(b)~$ transforming into a new equation without the term $-u$\n",
        "\n",
        "$(c)~$ solving the resulting problem\n",
        "\n",
        "**Solution**\n",
        "\n",
        "$(a)~$ Make the boundary conditions homogeneous\n",
        "\n",
        "Let’s define a new function:\n",
        "\n",
        "$$u(x,t) = v(x,t) + w(x)$$\n",
        "\n",
        "Choose $w(x)$ to satisfy the boundary conditions:\n",
        "\n",
        "$$\\begin{cases}\n",
        "w(0) = 0 \\\\\n",
        "w(1) = 1\n",
        "\\end{cases}$$\n",
        "\n",
        "Let’s take the linear function:\n",
        "\n",
        "$$w(x) = x$$\n",
        "\n",
        "Then:\n",
        "\n",
        "$$u(x,t) = v(x,t) + x \\; \\Rightarrow \\; v(x,t) = u(x,t) - x$$\n",
        "\n",
        "Now we compute:\n",
        "* $u_t = v_t$\n",
        "* $u_{xx} = v_{xx} + w''(x) = v_{xx} + 0 = v_{xx}$ (since $x'' = 0$)\n",
        "* $u = v + x$\n",
        "\n",
        "Substitute into the original PDE:\n",
        "\n",
        "$$u_t = u_{xx} - u + x\n",
        "\\Rightarrow v_t = v_{xx} - (v + x) + x = v_{xx} - v$$\n",
        "\n",
        "So the PDE for $v$ is:\n",
        "\n",
        "$$v_t = v_{xx} - v$$\n",
        "\n",
        "And the initial and boundary conditions become:\n",
        "\n",
        "* $v(0,t) = u(0,t) - 0 = 0$\n",
        "* $v(1,t) = u(1,t) - 1 = 0$\n",
        "* $v(x,0) = u(x,0) - x = -x$\n",
        "\n",
        "Transformed problem for $v(x,t)$:\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "v_t &= v_{xx} - v, \\quad 0 < x < 1,\\; t > 0 \\\\\n",
        "v(0,t) &= v(1,t) = 0 \\\\\n",
        "v(x,0) &= -x\n",
        "\\end{aligned}$$\n",
        "\n",
        "$(b)~$ Eliminate the reaction term $-v$ by a second transformation\n",
        "\n",
        "Let:\n",
        "\n",
        "$$v(x,t) = e^{-t} z(x,t)$$\n",
        "\n",
        "Then:\n",
        "\n",
        "* $v_t = -e^{-t} z + e^{-t} z_t = e^{-t}(z_t - z)$\n",
        "* $v_{xx} = e^{-t} z_{xx}$\n",
        "\n",
        "Substitute into $v_t = v_{xx} - v$:\n",
        "\n",
        "$$e^{-t}(z_t - z) = e^{-t} z_{xx} - e^{-t} z\n",
        "\\Rightarrow z_t - z = z_{xx} - z\n",
        "\\Rightarrow z_t = z_{xx}$$\n",
        "\n",
        "So now we have the heat equation!\n",
        "\n",
        "From $v = e^{-t} z\\,$ at $t = 0$:\n",
        "\n",
        "$$z(x,0) = v(x,0) = -x$$\n",
        "\n",
        "And since $v(0,t) = v(1,t) = 0$, $\\,$ we have:\n",
        "\n",
        "$$z(0,t) = z(1,t) = 0$$\n",
        "\n",
        "**Final simplified problem:**\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "z_t &= z_{xx}, \\quad 0 < x < 1,\\; t > 0 \\\\\n",
        "z(0,t) &= z(1,t) = 0 \\\\\n",
        "z(x,0) &= -x\n",
        "\\end{aligned}$$\n",
        "\n",
        "$(c)~$ Solve the simplified heat equation\n",
        "\n",
        "We solve this using separation of variables / Fourier series\n",
        "\n",
        "**Step 1:** $~$ Expand initial condition in sine series\n",
        "\n",
        "$$z(x,0) = -x = \\sum_{n=1}^\\infty A_n \\sin(n\\pi x)$$\n",
        "\n",
        "Compute coefficients:\n",
        "\n",
        "$$A_n = 2 \\int_0^1 (-x) \\sin(n\\pi x) dx\n",
        "= -2 \\int_0^1 x \\sin(n\\pi x) dx$$\n",
        "\n",
        "Use integration by parts:\n",
        "\n",
        "$$\\int_0^1 x \\sin(n\\pi x) dx = \\frac{(-1)^{n+1}}{n\\pi}\n",
        "\\Rightarrow A_n = \\frac{2(-1)^{n}}{n\\pi}$$\n",
        "\n",
        "**Step 2:** $~$ General solution for $z(x,t)$\n",
        "\n",
        "$$z(x,t) = \\sum_{n=1}^\\infty A_n e^{-n^2 \\pi^2 t} \\sin(n\\pi x)\n",
        "= \\sum_{n=1}^\\infty \\frac{2(-1)^n}{n\\pi} e^{-n^2 \\pi^2 t} \\sin(n\\pi x)$$\n",
        "\n",
        "**Step 3:** $~$ Back-substitute to get $u(x,t)$\n",
        "\n",
        "So finally:\n",
        "\n",
        "$$u(x,t) = x + e^{-t} \\sum_{n=1}^\\infty \\frac{2(-1)^n}{n\\pi} e^{-n^2 \\pi^2 t} \\sin(n\\pi x)$$\n",
        "\n",
        "**Final Answer:**\n",
        "\n",
        "$$\n",
        "\\boxed{\n",
        "u(x,t) = x + \\sum_{n=1}^\\infty \\frac{2(-1)^n}{n\\pi} e^{-(n^2 \\pi^2 + 1)t} \\sin(n\\pi x)\n",
        "}$$"
      ],
      "id": "f33d18b4"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "# Re-import necessary libraries after kernel reset\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "import matplotlib.animation as animation\n",
        "from IPython.display import HTML\n",
        "\n",
        "# Spatial domain\n",
        "x = np.linspace(0, 1, 200)\n",
        "\n",
        "# Number of Fourier terms\n",
        "N = 50\n",
        "\n",
        "# Time parameters\n",
        "t_vals = np.linspace(0, 1, 100)  # from t=0 to t=1.5\n",
        "\n",
        "# Precompute sin(nπx) terms\n",
        "sin_terms = np.array([np.sin(n *np.pi *x) for n in range(1, N +1)])\n",
        "\n",
        "# Compute the solution u(x, t) at each time t\n",
        "def compute_u_xt(t):\n",
        "    coeffs = np.array([\n",
        "        (2 *(-1)**n) /(n *np.pi) \n",
        "          *np.exp(-(n**2 *np.pi**2 +1) *t)\n",
        "        for n in range(1, N +1)\n",
        "    ])\n",
        "    v_xt = np.dot(coeffs, sin_terms)\n",
        "    return x +v_xt  # u = x +e^{-t} *z(x,t)\n",
        "\n",
        "# Set up the plot\n",
        "fig, ax = plt.subplots(figsize=(6, 4))\n",
        "\n",
        "line, = ax.plot([], [], lw=2)\n",
        "ax.set_xlim(0, 1)\n",
        "ax.set_ylim(-0.1, 1.1)\n",
        "ax.set_xlabel('x')\n",
        "ax.set_ylabel('u(x,t)')\n",
        "title = ax.set_title(\"\")\n",
        "\n",
        "# Initialization function\n",
        "def init():\n",
        "    line.set_data([], [])\n",
        "    title.set_text(\"\")\n",
        "    return line, title\n",
        "\n",
        "# Animation update function\n",
        "def update(frame):\n",
        "    t = t_vals[frame]\n",
        "    u = compute_u_xt(t)\n",
        "    line.set_data(x, u)\n",
        "    title.set_text(f\"u(x, t) at t = {t:.2f}\")\n",
        "    return line, title\n",
        "\n",
        "# Create animation\n",
        "ani = animation.FuncAnimation(\n",
        "    fig, update, frames=len(t_vals),\n",
        "    init_func=init, blit=True, interval=80\n",
        ")\n",
        "\n",
        "plt.close()\n",
        "HTML('<center>' + ani.to_html5_video() + '</center>')"
      ],
      "id": "602662c3",
      "execution_count": null,
      "outputs": []
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/opt/miniconda3/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}