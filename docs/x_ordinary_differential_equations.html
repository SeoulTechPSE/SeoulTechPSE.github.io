<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix H — Ordinary Differential Equations – Engineering Mathematics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./x_double_pendulum.html" rel="next">
<link href="./x_integration.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./x_numpy_vectors_matrices_and_multidimensional_arrays.html">Appendices</a></li><li class="breadcrumb-item"><a href="./x_ordinary_differential_equations.html"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Ordinary Differential Equations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Engineering Mathematics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>First Semester</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_01_Introduction_to_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_02_First-Order_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">First-Order Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_03_Higher-Order_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Higher-Order Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_04_The_Laplace_Transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Laplace Transform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_05_Series_Solutions_of_Linear_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Series Solutions of Linear Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_08_Matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_10_Systems_of_Linear_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Systems of Linear Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_11_Systems_of_Nonlinear_Differential_Equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Systems of Nonlinear Differential Equations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Second Semester</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_07_Vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Vectors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_09_Vector_Calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Vector Calculus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_12_Orthogonal_Functions_and_Fourier_Series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Orthogonal Functions and Fourier Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_x1_Parabolic_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Parabolic Partial Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_x2_Hyperbolic_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Hyperbolic Partial Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch_x3_Elliptic_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Elliptic Partial Differential Equations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_numpy_vectors_matrices_and_multidimensional_arrays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Numpy: Vectors, Matrices, and Multidimensional Arrays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_sympy_symbolic_computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Sympy: Symbolic Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_sympy_Laplace_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Sympy: Laplace Transform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_equation_solving.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Equation Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Integration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_ordinary_differential_equations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Ordinary Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_double_pendulum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Double Pendulum</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_PDE_dedalus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">DEDALUS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_PDE_FEniCS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">The FEniCS computing platform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Matplotlib: Plotting and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x_Mandelbrot_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Mandelbrot Set in Python</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#importing-modules" id="toc-importing-modules" class="nav-link active" data-scroll-target="#importing-modules"><span class="header-section-number">H.1</span> Importing modules</a></li>
  <li><a href="#ordinary-differential-equations" id="toc-ordinary-differential-equations" class="nav-link" data-scroll-target="#ordinary-differential-equations"><span class="header-section-number">H.2</span> Ordinary differential equations</a></li>
  <li><a href="#symbolic-solution-to-odes" id="toc-symbolic-solution-to-odes" class="nav-link" data-scroll-target="#symbolic-solution-to-odes"><span class="header-section-number">H.3</span> Symbolic solution to ODEs</a>
  <ul class="collapse">
  <li><a href="#direction-fields" id="toc-direction-fields" class="nav-link" data-scroll-target="#direction-fields"><span class="header-section-number">H.3.1</span> Direction fields</a></li>
  <li><a href="#solving-odes-using-laplace-transformation" id="toc-solving-odes-using-laplace-transformation" class="nav-link" data-scroll-target="#solving-odes-using-laplace-transformation"><span class="header-section-number">H.3.2</span> Solving ODEs using Laplace Transformation</a></li>
  </ul></li>
  <li><a href="#numerical-methods-for-solving-odes" id="toc-numerical-methods-for-solving-odes" class="nav-link" data-scroll-target="#numerical-methods-for-solving-odes"><span class="header-section-number">H.4</span> Numerical methods for solving ODEs</a></li>
  <li><a href="#numerical-integration-of-odes-using-scipy" id="toc-numerical-integration-of-odes-using-scipy" class="nav-link" data-scroll-target="#numerical-integration-of-odes-using-scipy"><span class="header-section-number">H.5</span> Numerical integration of ODEs using <code>scipy</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./x_numpy_vectors_matrices_and_multidimensional_arrays.html">Appendices</a></li><li class="breadcrumb-item"><a href="./x_ordinary_differential_equations.html"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Ordinary Differential Equations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-ordinary-differential-equations" class="quarto-section-identifier">Appendix H — Ordinary Differential Equations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this appendix, we will explore both symbolic and numerical approaches to solving ODE problems. For symbolic methods, we use the <code>sympy</code> module, and for numerical integration of ODEs, we use functions from the <code>integrate</code> module in <code>scipy</code></p>
<section id="importing-modules" class="level2" data-number="H.1">
<h2 data-number="H.1" class="anchored" data-anchor-id="importing-modules"><span class="header-section-number">H.1</span> Importing modules</h2>
<div id="1f79c192" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sympy</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> pi</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sympy.init_printing()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d.axes3d <span class="im">import</span> Axes3D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ordinary-differential-equations" class="level2" data-number="H.2">
<h2 data-number="H.2" class="anchored" data-anchor-id="ordinary-differential-equations"><span class="header-section-number">H.2</span> Ordinary differential equations</h2>
<ul>
<li><p>The simplest form of an ordinary differential equation is</p>
<p><span class="math display">\[ \frac{dy(x)}{dx} = f(x,y(x))\]</span></p>
<p>where <span class="math inline">\(y(x)\)</span> is the unknown function and <span class="math inline">\(f(x, y(x))\)</span> is known. <span class="math inline">\(\,\)</span>Only the first derivative occurs in the equation, and it is therefore an example of <span style="color:red">a first-order ODE</span></p></li>
<li><p>More generally, <span class="math inline">\(~\)</span>we can write an <span class="math inline">\(n\)</span>-th order ODE in <span style="color:green"><em>explicit form</em></span> as</p>
<p><span class="math display">\[ \frac{d^ny}{dx^n} = f\left(x,y,\frac{dy}{dx},\cdots,\frac{d^{n-1}y}{dx^{n-1}}\right)\]</span></p></li>
<li><p>or in <span style="color:green"><em>implicit form</em></span> as</p>
<p><span class="math display">\[ F\left(x,y,\frac{dy}{dx},\cdots,\frac{d^{n}y}{dx^{n}}\right)=0\]</span></p>
<p>where <span class="math inline">\(f\)</span> and <span class="math inline">\(F\)</span> are known functions.</p>
<p>The general solution of an <span class="math inline">\(n\)</span>-th order ODE have <span class="math inline">\(n\)</span> free parameters that we need to specify, for example, as initial conditions for the unknown function and <span class="math inline">\(n -1\)</span> of its derivatives</p>
<p><span class="math display">\[y(0)=y_0, y'(0)=y_1, \cdots, y^{n-1}(0)=y_{n-1}\]</span></p></li>
<li><p>An ODE can always be rewritten as a system of first-order ODEs. Specifically, the <span class="math inline">\(n\)</span>-th order ODE on the explicit form can be written in the standard form by introducing <span class="math inline">\(n\)</span> new functions</p>
<p><span class="math display">\[y_1 = y,\, y_2=\frac{dy}{dx},\, \cdots,\, y_n = \frac{dy^{n-1}}{dx^{n-1}}\]</span></p>
<p>This gives the following system of first-order ODEs:</p>
<p><span class="math display">\[\frac{d}{dx}
  \begin{bmatrix}
  y_1\\
  \vdots\\
  y_{n-1}\\
  y_n
  \end{bmatrix}
  =
  \begin{bmatrix}
  y_2\\
  \vdots\\
  y_n\\
  f(x,y_1,\cdots, y_n)
  \end{bmatrix}
\]</span></p></li>
<li><p>which also can be written in a more compact vector form:</p>
<p><span class="math display">\[\frac{d\mathbf{y}}{dx} = \mathbf{f}(x,\mathbf{y}(x))\]</span></p>
<p>This canonical form is particularly useful for numerical solutions of ODEs, and it is common that numerical methods for solving ODEs take the function <span class="math inline">\(\mathbf{f} = (f_1, f_2,\cdots,f_n)\)</span></p></li>
<li><p>If the functions <span class="math inline">\(f_1, f_2, \cdots, f_n\)</span> are all linear, then the corresponding system of ODEs can be written on the simple form</p>
<p><span class="math display">\[ \frac{d\mathbf{y}}{dx} = \mathbf{A}(\mathbf{x})\mathbf{y}(\mathbf{x}) +\mathbf{r}(\mathbf{x}),\]</span></p>
<p>where <span class="math inline">\(\mathbf{A}(\mathbf{x})\)</span> is an <span class="math inline">\(n\times n\)</span> matrix, and <span class="math inline">\(\mathbf{r}(\mathbf{x})\)</span> is an <span class="math inline">\(n\)</span>-vector, that only depends on <span class="math inline">\(\mathbf{x}\)</span>. In this form, the <span class="math inline">\(\mathbf{r}(\mathbf{x})\)</span> is known as the source term, and the linear system is known as homogeneous if <span class="math inline">\(\mathbf{r}(\mathbf{x})=\mathbf{0}\)</span>, and nonhomogeneous otherwise</p></li>
<li><p>For certain properties and forms of the function <span class="math inline">\(\mathbf{f}(\mathbf{x}, \mathbf{y}(\mathbf{x}))\)</span>, there may be known solutions and special methods for solving the corresponding ODE problem, but there is no general method for an arbitrary <span class="math inline">\(\mathbf{f}(\mathbf{x}, \mathbf{y}(\mathbf{x}))\)</span>, other than approximate numerical methods</p></li>
<li><p>In addition to the properties of <span class="math inline">\(\mathbf{f}(\mathbf{x}, \mathbf{y}(\mathbf{x}))\)</span>, the boundary conditions for an ODE also influence the solvability of the ODE problem, as well as which numerical approaches are available. There are two main types of boundary conditions for ODE problems: initial value conditions and boundary value conditions</p></li>
</ul>
</section>
<section id="symbolic-solution-to-odes" class="level2" data-number="H.3">
<h2 data-number="H.3" class="anchored" data-anchor-id="symbolic-solution-to-odes"><span class="header-section-number">H.3</span> Symbolic solution to ODEs</h2>
<ul>
<li><p><code>Sympy</code> provides a generic ODE solver <code>sympy.dsolve</code>, which is able to find analytical solutions to many elementary ODEs. The <code>sympy.dsolve</code> function attempts to automatically classify a given ODE, and it may attempt a variety of techniques to find its solution</p></li>
<li><p>While <code>dsolve</code> can be used to solve many simple ODEs symbolically, as we will see in the following, it is worth keeping in mind that most ODEs cannot be solved analytically. Typical examples of ODEs where one can hope to find a symbolic solution are ODEs of first or second-order, or linear systems of first-order ODEs with only a few unknown functions</p></li>
<li><p>The first example is the simple first-order ODE for Newton’s cooling law,</p>
<p><span class="math display">\[\frac{dT(t)}{dt} = -k(T(t) -T_a)\]</span></p>
<p>with the initial value <span class="math inline">\(T(0) = T_0\)</span></p></li>
</ul>
<div id="34f9e74a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>t, k, T0, Ta <span class="op">=</span> sympy.symbols(<span class="st">'t, k, T_0, T_a'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> sympy.Function(<span class="st">'T'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ode <span class="op">=</span> T(t).diff(t) <span class="op">+</span>k <span class="op">*</span>(T(t) <span class="op">-</span> Ta)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># display the equation including the equality sign </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and a right-hand side that is zero</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>sympy.Eq(ode, <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="2">
<p><span class="math inline">\(\displaystyle k \left(- T_{a} + T{\left(t \right)}\right) + \frac{d}{d t} T{\left(t \right)} = 0\)</span></p>
</div>
</div>
<div id="41d7c43f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ode_sol <span class="op">=</span> sympy.dsolve(ode)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ode_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="3">
<p><span class="math inline">\(\displaystyle T{\left(t \right)} = C_{1} e^{- k t} + T_{a}\)</span></p>
</div>
</div>
<ul>
<li>The return value from <code>sympy.dsolve</code> is an instance of <code>sympy.Eq</code>, which is a symbolic representation of an equality</li>
</ul>
<div id="4b7e430d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ode_sol.lhs, ode_sol.rhs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="4">
<p><span class="math inline">\(\displaystyle \left( T{\left(t \right)}, \  C_{1} e^{- k t} + T_{a}\right)\)</span></p>
</div>
</div>
<ul>
<li><p>Once the general solution has been found, <span class="math inline">\(\,\)</span>we need to use the initial conditions to find the values of the yet-to-be-determined integration constants</p></li>
<li><p>We first create a dictionary that describes the initial condition, <code>ics = {T(0): T0}</code>, which we can use with <code>sympy</code>’s <code>subs</code> method to apply the initial condition to the solution of the ODE. This results in an equation for the unknown integration constant <span class="math inline">\(C_1\)</span>:</p></li>
</ul>
<div id="81072295" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ics <span class="op">=</span> {T(<span class="dv">0</span>): T0}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>C_eq <span class="op">=</span> sympy.Eq(ode_sol.lhs.subs(t, <span class="dv">0</span>).subs(ics), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                ode_sol.rhs.subs(t, <span class="dv">0</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>C_eq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="5">
<p><span class="math inline">\(\displaystyle T_{0} = C_{1} + T_{a}\)</span></p>
</div>
</div>
<ul>
<li>In the present example, the equation for <span class="math inline">\(C_1\)</span> is trivial to solve, but for the sake of generality, here we solve it using <code>sympy.solve</code>:</li>
</ul>
<div id="9e706789" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>C_sol <span class="op">=</span> sympy.solve(C_eq)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>C_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="6">
<p><span class="math inline">\(\displaystyle \left[ \left\{ C_{1} : T_{0} - T_{a}\right\}\right]\)</span></p>
</div>
</div>
<div id="3f2cd3db" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ode_sol.subs(C_sol[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="7">
<p><span class="math inline">\(\displaystyle T{\left(t \right)} = T_{a} + \left(T_{0} - T_{a}\right) e^{- k t}\)</span></p>
</div>
</div>
<ul>
<li>Applying the initial conditions and solving for the undetermined integration constants can be slightly tedious, and it worth while to collect these steps in a reusable function. The following function <code>apply_ics</code> is a basic implementation that generalizes these steps to a differential equation of arbitrary order</li>
</ul>
<div id="779dedec" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_ics(sol, ics, x, known_params):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply the initial conditions (ics), </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    given as a dictionary on the form </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ics = {y(0): y0, y(x).diff(x).subs(x, 0): y1, ...}</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    to the solution of the ODE with independent variable x</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    The undetermined integration constants </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">    C1, C2, ... </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">    are extracted from the free symbols of the ODE solution, </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">    excluding symbols in the known_params list</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    free_params <span class="op">=</span> sol.free_symbols <span class="op">-</span> <span class="bu">set</span>(known_params)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    eqs <span class="op">=</span> [(sol.lhs.diff(x, n) </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span> sol.rhs.diff(x, n)).subs(x, <span class="dv">0</span>).subs(ics)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ics))]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    sol_params <span class="op">=</span> sympy.solve(eqs, free_params)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol.subs(sol_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a14a62f7" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>T_sol <span class="op">=</span> apply_ics(ode_sol, ics, t, [k, Ta])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>T_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="9">
<p><span class="math inline">\(\displaystyle T{\left(t \right)} = T_{a} + \left(T_{0} - T_{a}\right) e^{- k t}\)</span></p>
</div>
</div>
<div id="c67db00c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">100</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sympy.lambdify((t, k), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                   T_sol.rhs.subs({T0: <span class="dv">5</span>, Ta: <span class="dv">1</span>}), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'numpy'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  ax.plot(x, y(x, k), label<span class="op">=</span><span class="vs">rf'</span><span class="dv">$</span><span class="vs">k=</span><span class="sc">{</span>k<span class="sc">}</span><span class="dv">$</span><span class="vs">'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="vs">rf'</span><span class="dv">$</span><span class="sc">{</span>sympy<span class="sc">.</span>latex(T_sol)<span class="sc">}</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">x</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">y</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>ax.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>, axis<span class="op">=</span><span class="st">'x'</span>, pad<span class="op">=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>As an example of a slightly more complicated problem, <span class="math inline">\(\,\)</span>consider the ODE for a damped harmonic oscillator, which is a second-order ODE on the form</p>
<p><span class="math display">\[ \frac{d^2x(t)}{dt^2} +2\gamma \omega_0 \frac{dx(t)}{dt} +\omega_0^2 x(t) = 0\]</span></p>
<p>where <span class="math inline">\(x(t)\)</span> is the position of the oscillator at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\,\omega_0\)</span> is the frequency for the undamped case, and <span class="math inline">\(\,\gamma\)</span> is the damping ratio</p></li>
</ul>
<div id="ce927971" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>t, omega0, gamma <span class="op">=</span> sympy.symbols(<span class="st">'t, omega_0, gamma'</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                 positive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sympy.Function(<span class="st">"x"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ode <span class="op">=</span> (x(t).diff(t, <span class="dv">2</span>) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span><span class="dv">2</span> <span class="op">*</span>gamma<span class="op">*</span> omega0 <span class="op">*</span>x(t).diff(t) </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span>omega0<span class="op">**</span><span class="dv">2</span> <span class="op">*</span>x(t))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>sympy.Eq(ode, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="11">
<p><span class="math inline">\(\displaystyle 2 \gamma \omega_{0} \frac{d}{d t} x{\left(t \right)} + \omega_{0}^{2} x{\left(t \right)} + \frac{d^{2}}{d t^{2}} x{\left(t \right)} = 0\)</span></p>
</div>
</div>
<div id="fdd3d6f2" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ode_sol <span class="op">=</span> sympy.dsolve(ode)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ode_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="12">
<p><span class="math inline">\(\displaystyle x{\left(t \right)} = C_{1} e^{\omega_{0} t \left(- \gamma + \sqrt{\gamma - 1} \sqrt{\gamma + 1}\right)} + C_{2} e^{- \omega_{0} t \left(\gamma + \sqrt{\gamma - 1} \sqrt{\gamma + 1}\right)}\)</span></p>
</div>
</div>
<ul>
<li>Since this is a second-order ODE, there are two undetermined integration constants in the general solution. We need to specify initial conditions for both the position <span class="math inline">\(x(0)\)</span> and the velocity <span class="math inline">\(x'(0)\)</span> to single out a particular solution to the ODE</li>
</ul>
<div id="6bf5bdc8" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ics <span class="op">=</span> {x(<span class="dv">0</span>): <span class="dv">1</span>, x(t).diff(t).subs(t, <span class="dv">0</span>): <span class="dv">0</span>}</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>x_sol <span class="op">=</span> apply_ics(ode_sol, ics, t, [omega0, gamma])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>C1 <span class="op">=</span> x_sol.rhs.args[<span class="dv">0</span>].args[<span class="dv">0</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>C1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="13">
<p><span class="math inline">\(\displaystyle \frac{\gamma}{2 \sqrt{\gamma - 1} \sqrt{\gamma + 1}} + \frac{1}{2}\)</span></p>
</div>
</div>
<div id="cecbe02b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>C2 <span class="op">=</span> x_sol.rhs.args[<span class="dv">1</span>].args[<span class="dv">0</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>C2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="14">
<p><span class="math inline">\(\displaystyle - \frac{\gamma}{2 \sqrt{\gamma - 1} \sqrt{\gamma + 1}} + \frac{1}{2}\)</span></p>
</div>
</div>
<ul>
<li>This is the solution for the dynamics of the oscillator for arbitrary values of <span class="math inline">\(t\)</span>, <span class="math inline">\(\omega_0\)</span> and <span class="math inline">\(\gamma\)</span>. <span class="math inline">\(~\)</span>However, substituting <span class="math inline">\(\gamma = 1\)</span>, <span class="math inline">\(\,\)</span>which corresponds to critical damping, directly into this expression results in <em>a division by zero</em> error, and for this particular choice of <span class="math inline">\(\gamma\)</span>, we need to be careful and compute the limit where <span class="math inline">\(\gamma \rightarrow 1\)</span></li>
</ul>
<div id="eb5b8871" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x_critical <span class="op">=</span> sympy.limit(x_sol.rhs, gamma, <span class="dv">1</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x_critical</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="15">
<p><span class="math inline">\(\displaystyle \left(\omega_{0} t + 1\right) e^{- \omega_{0} t}\)</span></p>
</div>
</div>
<ul>
<li>Finally, <span class="math inline">\(\,\)</span>we plot the solutions for <span class="math inline">\(\omega_0 = 2\pi\)</span> and a sequence of different values of the damping ratio <span class="math inline">\(\gamma\)</span></li>
</ul>
<div id="e16040f3" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>tt <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">250</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> [<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">2.0</span>, <span class="fl">5.0</span>]:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        x_t <span class="op">=</span> sympy.lambdify(t, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>          x_critical.subs({omega0: <span class="fl">2.0</span> <span class="op">*</span>pi}), <span class="st">'numpy'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        x_t <span class="op">=</span> sympy.lambdify(t, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>          x_sol.rhs.subs({omega0: <span class="fl">2.0</span> <span class="op">*</span>pi, gamma: g}), <span class="st">'numpy'</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt, x_t(tt).real, label<span class="op">=</span><span class="vs">rf'</span><span class="dv">$</span><span class="er">\</span><span class="vs">gamma = </span><span class="sc">{</span>g<span class="sc">: .1f}</span><span class="dv">$</span><span class="vs">'</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">t</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">x</span><span class="kw">(</span><span class="vs">t</span><span class="kw">)</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="dv">1</span>, <span class="fl">1.5</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>ax.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>, axis<span class="op">=</span><span class="st">'x'</span>, pad<span class="op">=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<ul>
<li>Even many first-order ODEs cannot be solved exactly in terms of elementary functions. For example, consider <span class="math inline">\(\displaystyle\frac{dy}{dx} = x +y^2\)</span>, <span class="math inline">\(\,\)</span>which is an example of an ODE that does not have any closed-form solution</li>
</ul>
<div id="6f3675d8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sympy.symbols(<span class="st">'x'</span>, positive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sympy.Function(<span class="st">'y'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> sympy.Function(<span class="st">'u'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> y(x)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span>x </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>ode <span class="op">=</span> y(x).diff(x) <span class="op">-</span>f</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>ode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="17">
<p><span class="math inline">\(\displaystyle - x - y^{2}{\left(x \right)} + \frac{d}{d x} y{\left(x \right)}\)</span></p>
</div>
</div>
<div id="5734916b" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sympy.classify_ode(ode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>('1st_rational_riccati', '1st_power_series', 'lie_group')</code></pre>
</div>
</div>
<ul>
<li>See <a href="ch_02_First-Order_Differential_Equations.html#sec-2-5" class="quarto-xref"><span>Section 2.5</span></a></li>
</ul>
<div id="37fbfc5e" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sympy bug: '1st_rational_riccati' not working</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>q0 <span class="op">=</span> x</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> sympy.Integer(<span class="st">'0'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>q2 <span class="op">=</span> sympy.Integer(<span class="st">'1'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> q2 <span class="op">*</span>q0</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> q1 <span class="op">+</span>q2.diff(x) <span class="op">/</span>q2</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>ode_ <span class="op">=</span> u(x).diff(x, <span class="dv">2</span>) <span class="op">-</span>R <span class="op">*</span>u(x).diff(x) <span class="op">+</span>S <span class="op">*</span>u(x)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>u_sol <span class="op">=</span> sympy.dsolve(ode_).rhs</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>u_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="19">
<p><span class="math inline">\(\displaystyle C_{1} Ai\left(- x\right) + C_{2} Bi\left(- x\right)\)</span></p>
</div>
</div>
<div id="b9b4be26" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>y_sol <span class="op">=</span> <span class="op">-</span>u_sol.diff(x) <span class="op">/</span>(q2 <span class="op">*</span>u_sol)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="20">
<p><span class="math inline">\(\displaystyle \frac{C_{1} Ai^\prime\left(- x\right) + C_{2} Bi^\prime\left(- x\right)}{C_{1} Ai\left(- x\right) + C_{2} Bi\left(- x\right)}\)</span></p>
</div>
</div>
<div id="8dfdce71" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>C1 <span class="op">=</span> sympy.Symbol(<span class="st">'C1'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>C1_ <span class="op">=</span> sympy.solve(y_sol.subs({x: <span class="dv">0</span>}), C1)[<span class="dv">0</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>C1_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="21">
<p><span class="math inline">\(\displaystyle \sqrt{3} C_{2}\)</span></p>
</div>
</div>
<div id="ff0dec56" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>y_sol <span class="op">=</span> y_sol.subs({C1: C1_}).cancel()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>y_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="22">
<p><span class="math inline">\(\displaystyle \frac{\sqrt{3} Ai^\prime\left(- x\right) + Bi^\prime\left(- x\right)}{\sqrt{3} Ai\left(- x\right) + Bi\left(- x\right)}\)</span></p>
</div>
</div>
<hr>
<ul>
<li><p>For many other types of equations, <code>sympy</code> outright fails to produce any solution at all. <span class="math inline">\(\,\)</span>For example, if we attempt to solve the second-order</p>
<p><span class="math display">\[\frac{d^2y}{dx^2} =x +y^2\]</span></p></li>
</ul>
<div id="792efc64" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sympy.Eq(y(x).diff(x, <span class="dv">2</span>), f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="23">
<p><span class="math inline">\(\displaystyle \frac{d^{2}}{d x^{2}} y{\left(x \right)} = x + y^{2}{\left(x \right)}\)</span></p>
</div>
</div>
<div id="2db47a5f" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  sympy.dsolve(y(x).diff(x, <span class="dv">2</span>) <span class="op">-</span>f)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>solve: Cannot solve -x - y(x)**2 + Derivative(y(x), (x, 2))</code></pre>
</div>
</div>
<section id="direction-fields" class="level3" data-number="H.3.1">
<h3 data-number="H.3.1" class="anchored" data-anchor-id="direction-fields"><span class="header-section-number">H.3.1</span> Direction fields</h3>
<ul>
<li><p>A direction field graph is a simple but useful technique to visualize possible solutions to arbitrary first-order ODEs. It is made up of short lines that show the slope of the unknown function on a grid in the <span class="math inline">\(x\)</span>–<span class="math inline">\(y\)</span> plane. This graph can be easily produced because the slope of <span class="math inline">\(y(x)\)</span> at arbitrary points of the <span class="math inline">\(x\)</span>–<span class="math inline">\(y\)</span> plane is given by the definition of the ODE:</p>
<p><span class="math display">\[\frac{dy}{dx}=f(x,y(x))\]</span></p>
<p>The reason why the direction field graph is useful is that smooth and continuous curves that tangent the slope lines (at every point) in the direction field graph are possible solutions to the ODE</p></li>
</ul>
<div id="e3e7703d" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_direction_field(x, y_x, f_xy, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>        x_lim<span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), y_lim<span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    f_np <span class="op">=</span> sympy.lambdify((x, y_x), f_xy, <span class="st">'numpy'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    x_vec <span class="op">=</span> np.linspace(x_lim[<span class="dv">0</span>], x_lim[<span class="dv">1</span>], <span class="dv">20</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    y_vec <span class="op">=</span> np.linspace(y_lim[<span class="dv">0</span>], y_lim[<span class="dv">1</span>], <span class="dv">20</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      _, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> x_vec[<span class="dv">1</span>] <span class="op">-</span>x_vec[<span class="dv">0</span>]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    dy <span class="op">=</span> y_vec[<span class="dv">1</span>] <span class="op">-</span>y_vec[<span class="dv">0</span>]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    scale <span class="op">=</span> <span class="fl">0.8</span> <span class="op">*</span>dx</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m, x_ <span class="kw">in</span> <span class="bu">enumerate</span>(x_vec):</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> n, y_ <span class="kw">in</span> <span class="bu">enumerate</span>(y_vec):</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        Dy <span class="op">=</span> f_np(x_, y_) <span class="op">*</span>dx</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        Dx <span class="op">=</span> scale <span class="op">*</span>dx <span class="op">/</span>np.sqrt(dx<span class="op">**</span><span class="dv">2</span> <span class="op">+</span>Dy<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        Dy <span class="op">=</span> scale <span class="op">*</span>Dy <span class="op">/</span>np.sqrt(dx<span class="op">**</span><span class="dv">2</span> <span class="op">+</span>Dy<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        ax.plot([x_ <span class="op">-</span>Dx<span class="op">/</span><span class="dv">2</span>, x_ <span class="op">+</span>Dx<span class="op">/</span><span class="dv">2</span>], </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>                [y_ <span class="op">-</span>Dy<span class="op">/</span><span class="dv">2</span>, y_ <span class="op">+</span>Dy<span class="op">/</span><span class="dv">2</span>], <span class="st">'b'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        ax.plot(x_ <span class="op">+</span>Dx<span class="op">/</span><span class="dv">2</span>, y_ <span class="op">+</span>Dy<span class="op">/</span><span class="dv">2</span>, <span class="st">'bo'</span>, ms<span class="op">=</span><span class="dv">2</span>)  </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(x_lim[<span class="dv">0</span>], x_lim[<span class="dv">1</span>])</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(y_lim[<span class="dv">0</span>], y_lim[<span class="dv">1</span>])</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    title_ <span class="op">=</span> sympy.latex(sympy.Eq(y(x).diff(x), f_xy))</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="vs">rf'</span><span class="dv">$</span><span class="sc">{</span>title_<span class="sc">}</span><span class="dv">$</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>With this function, we can produce the direction field graphs for the ODEs. The direction lines in the graphs suggest how the curves that are solutions to the corresponding ODE behave, and direction field graphs are therefore a useful tool for visualizing solutions to ODEs that cannot be solved analytically</li>
</ul>
<div id="4fa0dfd7" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sympy.symbols(<span class="st">'x'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sympy.Function(<span class="st">'y'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> y(x)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="308c3928" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># left panel</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plot_direction_field(x, y(x), f, ax<span class="op">=</span>ax)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>x_vec <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">300</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>y_vec <span class="op">=</span> sympy.lambdify(x, y_sol)(x_vec)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>y_vec[y_vec <span class="op">&gt;</span> threshold] <span class="op">=</span> np.inf</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>y_vec[y_vec <span class="op">&lt;-</span>threshold] <span class="op">=</span> np.inf</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>ax.plot(x_vec, y_vec, <span class="st">'r'</span>, lw<span class="op">=</span><span class="dv">2</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-28-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The following code generates the direction field graphs for</p>
<p><span class="math inline">\(f(x,y(x))=y^2(x) +x\)</span></p>
<p><span class="math inline">\(f(x,y(x))=-x/y(x)\)</span></p>
<p><span class="math inline">\(f(x,y(x))=y^2(x)/x\)</span></p></li>
</ul>
<div id="6eed46b8" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sympy.symbols(<span class="st">'x'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sympy.Function(<span class="st">'y'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">13</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>plot_direction_field(x, y(x), y(x)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span>x, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>plot_direction_field(x, y(x), <span class="op">-</span>x <span class="op">/</span>y(x), ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>plot_direction_field(x, y(x), y(x)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span>x, ax<span class="op">=</span>axes[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-29-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="solving-odes-using-laplace-transformation" class="level3" data-number="H.3.2">
<h3 data-number="H.3.2" class="anchored" data-anchor-id="solving-odes-using-laplace-transformation"><span class="header-section-number">H.3.2</span> Solving ODEs using Laplace Transformation</h3>
<ul>
<li><p>A technique that can be used to solve certain ODE problems is to do Laplace transform on the ODE, which for many problems results in an algebraic equation that is easier to solve. The solution to the algebraic equation can then be transformed back to the original domain with an inverse Laplace transform, to obtain the solution to the original problem. For example, consider the following differential equation for a driven harmonic oscillator:</p>
<p><span class="math display">\[ \frac{d^2 y}{dt^2} +2\frac{dy}{dt} +10y =2\sin 3t\]</span></p></li>
<li><p><a href="_laplace_transform_expansion.py">_laplace_trabsform_expansion.py</a></p>
<ul>
<li><p><code>laplace_tranform_()</code> is the expanded version of <code>laplace_transform()</code></p></li>
<li><p><code>subs_()</code> is the modified function of <code>sub()</code> method</p></li>
</ul></li>
</ul>
<div id="65049636" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> sympy.symbols(<span class="st">"t"</span>, positive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sympy.Function(<span class="st">"y"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>ode <span class="op">=</span> (y(t).diff(t, <span class="dv">2</span>) </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span><span class="dv">2</span> <span class="op">*</span>y(t).diff(t) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span><span class="dv">10</span> <span class="op">*</span>y(t) </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="dv">2</span> <span class="op">*</span>sympy.sin(<span class="dv">3</span><span class="op">*</span>t))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>ics <span class="op">=</span> {y(<span class="dv">0</span>): <span class="dv">1</span>, y(t).diff(t).subs(t, <span class="dv">0</span>): <span class="dv">0</span>}</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="30">
<p><span class="math inline">\(\displaystyle 10 y{\left(t \right)} - 2 \sin{\left(3 t \right)} + 2 \frac{d}{d t} y{\left(t \right)} + \frac{d^{2}}{d t^{2}} y{\left(t \right)}\)</span></p>
</div>
</div>
<div id="f679526b" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> sympy.symbols(<span class="st">'s'</span>, real<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> sympy.Function(<span class="st">'Y'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>Ly <span class="op">=</span> laplace_transform_(y(t), t, s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1121c093" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Lode <span class="op">=</span> subs_(laplace_transform_(ode, t, s), Ly, Y(s)).subs(ics)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Lode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="32">
<p><span class="math inline">\(\displaystyle s^{2} Y{\left(s \right)} + 2 s Y{\left(s \right)} - s + 10 Y{\left(s \right)} - 2 - \frac{6}{s^{2} + 9}\)</span></p>
</div>
</div>
<div id="924a9f8b" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Y_sol <span class="op">=</span> sympy.solve(Lode, Y(s))[<span class="dv">0</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>Y_sol </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="33">
<p><span class="math inline">\(\displaystyle \frac{s^{3} + 2 s^{2} + 9 s + 24}{s^{4} + 2 s^{3} + 19 s^{2} + 18 s + 90}\)</span></p>
</div>
</div>
<div id="d0681018" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>y_sol <span class="op">=</span> sympy.inverse_laplace_transform(Y_sol, s, t)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>y_sol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="34">
<p><span class="math inline">\(\displaystyle \frac{2 \sin{\left(3 t \right)}}{37} - \frac{12 \cos{\left(3 t \right)}}{37} + \frac{43 e^{- t} \sin{\left(3 t \right)}}{111} + \frac{49 e^{- t} \cos{\left(3 t \right)}}{37}\)</span></p>
</div>
</div>
<div id="dfd73eaf" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>y_t <span class="op">=</span> sympy.lambdify(t, y_sol, modules<span class="op">=</span>[<span class="st">'numpy'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="80586388" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>tt <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">500</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>ax.plot(tt, y_t(tt))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">t</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"</span><span class="dv">$</span><span class="vs">y</span><span class="kw">(</span><span class="vs">t</span><span class="kw">)</span><span class="dv">$</span><span class="vs">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-37-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="numerical-methods-for-solving-odes" class="level2" data-number="H.4">
<h2 data-number="H.4" class="anchored" data-anchor-id="numerical-methods-for-solving-odes"><span class="header-section-number">H.4</span> Numerical methods for solving ODEs</h2>
<ul>
<li><p>In practice, ODE problems are therefore mainly solved with numerical methods. There are many approaches to solving ODEs numerically, and most of them are designed for problems that are formulated as a system of first-order ODEs on the standard form:</p>
<p><span class="math display">\[ \frac{d\mathbf{y}}{dx} = \mathbf{f}(x, \mathbf{y}(x))\]</span></p></li>
<li><p>The basic idea of many numerical methods for ODEs is captured in Euler’s method. This method can, for example, be derived from a Taylor-series expansion of <span class="math inline">\(y(x)\)</span> around the point <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[ y(x+h) = y(x) +\frac{dy(x)}{dx}h +\frac{d^2 y(x)}{dx^2} h^2 + \cdots, \]</span></p>
<p>where for notational simplicity we consider the case when <span class="math inline">\(y(x)\)</span> is a scalar function</p></li>
<li><p>By dropping terms of second order or higher, <span class="math inline">\(\,\)</span>we get the approximate equation</p>
<p><span class="math display">\[ y(x+h) \approx y(x) +\frac{dy(x)}{dx}h, \]</span></p>
<p>which is accurate to first order in the step size <span class="math inline">\(h\)</span>. This equation can be turned into an iteration formula by discretizing the <span class="math inline">\(x\)</span> variable, <span class="math inline">\(x_0\)</span>, <span class="math inline">\(x_1\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(x_k\)</span>, <span class="math inline">\(\,\)</span>choosing the step size <span class="math inline">\(h_k =x_{k+1} -x_{k}\)</span>, <span class="math inline">\(\,\)</span>and denoting <span class="math inline">\(y_k = y(x_k)\)</span>. <span class="math inline">\(\,\)</span>The resulting iteration formula:</p>
<p><span class="math display">\[\color{red}{y_{k+1} \approx y_{k} +f(x_k, y_k) h_k},\]</span></p>
<p>is known as the <span style="color:blue"><em>forward Euler method</em></span>, and it is said to be an <span style="color:blue"><em>explicit form</em></span> because given the value of the <span class="math inline">\(y_k\)</span>, we can directly compute <span class="math inline">\(y_{k+1}\)</span> using the formula</p></li>
<li><p>There are two types of errors involved in this approach: First, the truncation of the Taylor series gives error that limits the accuracy of the method. Second, using the approximation of <span class="math inline">\(y_k\)</span> given by the previous iteration when computing <span class="math inline">\(y_{k+1}\)</span> gives an additional error that may accumulate over successive iterations, and that can affect the <em>stability</em> of the method</p></li>
<li><p>An alternative form, which can be derived in a similar manner, is the <span style="color:blue"><em>backward Euler method</em></span>, <span class="math inline">\(\,\)</span>given by the iteration formula</p>
<p><span class="math display">\[\color{red}{y_{k+1} \approx y_{k} +f(x_{k+1}, y_{k+1}) h_k}\]</span></p>
<p>This is an example of <span style="color:green">a backward differentiation formula(BDF)</span>, which is <span style="color:blue"><em>implicit</em></span>, <span class="math inline">\(\,\)</span>because <span class="math inline">\(y_{k+1}\)</span> occurs on both sides of the equation. <span class="math inline">\(~\)</span>To compute <span class="math inline">\(y_{k+1}\)</span>, <span class="math inline">\(\text{ }\)</span>we therefore need to solve an algebraic equation (for example using Newton’s method)</p></li>
<li><p>Implicit methods are more complicated to implement than explicit methods, and each iteration requires more computational work. However, the advantage is that implicit methods generally have <em>larger stability region</em> and <em>better accuracy</em>, which means that larger step size <span class="math inline">\(h_k\)</span> can be used while still obtaining an accurate and stable solution</p></li>
<li><p>Implicit methods are often particularly useful for stiff problems, which loosely speaking are ODE problems that describe dynamics with multiple disparate time scales</p></li>
<li><p>There are several methods to improve upon the first-order Euler forward and backward methods. One strategy is to keep higher-order terms in the Taylor-series expansion of <span class="math inline">\(y(x + h)\)</span>. <span class="math inline">\(\,\)</span>However, such methods require evaluating higher-order derivatives of <span class="math inline">\(y(x)\)</span>, which may be a problem</p>
<p>Ways around this problem include to approximate the higher-order derivatives using finite-difference approximations of the derivatives, or <span style="color:blue">by sampling the function <span class="math inline">\(f(x, y(x))\)</span> at intermediary points in the interval <span class="math inline">\([x_k, x_{k+1}]\)</span></span></p>
<p>An example of this type of method is the well-known <span style="color:blue"><em>Runge-Kutta method</em></span>, which is a single-step method that uses additional evaluations of <span class="math inline">\(f(x, y(x))\)</span>. The most well-known Runge-Kutta method is the 4th-order scheme:</p>
<p><span class="math display">\[\color{red}{y_{k+1} = y_k +\frac{h_k}{6} (k_1 +2k_2 +2k_3 +k_4)}\]</span></p>
<p>where</p>
<p><span class="math display">\[
\begin{aligned}
  k_1 &amp;= f(t_k, \,y_k)\\
  k_2 &amp;= f\left(t_k + \frac{h_k}{2},\, y_k +h_k \frac{k_1}{2} \right)\\
  k_3 &amp;= f\left(t_k + \frac{h_k}{2},\, y_k +h_k \frac{k_2}{2} \right)\\
  k_4 &amp;= f(t_k +h_k, \,y_k +h_k k_3)
\end{aligned}
\]</span></p></li>
<li><p>Here, <span class="math inline">\(k_1\)</span> to <span class="math inline">\(k_4\)</span> are four different evaluations of the ODE function <span class="math inline">\(f(x, y(x))\)</span> that are used in the explicit formula for <span class="math inline">\(y_{k+1}\)</span> given above. The resulting estimate of <span class="math inline">\(y_{k+1}\)</span> is accurate to 4-th order, with an error of 5-th order.</p>
<p>Higher-order schemes that use more function evaluations can also be constructed. <span style="color:blue">By combining two methods of different order</span>, it can be possible to also estimate the error in the approximation.</p>
<p>A popular combination is the Runge-Kutta 4-th and 5-th order schemes, which results in a 4-th order accurate method with error estimates. It is known as <span style="color:blue"><em>RK45</em></span> or the <em>Runge-Kutta-Fehlberg method</em>. The <span style="color:blue"><em>Dormand-Prince method</em></span> is another example of a higher-order method, which additionally uses adaptive step size control. For example, the 8-5-3 method combines 3rd and 5-th order schemes to produce an 8-th order method</p></li>
<li><p>An alternative method is <span style="color:blue">to use more than one previous value of <span class="math inline">\(y_k\)</span> to compute <span class="math inline">\(y_{k+1}\)</span></span>. Such methods are known as <span style="color:blue"><em>multistep methods</em></span>, and can in general be written on the form</p>
<p><span class="math display">\[\color{red}{y_{k + s} = \sum_{n=0}^{s-1} a_n y_{k + n} + h \sum_{n=0}^{s} b_n f(x_{k + n}, y_{k + n})}\]</span></p>
<p>This formula means that to compute <span class="math inline">\(y_{k+s}\)</span>, the previous <span class="math inline">\(s\)</span> values of <span class="math inline">\(y_k\)</span> and <span class="math inline">\(f(x_k, y_k)\)</span> are used (known as an <span class="math inline">\(s\)</span>-step method). The choices of the coefficients <span class="math inline">\(a_n\)</span> and <span class="math inline">\(b_n\)</span> give rise to different multistep methods. Note that <span style="color:blue">if <span class="math inline">\(b_s = 0\)</span>, then the method is <em>explicit</em>, and if <span class="math inline">\(b_s \neq 0\)</span> it is <em>implicit</em></span></p></li>
<li><p>For example, <span class="math inline">\(b_0 = b_1 = \cdots = b_{s-1} = 0\)</span> gives the general formula for an <span class="math inline">\(s\)</span>-step BDF formula, where <span class="math inline">\(a_n\)</span> and <span class="math inline">\(b_s\)</span> are chosen to maximize the order of the accuracy. For example, the one-step BDF method with <span class="math inline">\(b_1 = a_0 = 1\)</span> reduces to the backward Euler method, and the two-step BDF method,</p>
<p><span class="math display">\[y_{k+2} = a_0 y_k +a_1 y_{k+1} +hb_2 f(x_{k+2}, y_{k+2})\]</span></p>
<p>when solved for the coefficients <span class="math inline">\((a_0, a_1, b_2)\)</span> becomes <span class="math inline">\((-\frac{1}{3},\,\frac{4}{3},\,\frac{2}{3})\)</span></p></li>
<li><p>Another family of multistep methods are the Adams methods, which result from the choice</p>
<p><span class="math display">\[\color{red}{a_0 = a_1 = \cdots = a_{s-2} = 0, \text{ and } a_{s-1}=1}\]</span></p>
<p>where again the remaining unknown coefficients are chosen to maximize the order of the method</p>
<p>Specifically, <span style="color:blue">the explicit method with <span class="math inline">\(b_s = 0\)</span> are known as Adams-Bashforth methods, and the implicit methods with <span class="math inline">\(b_s \neq 0\)</span> are known as Adams-Moulton methods</span>. For example, the one-step Adams-Bashforth and Adams-Moulton methods reduce to the forward and backward Euler methods, respectively</p>
<p>And the two-step methods are</p>
<p><span class="math display">\[y_{k+2} = y_{k+1} + h \left[ -\frac{1}{2} f(x_{k}, y_{k}) + \frac{3}{2} f(x_{k+1}, y_{k+1}) \right]\]</span></p>
<p>and</p>
<p><span class="math display">\[y_{k+1} = y_{k} + \frac{h}{2} \left[ f(x_{k}, y_{k}) + f(x_{k+1}, y_{k+1}) \right]\]</span></p></li>
<li><p>In general, explicit methods are more convenient to implement and less computationally demanding to iterate than implicit methods, which in principle requires solving (a potentially nonlinear) equation in each iteration with an initial guess for the unknown <span class="math inline">\(y_{k+1}\)</span></p>
<p>However, as mentioned earlier, implicit methods often are more accurate and have superior stability properties. A compromise that retain some of the advantages of both methods is <span style="color:blue">to combine explicit and implicit methods</span> in the following way:</p>
<ul>
<li><p><span style="color:red">First compute <span class="math inline">\(y_{k+1}\)</span> using an explicit method</span>,</p></li>
<li><p><span style="color:red">then use this <span class="math inline">\(y_{k+1}\)</span> as an initial guess for solving the equation for <span class="math inline">\(y_{k+1}\)</span> given by an implicit method</span>.</p></li>
</ul>
<p>This equation does not need to be solved exactly, and since the initial guess from the explicit method should be quite good, a fixed number of iterations, using for example Newton’s method, could be sufficient. Methods like these, where an explicit method is used to predict <span class="math inline">\(y_{k+1}\)</span> and an implicit method is used to correct the prediction, are called <span style="color:blue"><em>predictor-corrector methods</em></span></p></li>
</ul>
</section>
<section id="numerical-integration-of-odes-using-scipy" class="level2" data-number="H.5">
<h2 data-number="H.5" class="anchored" data-anchor-id="numerical-integration-of-odes-using-scipy"><span class="header-section-number">H.5</span> Numerical integration of ODEs using <code>scipy</code></h2>
<ul>
<li><p>The <code>integrate</code> module of <code>scipy</code> provides the ODE solver interface: <code>integrate.solve_ivp</code>. This function numerically integrates a system of ordinary differential equations given an initial value:</p>
<p><span class="math display">\[\begin{aligned}
\frac{d\mathbf{y}}{dt}&amp;= \mathbf{f}(t, \mathbf{y})\\
\mathbf{y}(t_0)&amp;= \mathbf{y}_0
\end{aligned}\]</span></p></li>
<li><p>Explicit Runge-Kutta methods <code>('RK23','RK45','DOP853')</code> should be used for non-stiff problems and implicit methods <code>('Radau','BDF')</code> for stiff problems. Among Runge-Kutta methods, <code>'DOP853'</code> is recommended for solving with high precision (low values of <code>rtol</code> and <code>atol</code>)</p>
<p>If not sure, first try to run <code>'RK45'</code>. If it makes unusually many iterations, diverges, or fails, your problem is likely to be stiff and you should use <code>'Radau'</code> or <code>'BDF'</code>. <code>'LSODA'</code> can also be a good universal choice, but it might be somewhat less convenient to work with as it wraps old Fortran code</p></li>
<li><p>For example, <span class="math inline">\(\,\)</span>consider again the scalar ODE</p>
<p><span class="math display">\[y'(x) = f(x, y(x)) = x + y^2(x)\]</span></p></li>
</ul>
<div id="5a229e1c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> integrate</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dydx(x, y):   </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span>y<span class="op">*</span>y</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>y0 <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>sol_p <span class="op">=</span> integrate.solve_ivp(dydx, [<span class="dv">0</span>, <span class="fl">1.9</span>], y0)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>sol_m <span class="op">=</span> integrate.solve_ivp(dydx, [<span class="dv">0</span>, <span class="op">-</span><span class="dv">5</span>], y0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f00f055d" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plot_direction_field(x, y(x), f, ax<span class="op">=</span>ax)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>ax.plot(sol_p.t, sol_p.y.T, <span class="st">'g'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>ax.plot(sol_m.t, sol_m.y.T, <span class="st">'r'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-39-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>In the previous example, we solved a scalar ODE problem. More often we are interested in vector-valued ODE problems (systems of ODEs). To see how we can solve that kind of problems using <code>solve_ivp</code>, consider the Lokta-Volterra equations for the dynamics of a population of predator and prey animals (a classic example of coupled ODEs). The equations are</p>
<p><span class="math display">\[
x'(t) = a x - b x y
\]</span></p>
<p><span class="math display">\[
y'(t) = c x y - d y
\]</span></p>
<p>where <span class="math inline">\(x(t)\)</span> is the number of prey animals and <span class="math inline">\(y(t)\)</span> is the number of predator animals, and the coefficients <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span>, and <span class="math inline">\(d\)</span> describe the rates of the processes in the model</p></li>
</ul>
<div id="a0c86af1" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>a, b, c, d <span class="op">=</span> <span class="fl">0.4</span>, <span class="fl">0.002</span>, <span class="fl">0.001</span>, <span class="fl">0.7</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t, xy):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  x, y <span class="op">=</span> xy</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [a <span class="op">*</span>x <span class="op">-</span>b <span class="op">*</span>x <span class="op">*</span>y, c <span class="op">*</span>x <span class="op">*</span>y <span class="op">-</span>d <span class="op">*</span>y]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ed406624" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>xy0 <span class="op">=</span> [<span class="dv">600</span>, <span class="dv">400</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> integrate.solve_ivp(f, [<span class="dv">0</span>, <span class="dv">50</span>], xy0, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        t_eval<span class="op">=</span>np.linspace(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">400</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> sol.t</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>xy_t <span class="op">=</span> sol.y.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7b79051e" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">12</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(t, xy_t[:,<span class="dv">0</span>], <span class="st">'r'</span>, label<span class="op">=</span><span class="st">"Prey"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(t, xy_t[:,<span class="dv">1</span>], <span class="st">'b'</span>, label<span class="op">=</span><span class="st">"Predator"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Time"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Number of animals"</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="dv">1400</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(xy_t[:,<span class="dv">0</span>], xy_t[:,<span class="dv">1</span>], <span class="st">'k'</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Number of prey"</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Number of predators"</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(<span class="dv">300</span>, <span class="dv">1300</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(<span class="dv">50</span>, <span class="dv">450</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-42-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>In the previous two examples, the function for the right-hand side of the ODE was implemented without additional arguments. Rather than using global variables, it is often convenient and elegant to implement the <code>f</code> function in such a way that it takes arguments for all its coefficient or parameters. To illustrate this point, let’s consider another famous ODE problem: the Lorenz equations, which is the following system of three coupled nonlinear ODEs,</p>
<p><span class="math display">\[
  \begin{aligned}
  x'(t) &amp;= \sigma(y - x)\\
  y'(t) &amp;= x(\rho - z) - y \\
  z'(t) &amp;= x y - \beta z
  \end{aligned}
\]</span></p></li>
</ul>
<div id="612370ef" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rho, sigma, beta <span class="op">=</span> <span class="dv">28</span>, <span class="dv">8</span>, <span class="dv">8</span><span class="op">/</span><span class="fl">3.0</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t, xyz, rho, sigma, beta):</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  x, y, z <span class="op">=</span> xyz</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [sigma <span class="op">*</span>(y <span class="op">-</span>x), x <span class="op">*</span>(rho <span class="op">-</span>z) <span class="op">-</span>y, x <span class="op">*</span>y <span class="op">-</span>beta <span class="op">*</span>z]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c64ae9d1" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>xyz0 <span class="op">=</span> [<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>t_span <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">25</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>t_eval <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">10000</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>sol1 <span class="op">=</span> integrate.solve_ivp(f, t_span, xyz0, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>          t_eval<span class="op">=</span>t_eval, args<span class="op">=</span>(rho, sigma, beta))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>sol2 <span class="op">=</span> integrate.solve_ivp(f, t_span, xyz0, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>          t_eval<span class="op">=</span>t_eval, args<span class="op">=</span>(rho, sigma, <span class="fl">0.6</span><span class="op">*</span>beta))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>sol3 <span class="op">=</span> integrate.solve_ivp(f, t_span, xyz0, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>          t_eval<span class="op">=</span>t_eval, args<span class="op">=</span>(rho, <span class="dv">2</span><span class="op">*</span>sigma, <span class="fl">0.6</span><span class="op">*</span>beta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8b33a145" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">15</span>), </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: <span class="st">'3d'</span>})</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>xyz1 <span class="op">=</span> sol1.y</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>xyz2 <span class="op">=</span> sol2.y</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>xyz3 <span class="op">=</span> sol3.y</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, xyz, c <span class="kw">in</span> [(ax1, xyz1, <span class="st">'r'</span>), </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                   (ax2, xyz2, <span class="st">'b'</span>), </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                   (ax3, xyz3, <span class="st">'g'</span>)]:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(xyz[<span class="dv">0</span>,:], xyz[<span class="dv">1</span>,:], xyz[<span class="dv">2</span>,:], c, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'$x$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'$y$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    ax.set_zlabel(<span class="st">'$z$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks([<span class="op">-</span><span class="dv">15</span>, <span class="dv">0</span>, <span class="dv">15</span>])</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([<span class="op">-</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">20</span>])</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    ax.set_zticks([<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-45-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>To illustrate how to use the <code>integrate.ode</code> interface, <span class="math inline">\(\,\)</span>we first look at the following sets of coupled second-order ODEs:</p>
<p><span class="math display">\[
\begin{aligned}
m_1 x_1''(t) + \gamma_1 x_1'(t) + k_1 x_1(t) - k_2 (x_2(t) - x_1(t)) &amp;= 0\\
m_2 x_2''(t) + \gamma_2 x_2'(t) + k_2 (x_2(t) - x_1(t)) &amp;= 0
\end{aligned}
\]</span></p>
<p>These equations describe the dynamics of two coupled springs, where <span class="math inline">\(x_1(t)\)</span> and <span class="math inline">\(x_2(t)\)</span> are the displacement of two objects, with masses <span class="math inline">\(m_1\)</span> and <span class="math inline">\(m_2\)</span>, from their equilibrium positions. The object at <span class="math inline">\(x_1\)</span> is connected to a fixed wall via a spring with spring constant <span class="math inline">\(k_1\)</span>, and connected to the object at <span class="math inline">\(x_2\)</span> via a spring with spring constant <span class="math inline">\(k_2\)</span>. Both objects are subject to damping forces characterized by <span class="math inline">\(\gamma_1\)</span> and <span class="math inline">\(\gamma_2\)</span>, respectively</p></li>
<li><p>To solve this kind of problem with <code>scipy</code>, we first have to write it in standard form, which we can do by introducing <span class="math inline">\(y_0(t) =x_1(t)\)</span>, <span class="math inline">\(\,y_1(t) =x_1'(t)\)</span>, <span class="math inline">\(\,y_2(t) =x_2(t)\)</span>, <span class="math inline">\(\,\)</span>and <span class="math inline">\(\,y_3(t) =x_2'(t)\)</span>, which results in four coupled first-order equations:</p>
<p><span class="math display">\[
  \frac{d}{dt}
  \begin{bmatrix}
    y_0(t)\\
    y_1(t)\\
    y_2(t)\\
    y_3(t)
    \end{bmatrix} =
    \begin{bmatrix}
    y_1(t) \\
    \left[-\gamma_1 y_1(t) -k_1 y_0(t) -k_2 y_0(t) +k_2 y_2(t)\right]/m_1 \\
    y_3(t) \\
    \left[-\gamma_2 y_3(t) -k_2 y_2(t) +k_2 y_0(t)\right]/m_2
  \end{bmatrix}
\]</span></p></li>
</ul>
<div id="11601cd1" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t, y, args):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  m1, k1, g1, m2, k2, g2 <span class="op">=</span> args</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [y[<span class="dv">1</span>], </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> k1<span class="op">/</span>m1 <span class="op">*</span>y[<span class="dv">0</span>] <span class="op">+</span>k2<span class="op">/</span>m1 <span class="op">*</span>(y[<span class="dv">2</span>] <span class="op">-</span>y[<span class="dv">0</span>]) <span class="op">-</span>g1<span class="op">/</span>m1 <span class="op">*</span>y[<span class="dv">1</span>], </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>          y[<span class="dv">3</span>], </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> k2<span class="op">/</span>m2 <span class="op">*</span>(y[<span class="dv">2</span>] <span class="op">-</span>y[<span class="dv">0</span>]) <span class="op">-</span>g2<span class="op">/</span>m2 <span class="op">*</span>y[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b9f51fa5" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>m1, k1, g1, m2, k2, g2 <span class="op">=</span> <span class="fl">1.0</span>, <span class="fl">10.0</span>, <span class="fl">0.5</span>, <span class="fl">2.0</span>, <span class="fl">40.0</span>, <span class="fl">0.25</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> (m1, k1, g1, m2, k2, g2)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>y0 <span class="op">=</span> [<span class="fl">1.0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">0</span>]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Instead of calling the <code>solve_ivp</code> function, <span class="math inline">\(\,\)</span>we now need to create an instance of the class <code>integrate.ode</code>, <span class="math inline">\(\,\)</span>passing the ODE function <span class="math inline">\(f\)</span> as an argument:</li>
</ul>
<div id="59ba0d24" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> integrate.ode(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="16af7651" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the possible first argument: </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vode, zvode, lsoda, dopri5 and dop853</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>r.set_integrator(<span class="st">'lsoda'</span>) </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>r.set_initial_value(y0, t[<span class="dv">0</span>])</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>r.set_f_params(args)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> t[<span class="dv">1</span>] <span class="op">-</span>t[<span class="dv">0</span>]</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.zeros((<span class="bu">len</span>(t), <span class="bu">len</span>(y0)))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> r.successful() <span class="kw">and</span> r.t <span class="op">&lt;</span> t[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  y[idx, :] <span class="op">=</span> r.y</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  r.integrate(r.t <span class="op">+</span>dt)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  idx <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>This is arguably not as convenient as simply calling the <code>solive_ivp</code>, but it offers extra flexibility that sometimes is exactly what is needed</li>
</ul>
<div id="48cbb148" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">10</span>, <span class="dv">4</span>), (<span class="dv">0</span>, <span class="dv">0</span>), colspan<span class="op">=</span><span class="dv">4</span>, rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">10</span>, <span class="dv">4</span>), (<span class="dv">3</span>, <span class="dv">0</span>), colspan<span class="op">=</span><span class="dv">4</span>, rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.subplot2grid((<span class="dv">10</span>, <span class="dv">4</span>), (<span class="dv">6</span>, <span class="dv">0</span>), colspan<span class="op">=</span><span class="dv">4</span>, rowspan<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># x_1 vs time plot</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(t, y[:, <span class="dv">0</span>], <span class="st">'r'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'$x_1$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>ax1.set_yticks([<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>])</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>, axis<span class="op">=</span><span class="st">'x'</span>, pad<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># x2 vs time plot</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(t, y[:, <span class="dv">2</span>], <span class="st">'b'</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'$t$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'$x_2$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>ax2.set_yticks([<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>])</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>, axis<span class="op">=</span><span class="st">'x'</span>, pad<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co"># x1 and x2 phase space plot</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>ax3.plot(y[:, <span class="dv">0</span>], y[:, <span class="dv">2</span>], <span class="st">'g'</span>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'$x_1$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'$x_2$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks([<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>])</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>ax3.set_yticks([<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>])</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>ax3.set_xlim(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.00</span>)</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>ax3.set_ylim(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>ax3.tick_params(which<span class="op">=</span><span class="st">'both'</span>, direction<span class="op">=</span><span class="st">'in'</span>, axis<span class="op">=</span><span class="st">'x'</span>, pad<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="x_ordinary_differential_equations_files/figure-html/cell-50-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Python functions for both <span class="math inline">\(f(t, y(t))\)</span> and its Jacobian can conveniently be generated using <code>sympy</code>’s <code>lambdify</code>, provided that the ODE problem first can be defined as a <code>sympy</code> expression. This symbolic-numeric hybrid approach is a powerful method to solving ODE problems(See <a href="x_double_pendulum.html" class="quarto-xref"><span>Appendix I</span></a>)</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./x_integration.html" class="pagination-link" aria-label="Integration">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Integration</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./x_double_pendulum.html" class="pagination-link" aria-label="Double Pendulum">
        <span class="nav-page-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Double Pendulum</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>